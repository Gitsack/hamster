import{j as e}from"./jsx-runtime-u17CrQMm.js";import{H as R,L as z,t as r}from"./app-CFoDCqX-.js";import{A as P}from"./app-layout-CTvh2ZE0.js";import{B as u}from"./button-B9kPMW4q.js";import{C as L,a as M,b as _,d as O}from"./card-BT9UEfea.js";import{P as K}from"./progress-Dv5gXtGp.js";import{B as l}from"./badge-B6bn15vN.js";import{S as g}from"./skeleton-A7behTLO.js";import{T as G,a as V,b as A,c as n,d as J,e as i}from"./table-B1mxUS1v.js";import{A as U,a as W,b as X,c as Y,d as Z,e as ee,f as se,g as ae}from"./alert-dialog-B3SDlAxj.js";import{H as o,k as re,q as te,A as le,s as ne,u as ie,p as oe,T as ce}from"./index.min-fvaCWwiU.js";import{S as de}from"./spinner-McTJFRVv.js";import{r as t}from"./app-BHuVDAkc.js";import"./preload-helper-PPVm8Dsz.js";import"./client-Bx265bNG.js";import"./index-CYxWbFTv.js";import"./index-D5-0xbEa.js";import"./utils-CDN07tui.js";import"./dialog-CQTA4pg1.js";import"./createLucideIcon-GXN1tXoc.js";import"./media-status-badge-DETbNkVM.js";import"./useRenderElement-D0Q1kVud.js";import"./useBaseUiId-BvJSLVy2.js";import"./useValueAsRef-GoV-SdOe.js";import"./media-teaser-CTZEtwns.js";import"./check-BEKQ83Eb.js";import"./useLabelableId-CyGgmgle.js";import"./valueToPercent-CmxdyyhM.js";import"./slot-CUYGZ4Fv.js";import"./hamster-icon-DOXrnfMg.js";import"./input-Bw95PIWX.js";function ue(){const[w,h]=t.useState([]),[D,N]=t.useState(!0),[v,y]=t.useState(!1),[x,S]=t.useState(!1),[f,C]=t.useState(!1),[m,p]=t.useState(null),[b,q]=t.useState(!1),[T,j]=t.useState(null),c=t.useCallback(async(s=!0)=>{s&&N(!0),j(null);try{const a=await fetch("/api/v1/queue");if(a.ok){const d=await a.json();h(d)}else j("Failed to fetch queue")}catch(a){console.error("Failed to fetch queue:",a),j("Failed to connect to server")}finally{N(!1)}},[]);t.useEffect(()=>{c();const s=setInterval(()=>c(!1),5e3);return()=>clearInterval(s)},[c]);const F=async()=>{y(!0);try{const s=await fetch("/api/v1/queue/refresh",{method:"POST"});if(s.ok){const a=await s.json();h(a),r.success("Queue refreshed")}}catch(s){console.error("Failed to refresh queue:",s),r.error("Failed to refresh queue")}finally{y(!1)}},k=async()=>{S(!0);try{const s=await fetch("/api/v1/queue/scan-completed",{method:"POST"}),a=await s.json();s.ok?(r.success(a.message||"Scan completed"),c(!1)):r.error(a.error||"Scan failed")}catch(s){console.error("Failed to scan completed downloads:",s),r.error("Failed to scan completed downloads")}finally{S(!1)}},$=async()=>{C(!0);try{const s=await fetch("/api/v1/queue/search-requested",{method:"POST"}),a=await s.json();s.ok?r.success(a.message||"Searching for requested items..."):r.error(a.error||"Search failed")}catch(s){console.error("Failed to search requested:",s),r.error("Failed to search requested items")}finally{C(!1)}},B=async()=>{if(m){q(!0);try{(await fetch(`/api/v1/queue/${m}`,{method:"DELETE"})).ok?(h(a=>a.filter(d=>d.id!==m)),r.success("Download cancelled")):r.error("Failed to cancel download")}catch(s){console.error("Failed to cancel download:",s),r.error("Failed to cancel download")}finally{q(!1),p(null)}}},I=s=>s?s>=1073741824?`${(s/1073741824).toFixed(1)} GB`:s>=1048576?`${(s/1048576).toFixed(0)} MB`:`${(s/1024).toFixed(0)} KB`:"-",E=s=>{if(!s||s<=0)return"-";if(s<60)return`${s}s`;if(s<3600)return`${Math.floor(s/60)}m`;const a=Math.floor(s/3600),d=Math.floor(s%3600/60);return`${a}h ${d}m`},H=s=>{switch(s){case"downloading":return e.jsx(l,{className:"bg-blue-500",children:"Downloading"});case"paused":return e.jsx(l,{variant:"secondary",children:"Paused"});case"queued":return e.jsx(l,{variant:"outline",children:"Queued"});case"importing":return e.jsx(l,{className:"bg-purple-500",children:"Importing"});case"completed":return e.jsx(l,{className:"bg-green-500",children:"Completed"});case"failed":return e.jsx(l,{className:"bg-red-500",children:"Failed"});default:return e.jsx(l,{variant:"outline",children:s})}},Q=s=>{switch(s){case"downloading":return e.jsx(o,{icon:ce,className:"h-4 w-4 text-blue-500"});case"paused":return e.jsx(o,{icon:oe,className:"h-4 w-4 text-muted-foreground"});default:return e.jsx(de,{className:"text-muted-foreground"})}};return e.jsxs(P,{title:"Queue",actions:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(u,{onClick:$,disabled:f,variant:"outline",size:"sm",children:[e.jsx(o,{icon:le,className:`h-4 w-4 md:mr-2 ${f?"animate-pulse":""}`}),e.jsx("span",{className:"hidden md:inline",children:f?"Searching...":"Search Requested"})]}),e.jsxs(u,{onClick:k,disabled:x,variant:"outline",size:"sm",children:[e.jsx(o,{icon:ne,className:`h-4 w-4 md:mr-2 ${x?"animate-pulse":""}`}),e.jsx("span",{className:"hidden md:inline",children:x?"Scanning...":"Import Completed"})]}),e.jsxs(u,{onClick:F,disabled:v,size:"sm",children:[e.jsx(o,{icon:ie,className:`h-4 w-4 md:mr-2 ${v?"animate-spin":""}`}),e.jsx("span",{className:"hidden md:inline",children:"Refresh"})]})]}),children:[e.jsx(R,{title:"Queue"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(L,{children:[e.jsx(M,{children:e.jsx(_,{children:"Active Downloads"})}),e.jsx(O,{children:T?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("p",{className:"text-destructive mb-4",children:T}),e.jsx(u,{onClick:()=>c(),variant:"outline",children:"Try Again"})]}):D?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((s,a)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{className:"h-10 w-10 rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(g,{className:"h-4 w-1/3"}),e.jsx(g,{className:"h-2 w-full"})]})]},a))}):w.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"rounded-full bg-muted p-6 mb-4",children:e.jsx(o,{icon:re,className:"h-12 w-12 text-green-500"})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No active downloads"}),e.jsx("p",{className:"text-muted-foreground",children:"Downloads will appear here when you grab releases."})]}):e.jsx("div",{className:"overflow-x-auto -mx-6 px-6",children:e.jsxs(G,{children:[e.jsx(V,{children:e.jsxs(A,{children:[e.jsx(n,{className:"w-10"}),e.jsx(n,{children:"Title"}),e.jsx(n,{className:"w-32",children:"Status"}),e.jsx(n,{className:"w-48",children:"Progress"}),e.jsx(n,{className:"w-24 text-right",children:"Size"}),e.jsx(n,{className:"w-24 text-right",children:"ETA"}),e.jsx(n,{className:"w-24"})]})}),e.jsx(J,{children:w.map(s=>e.jsxs(A,{children:[e.jsx(i,{children:Q(s.status)}),e.jsxs(i,{children:[e.jsx("div",{className:"font-medium truncate max-w-md",children:s.title}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.downloadClient})]}),e.jsx(i,{children:H(s.status)}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(K,{value:Number(s.progress)||0,className:"h-2"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[(Number(s.progress)||0).toFixed(1),"%"]})]})}),e.jsx(i,{className:"text-right text-muted-foreground",children:I(s.size)}),e.jsx(i,{className:"text-right text-muted-foreground",children:E(s.eta)}),e.jsx(i,{children:e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>p(s.id),children:e.jsx(o,{icon:te,className:"h-4 w-4 text-destructive"})})})]},s.id))})]})})})]}),e.jsx("div",{className:"text-center",children:e.jsx(z,{href:"/activity/history",className:"text-sm text-muted-foreground hover:text-primary transition-colors",children:"View download history"})})]}),e.jsx(U,{open:m!==null,onOpenChange:()=>p(null),children:e.jsxs(W,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Cancel download?"}),e.jsx(Z,{children:"This will cancel and remove the download from the queue."})]}),e.jsxs(ee,{children:[e.jsx(se,{children:"Keep"}),e.jsx(ae,{onClick:B,className:"bg-destructive text-destructive-foreground",disabled:b,children:b?"Cancelling...":"Cancel Download"})]})]})})]})}ue.__docgenInfo={description:"",methods:[],displayName:"Queue"};export{ue as default};
