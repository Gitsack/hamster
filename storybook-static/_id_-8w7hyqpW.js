import{j as e}from"./jsx-runtime-u17CrQMm.js";import{f as de,g as ce,t as r,r as v,H as j,a2 as me,a3 as he,L as xe}from"./app-CFoDCqX-.js";import{A as g,D as ue,a as fe,b as pe,c as P,d as ve}from"./app-layout-CTvh2ZE0.js";import{B as n}from"./button-B9kPMW4q.js";import{B as u}from"./badge-B6bn15vN.js";import{C as E,d as L}from"./card-BT9UEfea.js";import{S as h}from"./skeleton-A7behTLO.js";import{D as w,a as N,b as A,c as R,d as U,e as z}from"./dialog-CQTA4pg1.js";import{H as a,j as H,F as je,c as ge,y as we,f as Ne,G as ye,q as _,n as Fe,$ as be,L as De,A as J,J as Me}from"./index.min-fvaCWwiU.js";import{S as y}from"./spinner-McTJFRVv.js";import{r as l}from"./app-BHuVDAkc.js";import{a2 as ke,a6 as Se}from"./media-status-badge-DETbNkVM.js";import{V as Ce}from"./video_player-CvfBXWR_.js";import"./preload-helper-PPVm8Dsz.js";import"./client-Bx265bNG.js";import"./index-CYxWbFTv.js";import"./index-D5-0xbEa.js";import"./utils-CDN07tui.js";import"./media-teaser-CTZEtwns.js";import"./check-BEKQ83Eb.js";import"./createLucideIcon-GXN1tXoc.js";import"./useRenderElement-D0Q1kVud.js";import"./useLabelableId-CyGgmgle.js";import"./useBaseUiId-BvJSLVy2.js";import"./useValueAsRef-GoV-SdOe.js";import"./valueToPercent-CmxdyyhM.js";import"./slot-CUYGZ4Fv.js";import"./hamster-icon-DOXrnfMg.js";import"./input-Bw95PIWX.js";function Te(){const{url:G}=de(),d=G.split("/").pop(),[s,c]=l.useState(null),[V,K]=l.useState(!0),[W,m]=l.useState(!1),[Y,x]=l.useState(!1),[F,b]=l.useState(!1),[D,M]=l.useState(!1),[k,S]=l.useState(!1),[Q,C]=l.useState(!1),[X,T]=l.useState(null),[f,I]=l.useState(!1),[$,q]=l.useState(!1),Z=ce();l.useEffect(()=>{O(),B();const i=setInterval(B,5e3);return()=>clearInterval(i)},[d]);const O=async()=>{try{const i=await fetch(`/api/v1/movies/${d}`);if(i.ok){const t=await i.json();c(t)}else i.status===404&&(r.error("Movie not found"),v.visit("/library?tab=movies"))}catch(i){console.error("Failed to fetch movie:",i),r.error("Failed to load movie")}finally{K(!1)}},B=async()=>{try{const i=await fetch("/api/v1/queue");if(i.ok){const o=(await i.json()).find(p=>p.movieId===d);T(o?{progress:o.progress||0,status:o.status||"downloading"}:null)}}catch{}},ee=()=>s?Se(s,X):{status:"none",progress:0},se=async()=>{if(!s)return;const i=s.monitored;c({...s,monitored:!i});try{(await fetch(`/api/v1/movies/${d}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({monitored:!i})})).ok?r.success(i?"Monitoring disabled":"Monitoring enabled"):(c({...s,monitored:i}),r.error("Failed to update monitoring"))}catch(t){console.error("Failed to update monitoring:",t),c({...s,monitored:i}),r.error("Failed to update monitoring")}},ie=async()=>{if(!s)return;const i=s.requested;if(i&&s.hasFile){m(!0);return}c({...s,requested:!i}),C(!0);try{const t=await fetch(`/api/v1/movies/${d}/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requested:!i})}),o=await t.json();t.ok?o.deleted?(r.success("Removed from library"),v.visit("/library?tab=movies")):r.success(i?"Movie unrequested":"Movie requested"):o.hasFile?(c({...s,requested:i}),m(!0)):(c({...s,requested:i}),r.error(o.error||"Failed to update movie"))}catch(t){console.error("Failed to update movie:",t),c({...s,requested:i}),r.error("Failed to update movie")}finally{C(!1)}},te=async(i=!1)=>{b(!0);try{const t=i?`/api/v1/movies/${d}?deleteFile=true`:`/api/v1/movies/${d}`,o=await fetch(t,{method:"DELETE"});if(o.ok)r.success(i?"Movie and files deleted":"Movie deleted"),v.visit("/library?tab=movies");else{const p=await o.json();r.error(p.error||"Failed to delete")}}catch(t){console.error("Failed to delete movie:",t),r.error("Failed to delete movie")}finally{b(!1),m(!1)}},re=async()=>{if(s){S(!0);try{const i=await fetch(`/api/v1/movies/${d}/download`,{method:"POST"});if(i.ok){const t=await i.json();r.success(`Download started: ${t.release?.title||s.title}`)}else{const t=await i.json();r.error(t.error||"No releases found")}}catch(i){console.error("Failed to download:",i),r.error("Failed to download movie")}finally{S(!1)}}},ae=async()=>{if(s){I(!0);try{const i=await fetch(`/api/v1/movies/${d}/enrich`,{method:"POST"});if(i.ok){const t=await i.json();t.enriched?(r.success("Movie enriched with TMDB data"),O()):r.warning(t.message||"No matching movie found")}else{const t=await i.json();r.error(t.error||"Failed to enrich")}}catch(i){console.error("Failed to enrich movie:",i),r.error("Failed to enrich movie")}finally{I(!1)}}},oe=async()=>{if(s){M(!0);try{const i=await fetch(`/api/v1/movies/${d}/file`,{method:"DELETE"});if(i.ok)r.success("File deleted successfully"),c({...s,hasFile:!1,movieFile:null});else{const t=await i.json();r.error(t.error||"Failed to delete file")}}catch(i){console.error("Failed to delete file:",i),r.error("Failed to delete file")}finally{M(!1),x(!1)}}},le=i=>{const t=Math.floor(i/60),o=i%60;return t>0?`${t}h ${o}m`:`${o}m`},ne=i=>i<1024*1024?`${(i/1024).toFixed(1)} KB`:i<1024*1024*1024?`${(i/(1024*1024)).toFixed(1)} MB`:`${(i/(1024*1024*1024)).toFixed(2)} GB`;return V?e.jsxs(g,{title:"Loading...",children:[e.jsx(j,{title:"Loading..."}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsx(h,{className:"h-72 w-48 rounded-lg"}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(h,{className:"h-8 w-1/3"}),e.jsx(h,{className:"h-4 w-1/4"}),e.jsx(h,{className:"h-4 w-2/3"}),e.jsx(h,{className:"h-4 w-1/2"})]})]})})]}):s?e.jsxs(g,{title:s.title,actions:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(n,{variant:"outline",asChild:!0,children:e.jsxs(xe,{href:"/library?tab=movies",children:[e.jsx(a,{icon:Fe,className:"h-4 w-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Back"})]})}),e.jsxs(n,{variant:"outline",size:"sm",onClick:se,children:[e.jsx(a,{icon:s.monitored?be:De,className:"h-4 w-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:s.monitored?"Monitored":"Monitor"})]}),!s.hasFile&&e.jsxs(n,{onClick:re,disabled:k,children:[k?e.jsx(y,{className:"md:mr-2"}):e.jsx(a,{icon:J,className:"h-4 w-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Search releases"})]}),e.jsxs(ue,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(n,{variant:"outline",size:"icon",children:e.jsx(a,{icon:Me,className:"h-4 w-4"})})}),e.jsxs(pe,{align:"end",children:[!s.tmdbId&&e.jsxs(P,{onClick:ae,disabled:f,children:[e.jsx(a,{icon:J,className:`h-4 w-4 mr-2 ${f?"animate-spin":""}`}),f?"Enriching...":"Enrich from TMDB"]}),!s.tmdbId&&e.jsx(ve,{}),e.jsxs(P,{className:"text-destructive",onClick:()=>m(!0),children:[e.jsx(a,{icon:_,className:"h-4 w-4 mr-2"}),"Remove from Library"]})]})]})]}),children:[e.jsx(j,{title:s.title}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"-mx-4 -mt-4 mb-6",children:e.jsx(me,{trailerUrl:s.trailerUrl,images:s.backdropImages?.length?s.backdropImages:s.backdropUrl?[s.backdropUrl]:void 0,title:s.title,className:"h-48 md:h-64"})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"w-full md:w-48 aspect-[2/3] md:aspect-auto md:h-72 bg-muted rounded-lg overflow-hidden flex-shrink-0",children:s.posterUrl?e.jsx("img",{src:s.posterUrl,alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(a,{icon:H,className:"h-16 w-16 text-muted-foreground/50"})})}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.title}),s.year&&e.jsxs("span",{className:"text-muted-foreground",children:["(",s.year,")"]})]}),s.originalTitle&&s.originalTitle!==s.title&&e.jsx("p",{className:"text-muted-foreground",children:s.originalTitle})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[(()=>{const{status:i,progress:t}=ee();return e.jsx(ke,{status:i,progress:t,isToggling:Q,onToggleRequest:ie})})(),s.status&&e.jsx(u,{variant:"outline",children:s.status})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-2 text-sm",children:[s.releaseDate&&e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(a,{icon:je,className:"h-4 w-4"}),s.releaseDate]}),s.runtime&&e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(a,{icon:ge,className:"h-4 w-4"}),le(s.runtime)]}),s.rating&&e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(a,{icon:we,className:"h-4 w-4"}),s.rating.toFixed(1)]})]}),s.genres&&s.genres.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.genres.slice(0,5).map((i,t)=>e.jsx(u,{variant:"outline",children:i},t))}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-sm",children:[s.qualityProfile&&e.jsx(u,{variant:"secondary",children:s.qualityProfile.name}),s.rootFolder&&e.jsx(u,{variant:"secondary",children:s.rootFolder.path})]}),e.jsxs("div",{className:"flex gap-2 text-sm",children:[s.tmdbId&&e.jsx("a",{href:`https://www.themoviedb.org/movie/${s.tmdbId}`,target:"_blank",rel:"noopener noreferrer",className:"text-muted-foreground hover:text-primary",children:"TMDB"}),s.imdbId&&e.jsx("a",{href:`https://www.imdb.com/title/${s.imdbId}`,target:"_blank",rel:"noopener noreferrer",className:"text-muted-foreground hover:text-primary",children:"IMDB"})]})]})]}),s.overview&&e.jsx(E,{children:e.jsxs(L,{className:"pt-6",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Overview"}),e.jsx("p",{className:"text-muted-foreground",children:s.overview})]})}),s.movieFile&&e.jsx(E,{children:e.jsxs(L,{className:"pt-6",children:[e.jsx("h2",{className:"font-semibold mb-4",children:"File"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-3 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx(a,{icon:H,className:"h-8 w-8 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:s.movieFile.path.split("/").pop()}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.movieFile.quality&&`${s.movieFile.quality} â€¢ `,ne(s.movieFile.size)]}),e.jsx("p",{className:"text-xs text-muted-foreground/70 truncate",children:s.movieFile.path})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(n,{variant:"default",size:"sm",onClick:()=>{Z.pause(),q(!0)},children:[e.jsx(a,{icon:Ne,className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Play"})]}),e.jsx(n,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs("a",{href:s.movieFile.downloadUrl,download:!0,children:[e.jsx(a,{icon:ye,className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Download"})]})}),e.jsxs(n,{variant:"outline",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>x(!0),children:[e.jsx(a,{icon:_,className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Delete"})]})]})]})]})}),s.tmdbId&&e.jsx(he,{mediaType:"movies",mediaId:s.id,tmdbId:s.tmdbId})]}),e.jsx(w,{open:W,onOpenChange:m,children:e.jsxs(N,{children:[e.jsxs(A,{children:[e.jsx(R,{children:s.hasFile?"Remove from library?":`Delete ${s.title}?`}),e.jsx(U,{children:s.hasFile?"This will permanently delete the downloaded files from disk and remove the movie from your library.":"This will remove the movie from your library."})]}),e.jsxs(z,{children:[e.jsx(n,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(n,{variant:"destructive",onClick:()=>te(s.hasFile),disabled:F,children:F?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"mr-2"}),"Deleting..."]}):s.hasFile?"Delete Files & Remove":"Delete"})]})]})}),e.jsx(w,{open:Y,onOpenChange:x,children:e.jsxs(N,{children:[e.jsxs(A,{children:[e.jsx(R,{children:"Delete movie file?"}),e.jsx(U,{children:"This will permanently delete the movie file from disk. The movie will remain in your library but will need to be downloaded again."})]}),e.jsxs(z,{children:[e.jsx(n,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(n,{variant:"destructive",onClick:oe,disabled:D,children:D?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"mr-2"}),"Deleting..."]}):"Delete File"})]})]})}),e.jsx(w,{open:$,onOpenChange:q,children:e.jsx(N,{className:"max-w-6xl p-0 overflow-hidden",children:s?.movieFile&&$&&e.jsx(Ce,{mediaType:"movie",mediaFileId:s.movieFile.id,title:s.title})})})]}):e.jsxs(g,{title:"Not Found",children:[e.jsx(j,{title:"Not Found"}),e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Movie not found"})})]})}Te.__docgenInfo={description:"",methods:[],displayName:"MovieDetail"};export{Te as default};
