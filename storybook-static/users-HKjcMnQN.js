import{j as e}from"./jsx-runtime-u17CrQMm.js";import{t as a,H as Z,e as n,C as L}from"./app-CFoDCqX-.js";import{A as ee}from"./app-layout-CTvh2ZE0.js";import{B as i}from"./button-B9kPMW4q.js";import{I as o}from"./input-Bw95PIWX.js";import{C as se,a as ae,b as re,c as te,d as ie}from"./card-BT9UEfea.js";import{B as M}from"./badge-B6bn15vN.js";import{D as w,a as S,b as U,c as F,d as b,e as k}from"./dialog-CQTA4pg1.js";import{T as le,a as ne,b as J,c as u,d as ce,e as j}from"./table-B1mxUS1v.js";import{H as A,w as oe,a5 as de,ad as me,q as he}from"./index.min-fvaCWwiU.js";import{S as p}from"./spinner-McTJFRVv.js";import{r}from"./app-BHuVDAkc.js";import"./preload-helper-PPVm8Dsz.js";import"./client-Bx265bNG.js";import"./index-CYxWbFTv.js";import"./index-D5-0xbEa.js";import"./utils-CDN07tui.js";import"./skeleton-A7behTLO.js";import"./media-status-badge-DETbNkVM.js";import"./useRenderElement-D0Q1kVud.js";import"./useBaseUiId-BvJSLVy2.js";import"./useValueAsRef-GoV-SdOe.js";import"./media-teaser-CTZEtwns.js";import"./check-BEKQ83Eb.js";import"./createLucideIcon-GXN1tXoc.js";import"./useLabelableId-CyGgmgle.js";import"./valueToPercent-CmxdyyhM.js";import"./slot-CUYGZ4Fv.js";import"./hamster-icon-DOXrnfMg.js";function xe(){const[_,$]=r.useState([]),[q,Q]=r.useState(!0),[Y,f]=r.useState(!1),[t,d]=r.useState({fullName:"",email:"",password:"",isAdmin:!1}),[E,P]=r.useState(!1),[D,g]=r.useState(null),[c,C]=r.useState({fullName:"",email:"",isAdmin:!1}),[H,O]=r.useState(!1),[m,N]=r.useState(null),[R,z]=r.useState(!1),[h,y]=r.useState(null),[v,T]=r.useState(""),[B,I]=r.useState(!1),x=r.useCallback(async()=>{try{const s=await fetch("/api/v1/users");s.ok&&$(await s.json())}catch{a.error("Failed to load users")}finally{Q(!1)}},[]);r.useEffect(()=>{x()},[x]);const G=async()=>{if(!t.email||!t.password||!t.fullName){a.error("Please fill in all required fields");return}P(!0);try{const s=await fetch("/api/v1/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(s.ok)a.success("User created"),f(!1),d({fullName:"",email:"",password:"",isAdmin:!1}),x();else{const l=await s.json();a.error(l.errors?.[0]?.message||l.error||"Failed to create user")}}catch{a.error("Failed to create user")}finally{P(!1)}},K=async()=>{if(D){O(!0);try{const s=await fetch(`/api/v1/users/${D.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(s.ok)a.success("User updated"),g(null),x();else{const l=await s.json();a.error(l.errors?.[0]?.message||l.error||"Failed to update user")}}catch{a.error("Failed to update user")}finally{O(!1)}}},V=async()=>{if(m){z(!0);try{const s=await fetch(`/api/v1/users/${m.id}`,{method:"DELETE"});if(s.ok)a.success("User deleted"),N(null),x();else{const l=await s.json();a.error(l.error||"Failed to delete user")}}catch{a.error("Failed to delete user")}finally{z(!1)}}},W=async()=>{if(h){if(!v||v.length<8){a.error("Password must be at least 8 characters");return}I(!0);try{const s=await fetch(`/api/v1/users/${h.id}/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newPassword:v})});if(s.ok)a.success("Password reset successfully"),y(null),T("");else{const l=await s.json();a.error(l.error||"Failed to reset password")}}catch{a.error("Failed to reset password")}finally{I(!1)}}},X=s=>{g(s),C({fullName:s.fullName||"",email:s.email,isAdmin:s.isAdmin})};return e.jsxs(ee,{title:"User Management",children:[e.jsx(Z,{title:"User Management"}),e.jsx("div",{className:"space-y-6",children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(re,{children:"Users"}),e.jsx(te,{children:"Manage user accounts and permissions."})]}),e.jsxs(i,{onClick:()=>f(!0),children:[e.jsx(A,{icon:oe,className:"mr-2 size-4"}),"Add User"]})]})}),e.jsx(ie,{children:q?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(p,{})}):e.jsxs(le,{children:[e.jsx(ne,{children:e.jsxs(J,{children:[e.jsx(u,{children:"Name"}),e.jsx(u,{children:"Email"}),e.jsx(u,{children:"Role"}),e.jsx(u,{children:"Created"}),e.jsx(u,{className:"text-right",children:"Actions"})]})}),e.jsx(ce,{children:_.map(s=>e.jsxs(J,{children:[e.jsx(j,{className:"font-medium",children:s.fullName||e.jsx("span",{className:"text-muted-foreground",children:"No name"})}),e.jsx(j,{children:s.email}),e.jsx(j,{children:s.isAdmin?e.jsx(M,{className:"bg-primary",children:"Admin"}):e.jsx(M,{variant:"secondary",children:"User"})}),e.jsx(j,{className:"text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString()}),e.jsx(j,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>X(s),children:e.jsx(A,{icon:de,className:"size-4"})}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>{y(s),T("")},children:e.jsx(A,{icon:me,className:"size-4"})}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>N(s),children:e.jsx(A,{icon:he,className:"size-4 text-destructive"})})]})})]},s.id))})]})})]})}),e.jsx(w,{open:Y,onOpenChange:f,children:e.jsxs(S,{children:[e.jsxs(U,{children:[e.jsx(F,{children:"Create User"}),e.jsx(b,{children:"Add a new user account."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"create-name",children:"Full Name"}),e.jsx(o,{id:"create-name",value:t.fullName,onChange:s=>d({...t,fullName:s.target.value}),placeholder:"John Doe"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"create-email",children:"Email"}),e.jsx(o,{id:"create-email",type:"email",value:t.email,onChange:s=>d({...t,email:s.target.value}),placeholder:"user@example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"create-password",children:"Password"}),e.jsx(o,{id:"create-password",type:"password",value:t.password,onChange:s=>d({...t,password:s.target.value}),placeholder:"Minimum 8 characters"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{id:"create-admin",checked:t.isAdmin,onCheckedChange:s=>d({...t,isAdmin:s===!0})}),e.jsx(n,{htmlFor:"create-admin",children:"Administrator"})]})]}),e.jsxs(k,{children:[e.jsx(i,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsxs(i,{onClick:G,disabled:E,children:[E&&e.jsx(p,{className:"mr-2"}),"Create User"]})]})]})}),e.jsx(w,{open:!!D,onOpenChange:s=>!s&&g(null),children:e.jsxs(S,{children:[e.jsxs(U,{children:[e.jsx(F,{children:"Edit User"}),e.jsx(b,{children:"Update user account details."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-name",children:"Full Name"}),e.jsx(o,{id:"edit-name",value:c.fullName,onChange:s=>C({...c,fullName:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-email",children:"Email"}),e.jsx(o,{id:"edit-email",type:"email",value:c.email,onChange:s=>C({...c,email:s.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{id:"edit-admin",checked:c.isAdmin,onCheckedChange:s=>C({...c,isAdmin:s===!0})}),e.jsx(n,{htmlFor:"edit-admin",children:"Administrator"})]})]}),e.jsxs(k,{children:[e.jsx(i,{variant:"outline",onClick:()=>g(null),children:"Cancel"}),e.jsxs(i,{onClick:K,disabled:H,children:[H&&e.jsx(p,{className:"mr-2"}),"Save Changes"]})]})]})}),e.jsx(w,{open:!!m,onOpenChange:s=>!s&&N(null),children:e.jsxs(S,{children:[e.jsxs(U,{children:[e.jsx(F,{children:"Delete User"}),e.jsxs(b,{children:["Are you sure you want to delete ",m?.fullName||m?.email,"? This action cannot be undone."]})]}),e.jsxs(k,{children:[e.jsx(i,{variant:"outline",onClick:()=>N(null),children:"Cancel"}),e.jsxs(i,{variant:"destructive",onClick:V,disabled:R,children:[R&&e.jsx(p,{className:"mr-2"}),"Delete User"]})]})]})}),e.jsx(w,{open:!!h,onOpenChange:s=>!s&&y(null),children:e.jsxs(S,{children:[e.jsxs(U,{children:[e.jsx(F,{children:"Reset Password"}),e.jsxs(b,{children:["Set a new password for ",h?.fullName||h?.email,"."]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"reset-password",children:"New Password"}),e.jsx(o,{id:"reset-password",type:"password",value:v,onChange:s=>T(s.target.value),placeholder:"Minimum 8 characters"})]})}),e.jsxs(k,{children:[e.jsx(i,{variant:"outline",onClick:()=>y(null),children:"Cancel"}),e.jsxs(i,{onClick:W,disabled:B,children:[B&&e.jsx(p,{className:"mr-2"}),"Reset Password"]})]})]})})]})}xe.__docgenInfo={description:"",methods:[],displayName:"UsersSettings"};export{xe as default};
