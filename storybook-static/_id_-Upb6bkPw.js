import{j as e}from"./jsx-runtime-u17CrQMm.js";import{f as ne,g as ce,t,r as _,H as T,L as Q}from"./app-CFoDCqX-.js";import{A as k,D as oe,a as de,b as me,c as C,d as he}from"./app-layout-CTvh2ZE0.js";import{B as o}from"./button-B9kPMW4q.js";import{B as N}from"./badge-B6bn15vN.js";import{C as f,d as K}from"./card-BT9UEfea.js";import{S as w}from"./skeleton-A7behTLO.js";import{P as xe}from"./progress-Dv5gXtGp.js";import{T as ue,a as je,b as A,c as D}from"./tabs-BOg1k8aW.js";import{T as $,a as z,b as x,c as i,d as P,e as l}from"./table-B1mxUS1v.js";import{H as n,i as fe,F as pe,e as ge,p as Ne,f as V,k as we,A as b,G as W,n as be,J as ye,q as ve}from"./index.min-fvaCWwiU.js";import{S as q}from"./spinner-McTJFRVv.js";import{r as d}from"./app-BHuVDAkc.js";import"./preload-helper-PPVm8Dsz.js";import"./client-Bx265bNG.js";import"./index-CYxWbFTv.js";import"./index-D5-0xbEa.js";import"./utils-CDN07tui.js";import"./dialog-CQTA4pg1.js";import"./createLucideIcon-GXN1tXoc.js";import"./media-status-badge-DETbNkVM.js";import"./useRenderElement-D0Q1kVud.js";import"./useBaseUiId-BvJSLVy2.js";import"./useValueAsRef-GoV-SdOe.js";import"./media-teaser-CTZEtwns.js";import"./check-BEKQ83Eb.js";import"./useLabelableId-CyGgmgle.js";import"./valueToPercent-CmxdyyhM.js";import"./slot-CUYGZ4Fv.js";import"./hamster-icon-DOXrnfMg.js";import"./input-Bw95PIWX.js";function Fe(){const{url:X}=ne(),h=X.split("/").pop(),u=ce(),[a,M]=d.useState(null),[Y,Z]=d.useState(!0),[p,ee]=d.useState([]),[R,I]=d.useState(!1),[j,B]=d.useState(!1),[H,L]=d.useState(null),[y,E]=d.useState(!1);d.useEffect(()=>{U()},[h]);const U=async()=>{try{const s=await fetch(`/api/v1/albums/${h}`);if(s.ok){const r=await s.json();M(r)}else s.status===404&&(t.error("Album not found"),_.visit("/library?tab=music"))}catch(s){console.error("Failed to fetch album:",s),t.error("Failed to load album")}finally{Z(!1)}},se=async()=>{if(!a)return;const s=a.requested;if(s&&a.trackFiles.length>0){t.error("Album has downloaded files. Delete files first before unrequesting.");return}try{const r=await fetch(`/api/v1/albums/${h}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({requested:!s})}),c=await r.json();r.ok?c.deleted?(t.success("Removed from library"),_.visit("/library?tab=music")):(M({...a,requested:!s}),t.success(s?"Album unrequested":"Album requested")):c.hasFile?t.error("Album has downloaded files. Delete files first before unrequesting."):t.error(c.error||"Failed to update album")}catch(r){console.error("Failed to update album:",r),t.error("Failed to update album")}},ae=async()=>{I(!0);try{const s=await fetch(`/api/v1/albums/${h}/releases`);if(s.ok){const r=await s.json();ee(r)}}catch(s){console.error("Failed to search releases:",s),t.error("Failed to search releases")}finally{I(!1)}},O=async s=>{B(!0);try{const r=new URL(`/api/v1/albums/${h}/download`,window.location.origin);s&&r.searchParams.set("trackId",s.toString());const c=await fetch(r.toString(),{method:"POST"});if(c.ok){const m=await c.json();t.success(`Download started: ${m.release?.title||m.title}`)}else{const m=await c.json();t.error(m.error||(s?"No single/EP found for this track":"Failed to find releases"))}}catch(r){console.error("Failed to download:",r),t.error("Failed to download")}finally{B(!1)}},re=async s=>{L(s.id);try{const r=await fetch("/api/v1/queue/grab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:s.title,downloadUrl:s.downloadUrl,size:s.size,albumId:a?.id,indexerId:s.indexerId,indexerName:s.indexer,guid:s.id})});if(r.ok)t.success("Download started");else{const c=await r.json();t.error(c.error||"Failed to grab release")}}catch(r){console.error("Failed to grab release:",r),t.error("Failed to grab release")}finally{L(null)}},te=async()=>{if(a){E(!0);try{const s=await fetch(`/api/v1/albums/${h}/enrich`,{method:"POST"});if(s.ok){const r=await s.json();r.enriched?(t.success("Album enriched with MusicBrainz data"),U()):t.warning(r.message||"No matching album found")}else{const r=await s.json();t.error(r.error||"Failed to enrich")}}catch(s){console.error("Failed to enrich album:",s),t.error("Failed to enrich album")}finally{E(!1)}}},G=(s,r)=>{!a||!s.hasFile||u.playAlbum(a.id)},ie=()=>{a&&u.playAlbum(a.id)},g=a?.tracks.length||0,v=a?.tracks.filter(s=>s.hasFile).length||0,F=g>0?Math.round(v/g*100):0,le=s=>{if(!s)return"--:--";const r=Math.floor(s/6e4),c=Math.floor(s%6e4/1e3);return`${r}:${c.toString().padStart(2,"0")}`},J=s=>s>=1073741824?`${(s/1073741824).toFixed(1)} GB`:s>=1048576?`${(s/1048576).toFixed(0)} MB`:`${(s/1024).toFixed(0)} KB`;return Y?e.jsxs(k,{title:"Loading...",children:[e.jsx(T,{title:"Loading..."}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsx(w,{className:"h-48 w-48 rounded-lg"}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(w,{className:"h-8 w-1/3"}),e.jsx(w,{className:"h-4 w-1/4"}),e.jsx(w,{className:"h-4 w-1/2"})]})]})})]}):a?e.jsxs(k,{title:a.title,actions:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(o,{variant:"outline",asChild:!0,children:e.jsxs(Q,{href:`/artist/${a.artistId}`,children:[e.jsx(n,{icon:be,className:"h-4 w-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Back to Artist"})]})}),v>0&&e.jsxs(o,{variant:"outline",onClick:ie,children:[e.jsx(n,{icon:V,className:"h-4 w-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Play"})]}),e.jsxs(o,{onClick:O,disabled:j||F===100,children:[j?e.jsx(q,{className:"md:mr-2"}):e.jsx(n,{icon:b,className:"h-4 w-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:j?"Searching...":"Search releases"})]}),e.jsxs(oe,{children:[e.jsx(de,{asChild:!0,children:e.jsx(o,{variant:"outline",size:"icon",children:e.jsx(n,{icon:ye,className:"h-4 w-4"})})}),e.jsxs(me,{align:"end",children:[!a.musicbrainzId&&e.jsxs(C,{onClick:te,disabled:y,children:[e.jsx(n,{icon:b,className:`h-4 w-4 mr-2 ${y?"animate-spin":""}`}),y?"Enriching...":"Enrich from MusicBrainz"]}),e.jsxs(C,{onClick:ae,disabled:R,children:[e.jsx(n,{icon:b,className:"h-4 w-4 mr-2"}),R?"Searching...":"Manual Search"]}),e.jsx(he,{}),e.jsxs(C,{className:"text-destructive",onClick:se,children:[e.jsx(n,{icon:ve,className:"h-4 w-4 mr-2"}),"Remove from Library"]})]})]})]}),children:[e.jsx(T,{title:`${a.title} - ${a.artistName}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"w-full md:w-48 aspect-square md:aspect-auto md:h-48 bg-muted rounded-lg overflow-hidden flex-shrink-0",children:a.imageUrl?e.jsx("img",{src:a.imageUrl,alt:a.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(n,{icon:fe,className:"h-16 w-16 text-muted-foreground/50"})})}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("h1",{className:"text-2xl font-bold",children:a.title})}),e.jsx(Q,{href:`/artist/${a.artistId}`,className:"text-muted-foreground hover:text-primary transition-colors",children:a.artistName})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-2 text-sm",children:[a.releaseDate&&e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(n,{icon:pe,className:"h-4 w-4"}),a.releaseDate]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(n,{icon:ge,className:"h-4 w-4"}),g," tracks"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[v," of ",g," tracks"]}),e.jsxs("span",{className:"font-medium",children:[F,"%"]})]}),e.jsx(xe,{value:F,className:"h-2"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(N,{className:"capitalize",children:a.albumType}),a.secondaryTypes.map(s=>e.jsx(N,{variant:"outline",className:"capitalize",children:s},s))]})]})]}),e.jsxs(ue,{defaultValue:"tracks",className:"space-y-4",children:[e.jsxs(je,{children:[e.jsx(A,{value:"tracks",children:"Tracks"}),e.jsx(A,{value:"files",children:"Files"}),p.length>0&&e.jsxs(A,{value:"search",children:["Search Results (",p.length,")"]})]}),e.jsx(D,{value:"tracks",children:a.tracks.length===0?e.jsx(f,{children:e.jsx(K,{className:"flex flex-col items-center justify-center py-12 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No tracks available. Try refreshing the artist metadata."})})}):e.jsx(f,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs($,{children:[e.jsx(z,{children:e.jsxs(x,{children:[e.jsx(i,{className:"w-12"}),e.jsx(i,{className:"w-12",children:"#"}),e.jsx(i,{children:"Title"}),e.jsx(i,{className:"w-24 text-right",children:"Duration"}),e.jsx(i,{className:"w-16 text-center",children:"Status"})]})}),e.jsx(P,{children:a.tracks.map((s,r)=>{const m=u.currentTrack?.trackId===s.id&&u.isPlaying;return e.jsxs(x,{className:s.hasFile?"cursor-pointer hover:bg-muted/50":"",onClick:()=>s.hasFile&&G(s),children:[e.jsx(l,{children:s.hasFile&&e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:S=>{S.stopPropagation(),m?u.pause():G(s)},children:e.jsx(n,{icon:m?Ne:V,className:"h-4 w-4"})})}),e.jsx(l,{className:"text-muted-foreground",children:s.discNumber>1?`${s.discNumber}-${s.trackNumber}`:s.trackNumber}),e.jsx(l,{className:"font-medium",children:s.title}),e.jsx(l,{className:"text-right text-muted-foreground",children:le(s.durationMs)}),e.jsx(l,{className:"text-center",children:s.hasFile?e.jsx(n,{icon:we,className:"h-5 w-5 text-green-500 mx-auto"}):e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:S=>{S.stopPropagation(),O(s.id)},disabled:j,title:"Search for this track (single/EP)",children:j?e.jsx(q,{}):e.jsx(n,{icon:b,className:"h-4 w-4"})})})]},s.id)})})]})})})}),e.jsx(D,{value:"files",children:a.trackFiles.length===0?e.jsx(f,{children:e.jsx(K,{className:"flex flex-col items-center justify-center py-12 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No files imported for this album yet."})})}):e.jsx(f,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs($,{children:[e.jsx(z,{children:e.jsxs(x,{children:[e.jsx(i,{children:"Path"}),e.jsx(i,{className:"w-24",children:"Quality"}),e.jsx(i,{className:"w-24",children:"Format"}),e.jsx(i,{className:"w-24 text-right",children:"Size"}),e.jsx(i,{className:"w-16"})]})}),e.jsx(P,{children:a.trackFiles.map(s=>e.jsxs(x,{children:[e.jsx(l,{className:"font-mono text-sm truncate max-w-[200px] sm:max-w-xs",children:s.path}),e.jsx(l,{children:s.quality&&e.jsx(N,{variant:"outline",children:s.quality})}),e.jsx(l,{className:"uppercase text-muted-foreground",children:s.format}),e.jsx(l,{className:"text-right text-muted-foreground",children:J(s.size)}),e.jsx(l,{children:e.jsx(o,{variant:"outline",size:"sm",asChild:!0,children:e.jsx("a",{href:s.downloadUrl,download:!0,children:e.jsx(n,{icon:W,className:"h-4 w-4"})})})})]},s.id))})]})})})}),p.length>0&&e.jsx(D,{value:"search",children:e.jsx(f,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs($,{children:[e.jsx(z,{children:e.jsxs(x,{children:[e.jsx(i,{children:"Release"}),e.jsx(i,{className:"w-32",children:"Indexer"}),e.jsx(i,{className:"w-24",children:"Quality"}),e.jsx(i,{className:"w-24 text-right",children:"Size"}),e.jsx(i,{className:"w-24 text-right",children:"Grabs"}),e.jsx(i,{className:"w-24"})]})}),e.jsx(P,{children:p.map(s=>e.jsxs(x,{children:[e.jsx(l,{className:"font-medium max-w-md truncate",children:s.title}),e.jsx(l,{className:"text-muted-foreground",children:s.indexer}),e.jsx(l,{children:s.quality&&e.jsx(N,{variant:"outline",children:s.quality})}),e.jsx(l,{className:"text-right text-muted-foreground",children:J(s.size)}),e.jsx(l,{className:"text-right text-muted-foreground",children:s.grabs??s.seeders??"-"}),e.jsx(l,{children:e.jsx(o,{size:"sm",variant:"outline",onClick:()=>re(s),disabled:H===s.id,children:H===s.id?e.jsx(q,{}):e.jsx(n,{icon:W,className:"h-4 w-4"})})})]},s.id))})]})})})})]})]})]}):e.jsxs(k,{title:"Not Found",children:[e.jsx(T,{title:"Not Found"}),e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Album not found"})})]})}Fe.__docgenInfo={description:"",methods:[],displayName:"AlbumDetail"};export{Fe as default};
