import{j as e}from"./jsx-runtime-u17CrQMm.js";import{t as n,H as Te,e as i,S as $e,a as Ae,b as Ie,c as Oe,d as P,C as ae}from"./app-CFoDCqX-.js";import{A as Ee}from"./app-layout-CTvh2ZE0.js";import{B as c}from"./button-B9kPMW4q.js";import{I as u}from"./input-Bw95PIWX.js";import{C as He,a as Ke,b as Le,c as Re,d as Ue}from"./card-BT9UEfea.js";import{B as T}from"./badge-B6bn15vN.js";import{D as $,a as A,b as I,c as O,d as E,e as H}from"./dialog-CQTA4pg1.js";import{T as te,a as oe,b as S,c as j,d as re,e as f}from"./table-B1mxUS1v.js";import{H as h,x as K,a5 as qe,k as Ge,V as Me,q as Ve,a6 as Ze,n as Je,a7 as _e,a8 as Qe,P as Ye,w as We}from"./index.min-fvaCWwiU.js";import{S as y}from"./spinner-McTJFRVv.js";import{r as o}from"./app-BHuVDAkc.js";import{F as Xe}from"./folder-browser-szzA91qX.js";import"./preload-helper-PPVm8Dsz.js";import"./client-Bx265bNG.js";import"./index-CYxWbFTv.js";import"./index-D5-0xbEa.js";import"./utils-CDN07tui.js";import"./skeleton-A7behTLO.js";import"./media-status-badge-DETbNkVM.js";import"./useRenderElement-D0Q1kVud.js";import"./useBaseUiId-BvJSLVy2.js";import"./useValueAsRef-GoV-SdOe.js";import"./media-teaser-CTZEtwns.js";import"./check-BEKQ83Eb.js";import"./createLucideIcon-GXN1tXoc.js";import"./useLabelableId-CyGgmgle.js";import"./valueToPercent-CmxdyyhM.js";import"./slot-CUYGZ4Fv.js";import"./hamster-icon-DOXrnfMg.js";const es=m=>m==="sabnzbd"||m==="nzbget",ne=m=>m==="qbittorrent"||m==="transmission",ss=m=>{switch(m){case"sabnzbd":return 8080;case"nzbget":return 6789;case"qbittorrent":return 8080;case"transmission":return 9091;default:return 8080}},le={name:"",type:"sabnzbd",host:"localhost",port:8080,apiKey:"",username:"",password:"",useSsl:!1,category:"",urlBase:"",enabled:!0,priority:1,removeCompletedDownloads:!0,removeFailedDownloads:!0,remotePath:"",localPath:""};function as(){const[m,ie]=o.useState([]),[de,ce]=o.useState(!0),[he,v]=o.useState(!1),[me,b]=o.useState(!1),[p,L]=o.useState(null),[a,l]=o.useState(le),[R,U]=o.useState(!1),[q,G]=o.useState(!1),[x,N]=o.useState(null),[M,V]=o.useState(!1),[C,D]=o.useState(!1),[pe,F]=o.useState(!1),[w,xe]=o.useState(null),[Z,ue]=o.useState([]),[J,je]=o.useState(""),[ts,fe]=o.useState(""),[ge,we]=o.useState(!1),[ye,ve]=o.useState(""),[Ne,_]=o.useState(!1),[Q,B]=o.useState(null),[Y,W]=o.useState(null),[X,ee]=o.useState(null);o.useEffect(()=>{k()},[]);const k=async()=>{try{const s=await fetch("/api/v1/downloadclients");if(s.ok){const t=await s.json();ie(t)}}catch(s){console.error("Failed to fetch clients:",s),n.error("Failed to load download clients")}finally{ce(!1)}},z=async(s,t)=>{t||(xe(s),F(!0)),_(!0),B(null);try{const r=t?`/api/v1/downloadclients/${s.id}/browse?path=${encodeURIComponent(t)}`:`/api/v1/downloadclients/${s.id}/browse`,g=await fetch(r);if(g.ok){const d=await g.json();ue(d.items),je(d.path),fe(d.basePath),we(d.canGoUp),ve(d.parentPath)}else{const d=await g.json();B(d.error||"Failed to browse downloads")}}catch(r){console.error("Failed to browse downloads:",r),B("Failed to connect to server")}finally{_(!1)}},se=s=>{w&&z(w,s)},be=async s=>{if(w){W(s);try{const t=await fetch(`/api/v1/downloadclients/${w.id}/import`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:s})}),r=await t.json();t.ok&&r.success?(n.success(r.message||`Imported ${r.filesImported} files`),z(w,J)):n.error(r.error||r.errors?.[0]||"Import failed")}catch(t){console.error("Failed to import:",t),n.error("Failed to import")}finally{W(null)}}},Ce=async(s,t,r)=>{if(w){ee(s);try{const g=`/api/v1/downloadclients/${w.id}/download?path=${encodeURIComponent(s)}`,d=document.createElement("a");d.href=g,d.download=r?`${t}.zip`:t,document.body.appendChild(d),d.click(),document.body.removeChild(d),n.success(`Downloading ${r?`${t}.zip`:t}`)}catch(g){console.error("Failed to download:",g),n.error("Failed to start download")}finally{setTimeout(()=>ee(null),500)}}},Pe=s=>s>=1073741824?`${(s/1073741824).toFixed(1)} GB`:s>=1048576?`${(s/1048576).toFixed(0)} MB`:s>=1024?`${(s/1024).toFixed(0)} KB`:`${s} B`,Se=s=>{if(!s)return"-";const t=new Date(s);return t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},De=()=>{L(null),l(le),N(null),D(!1),v(!0)},Fe=s=>{L(s),l({name:s.name,type:s.type,host:s.host,port:s.port,apiKey:s.apiKey||"",username:s.username||"",password:s.password||"",useSsl:s.useSsl,category:s.category||"",urlBase:s.urlBase||"",enabled:s.enabled,priority:s.priority,removeCompletedDownloads:s.removeCompletedDownloads,removeFailedDownloads:s.removeFailedDownloads,remotePath:s.remotePath||"",localPath:s.localPath||""}),N(null),D(!1),v(!0)},Be=async()=>{G(!0),N(null);try{const t=await(await fetch("/api/v1/downloadclients/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:a.type,host:a.host,port:a.port,apiKey:a.apiKey,username:a.username,password:a.password,useSsl:a.useSsl,urlBase:a.urlBase})})).json();N(t),t.success?(n.success(`Connected to ${a.type} v${t.version}`),t.remotePath&&(t.pathAccessible?(n.info("Download path is directly accessible - no path mapping needed"),l(r=>({...r,remotePath:"",localPath:""}))):(n.warning("Download path not accessible locally - please configure path mapping"),l(r=>({...r,remotePath:r.remotePath||t.remotePath}))))):n.error(t.error||"Connection failed")}catch{N({success:!1,error:"Connection failed"}),n.error("Connection failed")}finally{G(!1)}},ke=async()=>{if(!a.name||!a.host){n.error("Please fill in all required fields");return}if(es(a.type)&&a.type==="sabnzbd"&&!a.apiKey){n.error("API Key is required for SABnzbd");return}if(a.type==="nzbget"&&!a.username){n.error("Username is required for NZBGet");return}U(!0);try{const s=p?`/api/v1/downloadclients/${p.id}`:"/api/v1/downloadclients",r=await fetch(s,{method:p?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(r.ok)n.success(p?"Download client updated":"Download client added"),v(!1),k();else{const g=await r.json();n.error(g.error||"Failed to save")}}catch(s){console.error("Failed to save:",s),n.error("Failed to save download client")}finally{U(!1)}},ze=async()=>{if(p){V(!0);try{(await fetch(`/api/v1/downloadclients/${p.id}`,{method:"DELETE"})).ok?(n.success("Download client deleted"),b(!1),v(!1),k()):n.error("Failed to delete download client")}catch(s){console.error("Failed to delete:",s),n.error("Failed to delete download client")}finally{V(!1)}}};return e.jsxs(Ee,{title:"Download Clients",actions:e.jsxs(c,{onClick:De,children:[e.jsx(h,{icon:We,className:"h-4 w-4 mr-2"}),"Add Client"]}),children:[e.jsx(Te,{title:"Download Clients"}),e.jsx("div",{className:"space-y-6",children:e.jsxs(He,{children:[e.jsxs(Ke,{children:[e.jsx(Le,{children:"Download Clients"}),e.jsx(Re,{children:"Configure download clients to process NZB and torrent files."})]}),e.jsx(Ue,{children:de?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(y,{className:"size-6 text-muted-foreground"})}):m.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No download clients configured."}),e.jsx("p",{className:"mt-2",children:"Add a download client to start downloading."})]}):e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(S,{children:[e.jsx(j,{children:"Name"}),e.jsx(j,{children:"Type"}),e.jsx(j,{children:"Host"}),e.jsx(j,{children:"Status"}),e.jsx(j,{className:"w-24"})]})}),e.jsx(re,{children:m.map(s=>e.jsxs(S,{children:[e.jsx(f,{className:"font-medium",children:s.name}),e.jsx(f,{children:e.jsx(T,{variant:"outline",className:"uppercase",children:s.type})}),e.jsxs(f,{className:"text-muted-foreground",children:[s.useSsl?"https":"http","://",s.host,":",s.port]}),e.jsx(f,{children:s.enabled?e.jsx(T,{variant:"default",className:"bg-green-500",children:"Enabled"}):e.jsx(T,{variant:"secondary",children:"Disabled"})}),e.jsx(f,{children:e.jsxs("div",{className:"flex gap-1",children:[s.localPath&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>z(s),title:"Browse downloads",children:e.jsx(h,{icon:K,className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>Fe(s),children:e.jsx(h,{icon:qe,className:"h-4 w-4"})})]})})]},s.id))})]})})]})}),e.jsx($,{open:he,onOpenChange:v,children:e.jsxs(A,{className:C?"max-w-2xl":"max-w-lg",children:[e.jsxs(I,{children:[e.jsx(O,{children:p?"Edit Download Client":"Add Download Client"}),e.jsx(E,{children:"Configure your download client connection settings."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"name",children:"Name *"}),e.jsx(u,{id:"name",value:a.name,onChange:s=>l({...a,name:s.target.value}),placeholder:"My SABnzbd"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"type",children:"Type"}),e.jsxs($e,{value:a.type,onValueChange:s=>l({...a,type:s,port:ss(s)}),children:[e.jsx(Ae,{id:"type",children:e.jsx(Ie,{})}),e.jsxs(Oe,{children:[e.jsx(P,{value:"sabnzbd",children:"SABnzbd"}),e.jsx(P,{value:"nzbget",children:"NZBGet"}),e.jsx(P,{value:"qbittorrent",children:"qBittorrent"}),e.jsx(P,{value:"transmission",children:"Transmission"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(i,{htmlFor:"host",children:"Host *"}),e.jsx(u,{id:"host",value:a.host,onChange:s=>l({...a,host:s.target.value}),placeholder:"localhost"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"port",children:"Port *"}),e.jsx(u,{id:"port",type:"number",value:a.port,onChange:s=>l({...a,port:parseInt(s.target.value)||8080})})]})]}),a.type==="sabnzbd"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"apiKey",children:"API Key *"}),e.jsx(u,{id:"apiKey",type:"password",value:a.apiKey,onChange:s=>l({...a,apiKey:s.target.value}),placeholder:"Your API key"})]}),(a.type==="nzbget"||ne(a.type))&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"username",children:["Username ",a.type==="nzbget"?"*":""]}),e.jsx(u,{id:"username",value:a.username,onChange:s=>l({...a,username:s.target.value}),placeholder:a.type==="qbittorrent"?"admin":"nzbget"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"password",children:"Password"}),e.jsx(u,{id:"password",type:"password",value:a.password,onChange:s=>l({...a,password:s.target.value}),placeholder:"Password"})]})]}),a.type==="transmission"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"urlBase",children:"URL Base"}),e.jsx(u,{id:"urlBase",value:a.urlBase,onChange:s=>l({...a,urlBase:s.target.value}),placeholder:"/transmission (optional)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Usually /transmission - only change if you modified it"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"category",children:"Category"}),e.jsx(u,{id:"category",value:a.category,onChange:s=>l({...a,category:s.target.value}),placeholder:ne(a.type)?"hamster (optional)":"music (optional)"})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-base font-medium",children:"Remote Path Mapping"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Required if the download client runs in Docker with different paths than Hamster."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"remotePath",children:"Remote Path"}),e.jsx(u,{id:"remotePath",value:a.remotePath,onChange:s=>l({...a,remotePath:s.target.value}),placeholder:"/downloads"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Path as SABnzbd sees it (auto-detected when you test connection)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{htmlFor:"localPath",children:"Local Path"}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",onClick:()=>D(!C),className:"h-7 text-xs",children:C?"Hide Browser":"Browse..."})]}),C?e.jsx("div",{className:"rounded-lg border bg-muted/30 p-3",children:e.jsx(Xe,{value:a.localPath,onChange:s=>l({...a,localPath:s}),hideSelectButton:!0})}):e.jsxs(e.Fragment,{children:[e.jsx(u,{id:"localPath",value:a.localPath,onChange:s=>l({...a,localPath:s.target.value}),placeholder:"/mnt/downloads"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Path as Hamster sees it"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{id:"useSsl",checked:a.useSsl,onCheckedChange:s=>l({...a,useSsl:s})}),e.jsx(i,{htmlFor:"useSsl",className:"font-normal cursor-pointer",children:"Use SSL"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{id:"enabled",checked:a.enabled,onCheckedChange:s=>l({...a,enabled:s})}),e.jsx(i,{htmlFor:"enabled",className:"font-normal cursor-pointer",children:"Enabled"})]}),x&&e.jsxs("div",{className:`flex flex-col gap-2 p-3 rounded-md ${x.success?"bg-green-500/10 text-green-600":"bg-destructive/10 text-destructive"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{icon:x.success?Ge:Me,className:"h-5 w-5"}),e.jsx("span",{children:x.success?`Connected successfully (v${x.version})`:x.error||"Connection failed"})]}),x.success&&x.remotePath&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Complete folder: "}),e.jsx("code",{className:"bg-muted px-1 rounded",children:x.remotePath}),x.pathAccessible?e.jsx("span",{className:"text-green-600 ml-2",children:"(accessible)"}):e.jsx("span",{className:"text-orange-500 ml-2",children:"(needs path mapping)"})]})]})]}),e.jsxs(H,{className:"flex-col sm:flex-row gap-2",children:[p&&e.jsxs(c,{variant:"destructive",onClick:()=>b(!0),className:"sm:mr-auto",children:[e.jsx(h,{icon:Ve,className:"h-4 w-4 mr-2"}),"Delete"]}),e.jsxs(c,{variant:"outline",onClick:Be,disabled:q||!a.host,children:[q?e.jsx(y,{className:"mr-2"}):e.jsx(h,{icon:Ze,className:"h-4 w-4 mr-2"}),"Test"]}),e.jsxs(c,{onClick:ke,disabled:R,children:[R?e.jsx(y,{className:"mr-2"}):null,p?"Save":"Add"]})]})]})}),e.jsx($,{open:me,onOpenChange:b,children:e.jsxs(A,{children:[e.jsxs(I,{children:[e.jsxs(O,{children:["Delete ",p?.name,"?"]}),e.jsx(E,{children:"This will remove the download client configuration. Active downloads will not be affected."})]}),e.jsxs(H,{children:[e.jsx(c,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsxs(c,{variant:"destructive",onClick:ze,disabled:M,children:[M?e.jsx(y,{className:"mr-2"}):null,"Delete"]})]})]})}),e.jsx($,{open:pe,onOpenChange:F,children:e.jsxs(A,{className:"max-w-3xl max-h-[80vh] flex flex-col",children:[e.jsxs(I,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[ge&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>se(ye),className:"h-8 w-8 p-0",children:e.jsx(h,{icon:Je,className:"h-4 w-4"})}),"Downloads - ",w?.name]}),e.jsx(E,{className:"font-mono text-xs truncate",children:J})]}),e.jsx("div",{className:"flex-1 overflow-auto min-h-[300px]",children:Ne?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(y,{className:"size-6 text-muted-foreground"})}):Q?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("p",{className:"text-destructive mb-2",children:Q}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Make sure the local path is configured and accessible."})]}):Z.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center text-muted-foreground",children:[e.jsx(h,{icon:K,className:"h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{children:"No files in downloads folder"})]}):e.jsxs(te,{children:[e.jsx(oe,{children:e.jsxs(S,{children:[e.jsx(j,{className:"w-10"}),e.jsx(j,{children:"Name"}),e.jsx(j,{className:"w-24 text-right",children:"Size"}),e.jsx(j,{className:"w-40 text-right",children:"Modified"}),e.jsx(j,{className:"w-24",children:"Actions"})]})}),e.jsx(re,{children:Z.map(s=>e.jsxs(S,{children:[e.jsx(f,{children:e.jsx(h,{icon:s.isDirectory?K:_e,className:`h-4 w-4 ${s.isDirectory?"text-blue-500":"text-muted-foreground"}`})}),e.jsx(f,{children:s.isDirectory?e.jsx("button",{onClick:()=>se(s.path),className:"font-medium text-left hover:text-primary hover:underline transition-colors",children:s.name}):e.jsx("span",{className:"font-medium",children:s.name})}),e.jsx(f,{className:"text-right text-muted-foreground",children:Pe(s.size)}),e.jsx(f,{className:"text-right text-muted-foreground text-sm",children:Se(s.modifiedAt)}),e.jsx(f,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>Ce(s.path,s.name,s.isDirectory),disabled:X===s.path,title:"Download to PC",children:X===s.path?e.jsx(y,{}):e.jsx(h,{icon:Qe,className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>be(s.path),disabled:Y===s.path,title:"Import to library",children:Y===s.path?e.jsx(y,{}):e.jsx(h,{icon:Ye,className:"h-4 w-4"})})]})})]},s.path))})]})}),e.jsx(H,{children:e.jsx(c,{variant:"outline",onClick:()=>F(!1),children:"Close"})})]})})]})}as.__docgenInfo={description:"",methods:[],displayName:"DownloadClients"};export{as as default};
