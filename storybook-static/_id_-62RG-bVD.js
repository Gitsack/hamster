import{j as e}from"./jsx-runtime-u17CrQMm.js";import{f as De,t as i,r as ie,H as K,L as ne}from"./app-CFoDCqX-.js";import{A as X,D as ze,a as Ce,b as ke,c as q,d as Te}from"./app-layout-CTvh2ZE0.js";import{B as h}from"./button-B9kPMW4q.js";import{B as D}from"./badge-B6bn15vN.js";import{C as he,d as xe}from"./card-BT9UEfea.js";import{S as L}from"./skeleton-A7behTLO.js";import{P as Se}from"./progress-Dv5gXtGp.js";import{T as Fe,a as qe,b as $,c as M}from"./tabs-BOg1k8aW.js";import{T as Le,a as $e,b as le,c as Y,d as Me,e as G}from"./table-B1mxUS1v.js";import{D as oe,a as ce,b as de,c as me,d as Pe,e as ue}from"./dialog-CQTA4pg1.js";import{H as l,e as Q,K as Ee,F as Oe,i as Z,w as fe,n as Ue,$ as He,L as Be,J as Re,M as Je,d as _e,u as Ve,A as pe,q as Ke,k as Xe,m as Ye}from"./index.min-fvaCWwiU.js";import{S as v}from"./spinner-McTJFRVv.js";import{r as o}from"./app-BHuVDAkc.js";import"./preload-helper-PPVm8Dsz.js";import"./client-Bx265bNG.js";import"./index-CYxWbFTv.js";import"./index-D5-0xbEa.js";import"./utils-CDN07tui.js";import"./media-status-badge-DETbNkVM.js";import"./useRenderElement-D0Q1kVud.js";import"./useBaseUiId-BvJSLVy2.js";import"./useValueAsRef-GoV-SdOe.js";import"./media-teaser-CTZEtwns.js";import"./check-BEKQ83Eb.js";import"./createLucideIcon-GXN1tXoc.js";import"./useLabelableId-CyGgmgle.js";import"./valueToPercent-CmxdyyhM.js";import"./slot-CUYGZ4Fv.js";import"./hamster-icon-DOXrnfMg.js";import"./input-Bw95PIWX.js";function Ge(){const{url:n}=De(),m=n.split("/").pop(),[r,p]=o.useState(null),[y,z]=o.useState([]),[E,O]=o.useState(!0),[I,x]=o.useState(!1),[C,g]=o.useState(!1),[U,b]=o.useState(!1),[k,A]=o.useState(!1),[N,f]=o.useState(new Set),[u,j]=o.useState(!1),[c,ge]=o.useState(null),[ee,se]=o.useState([]),[je,re]=o.useState(!1),[ye,H]=o.useState(!1);o.useEffect(()=>{T()},[m]),o.useEffect(()=>{r?.musicbrainzId&&B(r.musicbrainzId)},[r?.musicbrainzId]);const T=async()=>{try{const s=await fetch(`/api/v1/artists/${m}`);if(s.ok){const a=await s.json();p(a)}else s.status===404&&(i.error("Artist not found"),ie.visit("/library?tab=music"))}catch(s){console.error("Failed to fetch artist:",s),i.error("Failed to load artist")}finally{O(!1)}},B=async s=>{x(!0);try{const a=await fetch(`/api/v1/artists/${s}/albums`);if(a.ok){const t=await a.json();z(t)}}catch(a){console.error("Failed to fetch discography:",a)}finally{x(!1)}},be=async()=>{g(!0);try{const s=await fetch(`/api/v1/artists/${m}/refresh`,{method:"POST"});if(s.ok)i.success("Artist metadata refreshed"),T(),r?.musicbrainzId&&B(r.musicbrainzId);else{const a=await s.json();i.error(a.error||"Failed to refresh")}}catch(s){console.error("Failed to refresh artist:",s),i.error("Failed to refresh artist")}finally{g(!1)}},Ne=async()=>{if(r){j(!0);try{const s=await fetch(`/api/v1/artists/${m}/enrich`,{method:"POST"});if(s.ok){const a=await s.json();a.enriched?(i.success("Artist enriched with MusicBrainz data"),T()):i.warning(a.message||"No matching artist found")}else{const a=await s.json();i.error(a.error||"Failed to enrich")}}catch(s){console.error("Failed to enrich artist:",s),i.error("Failed to enrich artist")}finally{j(!1)}}},we=async()=>{if(!r)return;const s=r.monitored;p({...r,monitored:!s});try{(await fetch(`/api/v1/artists/${m}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({monitored:!s})})).ok?i.success(s?"Monitoring disabled":"Monitoring enabled"):(p({...r,monitored:s}),i.error("Failed to update monitoring"))}catch(a){console.error("Failed to update monitoring:",a),p({...r,monitored:s}),i.error("Failed to update monitoring")}},ve=async()=>{if(r)try{(await fetch(`/api/v1/artists/${m}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({requested:!r.requested})})).ok&&(p({...r,requested:!r.requested}),i.success(r.requested?"Artist unrequested":"Artist requested"))}catch(s){console.error("Failed to update artist:",s),i.error("Failed to update artist")}},Ie=async()=>{A(!0);try{const s=await fetch(`/api/v1/artists/${m}`,{method:"DELETE"});if(s.ok)i.success("Artist deleted"),ie.visit("/library?tab=music");else{const a=await s.json();i.error(a.error||"Failed to delete")}}catch(s){console.error("Failed to delete artist:",s),i.error("Failed to delete artist")}finally{A(!1),b(!1)}},R=async s=>{if(r){f(a=>new Set(a).add(s.musicbrainzId));try{const a=await fetch("/api/v1/albums",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({musicbrainzId:s.musicbrainzId,artistMusicbrainzId:r.musicbrainzId,rootFolderId:String(r.rootFolder?.id),qualityProfileId:String(r.qualityProfile?.id),metadataProfileId:String(r.metadataProfile?.id),requested:!0,searchForAlbum:!0})});if(a.ok)i.success(`Added "${s.title}" to library`),T(),r.musicbrainzId&&B(r.musicbrainzId);else{const t=await a.json();i.error(t.error||"Failed to add album")}}catch(a){console.error("Failed to add album:",a),i.error("Failed to add album")}finally{f(a=>{const t=new Set(a);return t.delete(s.musicbrainzId),t})}}},S=async s=>{ge(s),H(!0),re(!0),se([]);try{const a=await fetch(`/api/v1/albums/${s.musicbrainzId}/tracks`);if(a.ok){const t=await a.json();se(t)}}catch(a){console.error("Failed to fetch tracks:",a),i.error("Failed to load tracks")}finally{re(!1)}},Ae=s=>{if(!s)return"--:--";const a=Math.floor(s/60),t=s%60;return`${a}:${t.toString().padStart(2,"0")}`},w=o.useMemo(()=>{const s=new Map(r?.albums.map(t=>[t.musicbrainzId,t])||[]),a=y.map(t=>{const d=s.get(t.musicbrainzId);return{musicbrainzId:t.musicbrainzId,title:t.title,releaseDate:t.releaseDate,type:t.type,inLibrary:t.inLibrary||!!d,libraryId:d?.id,requested:d?.requested||!1,trackCount:d?.trackCount||0,fileCount:d?.fileCount||0,imageUrl:d?.imageUrl}});for(const t of r?.albums||[])y.find(d=>d.musicbrainzId===t.musicbrainzId)||a.push({musicbrainzId:t.musicbrainzId||"",title:t.title,releaseDate:t.releaseDate,type:t.albumType,inLibrary:!0,libraryId:t.id,requested:t.requested,trackCount:t.trackCount,fileCount:t.fileCount,imageUrl:t.imageUrl});return a.sort((t,d)=>t.releaseDate?d.releaseDate?d.releaseDate.localeCompare(t.releaseDate):-1:1)},[r?.albums,y]),J=w.filter(s=>s.inLibrary&&s.fileCount>0),_=w.filter(s=>s.inLibrary&&s.requested&&s.fileCount===0),F=w.filter(s=>!s.inLibrary),V=r?.albums.reduce((s,a)=>s+a.trackCount,0)||0,ae=r?.albums.reduce((s,a)=>s+a.fileCount,0)||0,te=V>0?Math.round(ae/V*100):0;return E?e.jsxs(X,{title:"Loading...",children:[e.jsx(K,{title:"Loading..."}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsx(L,{className:"h-48 w-48 rounded-lg"}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(L,{className:"h-8 w-1/3"}),e.jsx(L,{className:"h-4 w-1/2"}),e.jsx(L,{className:"h-4 w-2/3"})]})]})})]}):r?e.jsxs(X,{title:r.name,actions:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(h,{variant:"outline",asChild:!0,children:e.jsxs(ne,{href:"/library?tab=music",children:[e.jsx(l,{icon:Ue,className:"h-4 w-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Back"})]})}),e.jsxs(h,{variant:"outline",size:"sm",onClick:we,children:[e.jsx(l,{icon:r.monitored?He:Be,className:"h-4 w-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:r.monitored?"Monitored":"Monitor"})]}),e.jsxs(ze,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx(h,{variant:"outline",size:"icon",children:e.jsx(l,{icon:Re,className:"h-4 w-4"})})}),e.jsxs(ke,{align:"end",children:[e.jsxs(q,{onClick:ve,children:[e.jsx(l,{icon:r.requested?Je:_e,className:"h-4 w-4 mr-2"}),r.requested?"Unrequest":"Request"]}),e.jsxs(q,{onClick:be,disabled:C,children:[e.jsx(l,{icon:Ve,className:`h-4 w-4 mr-2 ${C?"animate-spin":""}`}),"Refresh"]}),!r.musicbrainzId&&e.jsxs(q,{onClick:Ne,disabled:u,children:[e.jsx(l,{icon:pe,className:`h-4 w-4 mr-2 ${u?"animate-spin":""}`}),u?"Enriching...":"Enrich from MusicBrainz"]}),e.jsx(Te,{}),e.jsxs(q,{className:"text-destructive",onClick:()=>b(!0),children:[e.jsx(l,{icon:Ke,className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]}),children:[e.jsx(K,{title:r.name}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"w-full md:w-48 aspect-square md:aspect-auto md:h-48 bg-muted rounded-lg overflow-hidden flex-shrink-0",children:r.imageUrl?e.jsx("img",{src:r.imageUrl,alt:r.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(l,{icon:Q,className:"h-16 w-16 text-muted-foreground/50"})})}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("h1",{className:"text-2xl font-bold",children:r.name})}),r.disambiguation&&e.jsx("p",{className:"text-muted-foreground",children:r.disambiguation})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-2 text-sm",children:[r.artistType&&e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(l,{icon:Q,className:"h-4 w-4"}),r.artistType]}),r.country&&e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(l,{icon:Ee,className:"h-4 w-4"}),r.country]}),r.formedAt&&e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(l,{icon:Oe,className:"h-4 w-4"}),r.formedAt,r.endedAt&&` - ${r.endedAt}`]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[ae," of ",V," tracks"]}),e.jsxs("span",{className:"font-medium",children:[te,"%"]})]}),e.jsx(Se,{value:te,className:"h-2"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.qualityProfile&&e.jsx(D,{variant:"outline",children:r.qualityProfile.name}),r.metadataProfile&&e.jsx(D,{variant:"outline",children:r.metadataProfile.name}),e.jsxs(D,{variant:"outline",children:[r.albums.length," albums"]})]})]})]}),e.jsxs(Fe,{defaultValue:"all",className:"space-y-4",children:[e.jsxs(qe,{className:"flex-wrap h-auto",children:[e.jsxs($,{value:"all",children:["Discography (",w.length,")",I&&e.jsx(v,{className:"ml-2 h-3 w-3"})]}),e.jsxs($,{value:"downloaded",children:["Downloaded (",J.length,")"]}),e.jsxs($,{value:"requested",children:["Requested (",_.length,")"]}),F.length>0&&e.jsxs($,{value:"available",children:["Available (",F.length,")"]})]}),e.jsx(M,{value:"all",className:"space-y-4",children:w.length===0?e.jsx(he,{children:e.jsxs(xe,{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"rounded-full bg-muted p-6 mb-4",children:e.jsx(l,{icon:Z,className:"h-12 w-12 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No albums found"}),e.jsx("p",{className:"text-muted-foreground",children:I?"Loading discography...":"Try refreshing to fetch albums from MusicBrainz."})]})}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:w.map(s=>e.jsx(P,{album:s,isAdding:N.has(s.musicbrainzId),onAdd:()=>R({...s,artistName:r.name,artistMusicbrainzId:r.musicbrainzId}),onShowTracks:()=>S(s)},s.musicbrainzId))})}),e.jsx(M,{value:"downloaded",className:"space-y-4",children:J.length===0?e.jsx(W,{message:"No downloaded albums yet"}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:J.map(s=>e.jsx(P,{album:s,isAdding:!1,onAdd:()=>{},onShowTracks:()=>S(s)},s.musicbrainzId))})}),e.jsx(M,{value:"requested",className:"space-y-4",children:_.length===0?e.jsx(W,{message:"No requested albums"}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:_.map(s=>e.jsx(P,{album:s,isAdding:!1,onAdd:()=>{},onShowTracks:()=>S(s)},s.musicbrainzId))})}),e.jsx(M,{value:"available",className:"space-y-4",children:F.length===0?e.jsx(W,{message:"All albums are in library"}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:F.map(s=>e.jsx(P,{album:s,isAdding:N.has(s.musicbrainzId),onAdd:()=>R({...s,artistName:r.name,artistMusicbrainzId:r.musicbrainzId}),onShowTracks:()=>S(s)},s.musicbrainzId))})})]})]}),e.jsx(oe,{open:U,onOpenChange:b,children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsxs(me,{children:["Delete ",r.name,"?"]}),e.jsx(Pe,{children:"This will remove the artist and all associated metadata from your library. Files on disk will not be deleted."})]}),e.jsxs(ue,{children:[e.jsx(h,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(h,{variant:"destructive",onClick:Ie,disabled:k,children:k?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-2"}),"Deleting..."]}):"Delete"})]})]})}),e.jsx(oe,{open:ye,onOpenChange:H,children:e.jsxs(ce,{className:"max-w-2xl max-h-[80vh] flex flex-col",children:[e.jsx(de,{children:e.jsxs(me,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-lg overflow-hidden flex-shrink-0",children:e.jsx("img",{src:`https://coverartarchive.org/release-group/${c?.musicbrainzId}/front-250`,alt:c?.title,className:"w-full h-full object-cover",onError:s=>{s.currentTarget.style.display="none"}})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold truncate",children:c?.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[c?.releaseDate?.split("-")[0]||"Unknown year"," Â·"," ",c?.type]})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto -mx-6 px-6",children:je?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(v,{className:"h-8 w-8"})}):ee.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(l,{icon:Q,className:"h-12 w-12 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"No tracks found"})]}):e.jsxs(Le,{children:[e.jsx($e,{children:e.jsxs(le,{children:[e.jsx(Y,{className:"w-12",children:"#"}),e.jsx(Y,{children:"Title"}),e.jsx(Y,{className:"w-20 text-right",children:"Duration"})]})}),e.jsx(Me,{children:ee.map(s=>e.jsxs(le,{children:[e.jsx(G,{className:"text-muted-foreground",children:s.position}),e.jsxs(G,{className:"font-medium",children:[s.title,s.artistName&&s.artistName!==r?.name&&e.jsxs("span",{className:"text-muted-foreground text-sm ml-2",children:["(",s.artistName,")"]})]}),e.jsx(G,{className:"text-right text-muted-foreground",children:Ae(s.duration)})]},s.musicbrainzId))})]})}),e.jsx(ue,{className:"mt-4",children:c?.inLibrary&&c?.libraryId?e.jsx(h,{asChild:!0,children:e.jsx(ne,{href:`/album/${c.libraryId}`,children:"View Album"})}):c&&!c.inLibrary?e.jsx(h,{onClick:()=>{R({musicbrainzId:c.musicbrainzId,title:c.title,releaseDate:c.releaseDate,type:c.type,inLibrary:!1,artistName:r.name,artistMusicbrainzId:r.musicbrainzId}),H(!1)},disabled:N.has(c.musicbrainzId),children:N.has(c.musicbrainzId)?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-2"}),"Adding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{icon:fe,className:"h-4 w-4 mr-2"}),"Add to Library"]})}):null})]})})]}):e.jsxs(X,{title:"Not Found",children:[e.jsx(K,{title:"Not Found"}),e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Artist not found"})})]})}function W({message:n}){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"rounded-full bg-muted p-6 mb-4",children:e.jsx(l,{icon:Z,className:"h-12 w-12 text-muted-foreground"})}),e.jsx("p",{className:"text-muted-foreground",children:n})]})}function P({album:n,isAdding:m,onAdd:r,onShowTracks:p}){const[y,z]=o.useState(!1),[E,O]=o.useState(!1),I=n.trackCount>0?Math.round(n.fileCount/n.trackCount*100):0,x=n.inLibrary&&I===100,C=n.inLibrary&&n.requested&&!x,g=!n.inLibrary,U=async f=>{if(f.preventDefault(),f.stopPropagation(),!!n.libraryId){z(!0);try{const u=await fetch(`/api/v1/albums/${n.libraryId}/download`,{method:"POST"});if(u.ok){const j=await u.json();i.success(`Download started: ${j.release?.title||j.title}`)}else{const j=await u.json();i.error(j.error||"No releases found")}}catch(u){console.error("Failed to download:",u),i.error("Failed to download album")}finally{z(!1)}}},b=f=>{f.preventDefault(),f.stopPropagation(),r()},k=()=>{p()},A=n.imageUrl||(n.musicbrainzId?`https://coverartarchive.org/release-group/${n.musicbrainzId}/front-500`:null),N=A&&!E;return e.jsx("div",{onClick:k,children:e.jsxs(he,{className:`py-0 overflow-hidden hover:ring-2 hover:ring-primary transition-all cursor-pointer group ${x?"ring-1 ring-green-500/50":""} ${g?"opacity-70":""}`,children:[e.jsxs("div",{className:"aspect-square bg-muted relative",children:[N?e.jsx("img",{src:A,alt:n.title,className:`w-full h-full object-cover ${g?"grayscale":""}`,loading:"lazy",onError:()=>O(!0)}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(l,{icon:Z,className:"h-16 w-16 text-muted-foreground/50"})}),e.jsxs("div",{className:"absolute top-2 right-2",children:[x&&e.jsxs(D,{variant:"default",className:"bg-green-600 text-white",children:[e.jsx(l,{icon:Xe,className:"h-3 w-3 mr-1"}),"Downloaded"]}),C&&e.jsxs(D,{variant:"secondary",className:"bg-yellow-600 text-white",children:[e.jsx(l,{icon:Ye,className:"h-3 w-3 mr-1"}),"Requested"]})]}),!x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity",children:g?e.jsxs(h,{variant:"secondary",size:"sm",className:"gap-1",onClick:b,disabled:m,children:[m?e.jsx(v,{className:"h-4 w-4"}):e.jsx(l,{icon:fe,className:"h-4 w-4"}),"Add to Library"]}):n.libraryId?e.jsx(h,{variant:"secondary",size:"icon",className:"h-12 w-12 rounded-full",onClick:U,disabled:y,children:y?e.jsx(v,{className:"h-6 w-6"}):e.jsx(l,{icon:pe,className:"h-6 w-6"})}):null}),n.inLibrary&&n.requested&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-muted-foreground/20",children:e.jsx("div",{className:`h-full transition-all ${x?"bg-green-500":"bg-primary"}`,style:{width:`${I}%`}})})]}),e.jsxs(xe,{className:`p-3 ${g?"opacity-70":""}`,children:[e.jsx("h3",{className:"font-medium truncate group-hover:text-primary transition-colors",children:n.title}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:n.releaseDate?.split("-")[0]||"Unknown"}),e.jsx("span",{className:"capitalize",children:n.type})]})]})]})})}Ge.__docgenInfo={description:"",methods:[],displayName:"ArtistDetail"};export{Ge as default};
