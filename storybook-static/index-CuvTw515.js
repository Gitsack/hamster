import{j as s}from"./jsx-runtime-u17CrQMm.js";import{H as fs,C as xs,e as bs,L as S,t as d}from"./app-CFoDCqX-.js";import{A as vs,D as K,a as G,b as J,c as E,d as Ie}from"./app-layout-CTvh2ZE0.js";import{B as x}from"./button-B9kPMW4q.js";import{I as js}from"./input-Bw95PIWX.js";import{B as Fe}from"./badge-B6bn15vN.js";import{C as Q,d as X}from"./card-BT9UEfea.js";import{S as Z}from"./skeleton-A7behTLO.js";import{T as ws,a as ys,b as Ns,c as ks}from"./tabs-BOg1k8aW.js";import{D as Ue,a as Ee,b as Le,c as De,d as qe,e as Me}from"./dialog-CQTA4pg1.js";import{m as Cs,z as Oe,e as _e,I as He,j as We,H as h,X as $s,Y as Ss,_ as Ts,s as Is,A as O,w as Re,a0 as Fs,P as Us,J as Ae,a1 as ze}from"./index.min-fvaCWwiU.js";import{S as ee}from"./spinner-McTJFRVv.js";import{r as l}from"./app-BHuVDAkc.js";import{a2 as Be,a6 as Es}from"./media-status-badge-DETbNkVM.js";import"./preload-helper-PPVm8Dsz.js";import"./client-Bx265bNG.js";import"./index-CYxWbFTv.js";import"./index-D5-0xbEa.js";import"./utils-CDN07tui.js";import"./media-teaser-CTZEtwns.js";import"./check-BEKQ83Eb.js";import"./createLucideIcon-GXN1tXoc.js";import"./useRenderElement-D0Q1kVud.js";import"./useLabelableId-CyGgmgle.js";import"./useBaseUiId-BvJSLVy2.js";import"./useValueAsRef-GoV-SdOe.js";import"./valueToPercent-CmxdyyhM.js";import"./slot-CUYGZ4Fv.js";import"./hamster-icon-DOXrnfMg.js";const Pe=["movies","tv","music","books","missing"],k={movies:{label:"Movies",icon:We,addUrl:"/search?mode=movies",itemLabel:"movie",countLabel:"movies"},tv:{label:"TV Shows",icon:He,addUrl:"/search?mode=tv",itemLabel:"show",countLabel:"shows"},music:{label:"Music",icon:_e,addUrl:"/search?mode=music&type=artist",itemLabel:"artist",countLabel:"albums"},books:{label:"Books",icon:Oe,addUrl:"/search?mode=books",itemLabel:"author",countLabel:"books"},missing:{label:"Missing",icon:Cs,addUrl:"/search",itemLabel:"item",countLabel:"items"}};function Ls(){const[se,Ye]=l.useState(["movies"]),[te,L]=l.useState([]),[ae,T]=l.useState([]),[re,D]=l.useState([]),[ie,q]=l.useState([]),[oe,Ve]=l.useState([]),[w,M]=l.useState({albums:0,movies:0,episodes:0,books:0}),[ne,Ke]=l.useState([]),[le,ce]=l.useState(!0),[C,de]=l.useState("grid"),[y,Ge]=l.useState(""),[I,Je]=l.useState("name"),me=typeof window<"u"&&new URLSearchParams(window.location.search).get("tab")||"movies",[g,Qe]=l.useState(me),ue=l.useCallback(e=>{Qe(e);const a=new URL(window.location.href);a.searchParams.set("tab",e),window.history.replaceState({},"",a.toString())},[]),[Xe,_]=l.useState(!1),[b,Ds]=l.useState(null),[H,Ze]=l.useState(!1),[he,pe]=l.useState(!1),[es,F]=l.useState(!1),[N,U]=l.useState(null),[ge,W]=l.useState(!1),[R,Y]=l.useState(!1),[$,fe]=l.useState(new Set),[xe,be]=l.useState(new Set);l.useEffect(()=>{(async()=>{try{const a=await fetch("/api/v1/settings");if(a.ok){const t=await a.json();if(t.enabledMediaTypes?.length>0){const i=[...t.enabledMediaTypes,"missing"].sort((c,u)=>Pe.indexOf(c)-Pe.indexOf(u));Ye(i),i.includes(me)||ue(t.enabledMediaTypes[0])}}}catch(a){console.error("Failed to fetch settings:",a)}})()},[]),l.useEffect(()=>{A()},[g]);const A=async()=>{ce(!0);try{const e=await fetch("/api/v1/queue");switch(e.ok&&Ke(await e.json()),g){case"music":{const a=await fetch("/api/v1/artists");a.ok&&L(await a.json());break}case"movies":{const a=await fetch("/api/v1/movies");a.ok&&T(await a.json());break}case"tv":{const a=await fetch("/api/v1/tvshows");a.ok&&D(await a.json());break}case"books":{const a=await fetch("/api/v1/authors");a.ok&&q(await a.json());break}case"missing":{const[a,t,i,c]=await Promise.all([fetch("/api/v1/albums/requested?limit=100"),fetch("/api/v1/movies/requested?limit=100"),fetch("/api/v1/tvshows/requested?limit=100"),fetch("/api/v1/books/requested?limit=100")]),u=[];if(a.ok){const o=await a.json();M(r=>({...r,albums:o.meta?.total||0})),u.push(...o.data.map(r=>({id:`album-${r.id}`,type:"album",title:r.title,subtitle:r.artistName,imageUrl:r.imageUrl})))}if(t.ok){const o=await t.json();M(r=>({...r,movies:o.meta?.total||0})),u.push(...o.data.map(r=>({id:`movie-${r.id}`,type:"movie",title:r.title,subtitle:r.year?.toString(),imageUrl:r.posterUrl})))}if(i.ok){const o=await i.json();M(r=>({...r,episodes:o.meta?.total||0})),u.push(...o.data.map(r=>({id:`episode-${r.id}`,type:"episode",title:`S${String(r.seasonNumber).padStart(2,"0")}E${String(r.episodeNumber).padStart(2,"0")} - ${r.title}`,subtitle:r.tvShowTitle,imageUrl:r.posterUrl,airDate:r.airDate})))}if(c.ok){const o=await c.json();M(r=>({...r,books:o.meta?.total||0})),u.push(...o.data.map(r=>({id:`book-${r.id}`,type:"book",title:r.title,subtitle:r.authorName,imageUrl:r.coverUrl})))}Ve(u);break}}}catch(e){console.error("Failed to fetch data:",e)}finally{ce(!1)}},ss=async()=>{if(b){pe(!0);try{const a=await fetch(`/api/v1/${{music:"artists",movies:"movies",tv:"tvshows",books:"authors"}[b.type]}/${b.id}?deleteFiles=${H}`,{method:"DELETE"});if(a.ok){switch(d.success(`${b.name} removed from library`),b.type){case"music":L(t=>t.filter(i=>i.id!==b.id));break;case"movies":T(t=>t.filter(i=>i.id!==b.id));break;case"tv":D(t=>t.filter(i=>i.id!==b.id));break;case"books":q(t=>t.filter(i=>i.id!==b.id));break}_(!1)}else{const t=await a.json();d.error(t.error||"Failed to remove item")}}catch(e){console.error("Failed to delete:",e),d.error("Failed to remove item")}finally{pe(!1)}}},ts=async()=>{if(R||g==="missing")return;Y(!0);const a={music:"music",movies:"movies",tv:"tv",books:"books",missing:""}[g];if(!a){Y(!1);return}try{const t=await fetch("/api/v1/rootfolders");if(!t.ok){d.error("Failed to fetch root folders");return}const c=(await t.json()).filter(r=>r.mediaType===a);if(c.length===0){d.error(`No root folders configured for ${k[g].label}`);return}d.info(`Scanning ${c.length} folder(s)...`);const u=[];let o=[];for(const r of c){const j=(async()=>{try{const v=await fetch(`/api/v1/rootfolders/${r.id}/scan`,{method:"POST"});if(!v.ok){const f=await v.json();o.push(f.error||`Failed to start scan for: ${r.path}`);return}let n=!0;for(;n;){await new Promise(p=>setTimeout(p,1e3));const f=await fetch(`/api/v1/rootfolders/${r.id}/scan-status`);f.ok?n=(await f.json()).isScanning:n=!1}}catch(v){o.push(`Error scanning ${r.path}: ${v instanceof Error?v.message:"Unknown error"}`)}})();u.push(j)}await Promise.all(u),o.length>0?(console.error("Scan errors:",o),d.warning(`Scan completed with ${o.length} error(s)`)):d.success("Library scan complete!"),await A()}catch(t){console.error("Scan failed:",t),d.error("Library scan failed")}finally{Y(!1)}},ve=async(e,a,t,i)=>{i.preventDefault(),i.stopPropagation();const c=`${e}-${a}`;fe(o=>new Set(o).add(c));const u={music:"artists",movies:"movies",tv:"tvshows",books:"authors",missing:""};try{const o=await fetch(`/api/v1/${u[e]}/${a}/enrich`,{method:"POST"});if(o.ok){const r=await o.json();r.enriched?(d.success(`${t} enriched successfully`),A()):d.warning(r.message||"No matching entry found")}else{const r=await o.json();d.error(r.error||"Failed to enrich")}}catch(o){console.error("Failed to enrich:",o),d.error("Failed to enrich")}finally{fe(o=>{const r=new Set(o);return r.delete(c),r})}},je=async(e,a,t,i,c,u)=>{if(t&&i){U({type:e,id:a,name:c||"this item",hasFile:i}),F(!0);return}const o=`${e}-${a}`;be(n=>new Set(n).add(o));const j=(()=>{switch(e){case"movies":return`/api/v1/movies/${a}/request`;case"books":return`/api/v1/books/${a}/request`;case"music":return`/api/v1/artists/${a}`;case"tv":return`/api/v1/tvshows/${a}`;default:return""}})(),v=e==="movies"||e==="books";try{const n=await fetch(j,{method:v?"POST":"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({requested:!t})}),f=await n.json();if(n.ok)if(f.deleted)switch(d.success("Removed from library"),e){case"movies":T(p=>p.filter(m=>m.id!==a));break;case"music":L(p=>p.filter(m=>m.id!==a));break;case"tv":D(p=>p.filter(m=>m.id!==a));break;case"books":q(p=>p.filter(m=>m.id!==a));break}else switch(d.success(t?"Item unrequested":"Item requested"),e){case"movies":T(p=>p.map(m=>m.id===a?{...m,requested:!t}:m));break;case"music":L(p=>p.map(m=>m.id===a?{...m,requested:!t}:m));break;case"tv":D(p=>p.map(m=>m.id===a?{...m,requested:!t}:m));break;case"books":q(p=>p.map(m=>m.id===a?{...m,requested:!t}:m));break}else f.hasFile?(U({type:e,id:a,name:c||"this item",hasFile:!0}),F(!0)):d.error(f.error||"Failed to update request status")}catch(n){console.error("Failed to toggle request:",n),d.error("Failed to update request status")}finally{be(n=>{const f=new Set(n);return f.delete(o),f})}},as=async()=>{if(!N)return;W(!0);const a=(()=>{switch(N.type){case"movies":return`/api/v1/movies/${N.id}?deleteFile=true`;case"books":return`/api/v1/books/${N.id}?deleteFile=true`;default:return""}})();if(!a){d.error("Cannot delete this item type"),W(!1);return}try{const t=await fetch(a,{method:"DELETE"});if(t.ok){switch(d.success("Removed from library and deleted files"),N.type){case"movies":T(i=>i.filter(c=>c.id!==N.id));break;case"books":A();break}F(!1),U(null)}else{const i=await t.json();d.error(i.error||"Failed to delete")}}catch(t){console.error("Failed to delete:",t),d.error("Failed to delete")}finally{W(!1)}},we=(e,a,t)=>Es(e,a!==void 0?{progress:a,status:t||"downloading"}:null),ye=()=>te.filter(e=>e.name.toLowerCase().includes(y.toLowerCase())).sort((e,a)=>{switch(I){case"recent":return a.id-e.id;case"count":return Number(a.albumCount)-Number(e.albumCount);default:return(e.sortName||e.name).localeCompare(a.sortName||a.name)}}),Ne=()=>ae.filter(e=>e.title.toLowerCase().includes(y.toLowerCase())).sort((e,a)=>{switch(I){case"recent":return a.id-e.id;case"year":return(a.year||0)-(e.year||0);default:return e.title.localeCompare(a.title)}}),ke=()=>re.filter(e=>e.title.toLowerCase().includes(y.toLowerCase())).sort((e,a)=>{switch(I){case"recent":return a.id-e.id;case"year":return(a.year||0)-(e.year||0);case"count":return a.episodeCount-e.episodeCount;default:return e.title.localeCompare(a.title)}}),Ce=()=>ie.filter(e=>e.name.toLowerCase().includes(y.toLowerCase())).sort((e,a)=>{switch(I){case"recent":return a.id-e.id;case"count":return Number(a.bookCount)-Number(e.bookCount);default:return e.name.localeCompare(a.name)}}),rs=()=>{switch(g){case"music":return ye();case"movies":return Ne();case"tv":return ke();case"books":return Ce()}},is=()=>{switch(g){case"music":return te.length;case"movies":return ae.length;case"tv":return re.length;case"books":return ie.length}},z=()=>{const e=k[g];return s.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[s.jsx("div",{className:"rounded-full bg-muted p-6 mb-4",children:s.jsx(h,{icon:e.icon,className:"h-12 w-12 text-muted-foreground"})}),s.jsx("h3",{className:"text-lg font-medium mb-2",children:y?"No items found":`Your ${e.label.toLowerCase()} library is empty`}),s.jsx("p",{className:"text-muted-foreground mb-4",children:y?"Try a different search term":`Get started by adding your first ${e.itemLabel}`}),!y&&s.jsx(x,{asChild:!0,children:s.jsxs(S,{href:e.addUrl,children:[s.jsx(h,{icon:Re,className:"h-4 w-4 mr-2"}),"Add ",e.itemLabel.charAt(0).toUpperCase()+e.itemLabel.slice(1)]})})]})},[$e,os]=l.useState(new Set),Se=l.useCallback(e=>{os(a=>new Set(a).add(e))},[]),B=e=>{const a=k[e.mediaType],t=`${e.mediaType}-${e.id}`,i=e.imageUrl&&!$e.has(t),c=ne.find(n=>{switch(e.mediaType){case"music":return n.artistId===e.id;case"movies":return n.movieId===e.id;case"tv":return n.tvShowId===e.id;case"books":return n.bookId===e.id}}),u=!!c,o=e.mediaType!=="tv"&&!e.requested&&!e.hasFile&&!u,r=xe.has(t),{status:j,progress:v}=we(e,c?.progress,c?.status);return s.jsxs(Q,{className:"py-0 overflow-hidden hover:ring-2 hover:ring-primary transition-all cursor-pointer group relative",children:[s.jsxs(S,{href:e.detailUrl,children:[s.jsx("div",{className:"aspect-[2/3] bg-muted relative",children:i?s.jsx("img",{src:e.imageUrl,alt:e.name,className:`w-full h-full object-cover transition-all duration-300 ${o?"grayscale opacity-60 group-hover:grayscale-0 group-hover:opacity-100":""}`,loading:"lazy",onError:()=>Se(t)}):s.jsx("div",{className:`w-full h-full flex items-center justify-center transition-all duration-300 ${o?"opacity-40 group-hover:opacity-60":""}`,children:s.jsx(h,{icon:a.icon,className:"h-16 w-16 text-muted-foreground/50"})})}),s.jsxs(X,{className:`p-3 transition-opacity duration-300 ${o?"opacity-60 group-hover:opacity-100":""}`,children:[s.jsx("h3",{className:"font-medium truncate group-hover:text-primary transition-colors",children:e.name}),e.subtitle&&s.jsx("p",{className:"text-sm text-muted-foreground truncate",children:e.subtitle}),e.downloadedEpisodeCount!==void 0&&s.jsxs("p",{className:"text-xs text-green-500 truncate flex items-center gap-1",children:[s.jsx(h,{icon:Us,className:"h-3 w-3"}),e.downloadedEpisodeCount," episode",e.downloadedEpisodeCount!==1?"s":""]})]})]}),j!=="none"&&s.jsx("div",{className:"absolute top-2 left-2 z-10",children:s.jsx(Be,{status:j,progress:v,size:"sm",isToggling:r,onToggleRequest:()=>je(e.mediaType,e.id,e.requested??!1,e.hasFile,e.name),showRequestButton:!1})}),s.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:s.jsxs(K,{children:[s.jsx(G,{asChild:!0,children:s.jsx(x,{variant:"secondary",size:"icon",className:"h-7 w-7 bg-background/80 backdrop-blur-sm",onClick:n=>n.preventDefault(),children:s.jsx(h,{icon:Ae,className:"h-4 w-4"})})}),s.jsxs(J,{align:"end",children:[s.jsx(E,{asChild:!0,children:s.jsxs(S,{href:e.detailUrl,children:[s.jsx(h,{icon:ze,className:"h-4 w-4 mr-2"}),"View Details"]})}),!e.externalId&&s.jsxs(s.Fragment,{children:[s.jsx(Ie,{}),s.jsxs(E,{onClick:n=>ve(e.mediaType,e.id,e.name,n),disabled:$.has(`${e.mediaType}-${e.id}`),children:[s.jsx(h,{icon:O,className:`h-4 w-4 mr-2 ${$.has(`${e.mediaType}-${e.id}`)?"animate-spin":""}`}),$.has(`${e.mediaType}-${e.id}`)?"Enriching...":e.mediaType==="music"?"Enrich from MusicBrainz":"Enrich from TMDB"]})]})]})]})})]},t)},P=e=>{const a=k[e.mediaType],t=`${e.mediaType}-${e.id}`,i=e.imageUrl&&!$e.has(t),c=ne.find(n=>{switch(e.mediaType){case"music":return n.artistId===e.id;case"movies":return n.movieId===e.id;case"tv":return n.tvShowId===e.id;case"books":return n.bookId===e.id}}),u=!!c,o=e.mediaType!=="tv"&&!e.requested&&!e.hasFile&&!u,r=xe.has(t),{status:j,progress:v}=we(e,c?.progress,c?.status);return s.jsx(Q,{className:"hover:ring-2 hover:ring-primary transition-all cursor-pointer group",children:s.jsxs(X,{className:"flex items-center gap-4 p-4",children:[s.jsxs(S,{href:e.detailUrl,className:"flex items-center gap-4 flex-1 min-w-0",children:[s.jsx("div",{className:"h-16 w-12 rounded bg-muted flex-shrink-0 overflow-hidden relative",children:i?s.jsx("img",{src:e.imageUrl,alt:e.name,className:`w-full h-full object-cover transition-all duration-300 ${o?"grayscale opacity-60 group-hover:grayscale-0 group-hover:opacity-100":""}`,loading:"lazy",onError:()=>Se(t)}):s.jsx("div",{className:`w-full h-full flex items-center justify-center transition-all duration-300 ${o?"opacity-40 group-hover:opacity-60":""}`,children:s.jsx(h,{icon:a.icon,className:"h-6 w-6 text-muted-foreground/50"})})}),s.jsxs("div",{className:`flex-1 min-w-0 transition-opacity duration-300 ${o?"opacity-60 group-hover:opacity-100":""}`,children:[s.jsx("h3",{className:"font-medium truncate",children:e.name}),e.subtitle&&s.jsx("p",{className:"text-sm text-muted-foreground truncate",children:e.subtitle}),e.downloadedEpisodeCount!==void 0&&s.jsxs("p",{className:"text-xs text-green-500 truncate",children:[e.downloadedEpisodeCount," episode",e.downloadedEpisodeCount!==1?"s":""," downloaded"]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[j!=="none"&&s.jsx(Be,{status:j,progress:v,size:"sm",isToggling:r,onToggleRequest:()=>je(e.mediaType,e.id,e.requested??!1,e.hasFile,e.name),showRequestButton:!1}),e.badges?.map((n,f)=>s.jsx(Fe,{variant:"outline",children:n},f)),s.jsxs(K,{children:[s.jsx(G,{asChild:!0,children:s.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",children:s.jsx(h,{icon:Ae,className:"h-4 w-4"})})}),s.jsxs(J,{align:"end",children:[s.jsx(E,{asChild:!0,children:s.jsxs(S,{href:e.detailUrl,children:[s.jsx(h,{icon:ze,className:"h-4 w-4 mr-2"}),"View Details"]})}),!e.externalId&&s.jsxs(s.Fragment,{children:[s.jsx(Ie,{}),s.jsxs(E,{onClick:n=>ve(e.mediaType,e.id,e.name,n),disabled:$.has(`${e.mediaType}-${e.id}`),children:[s.jsx(h,{icon:O,className:`h-4 w-4 mr-2 ${$.has(`${e.mediaType}-${e.id}`)?"animate-spin":""}`}),$.has(`${e.mediaType}-${e.id}`)?"Enriching...":e.mediaType==="music"?"Enrich from MusicBrainz":"Enrich from TMDB"]})]})]})]})]})]})},t)},ns=()=>{const e=ye();if(e.length===0)return z();const a=e.map(t=>({id:t.id,name:t.name,imageUrl:t.imageUrl,subtitle:`${t.albumCount} ${Number(t.albumCount)===1?"album":"albums"}`,detailUrl:`/artist/${t.id}`,requested:t.requested,mediaType:"music",externalId:t.musicbrainzId}));return C==="grid"?s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:a.map(t=>B(t))}):s.jsx("div",{className:"space-y-2",children:e.map(t=>P({id:t.id,name:t.name,imageUrl:t.imageUrl,subtitle:`${t.albumCount} ${Number(t.albumCount)===1?"album":"albums"}${t.artistType?` • ${t.artistType}`:""}`,detailUrl:`/artist/${t.id}`,requested:t.requested,mediaType:"music",badges:t.qualityProfile?[t.qualityProfile.name]:[],externalId:t.musicbrainzId}))})},ls=()=>{const e=Ne();if(e.length===0)return z();const a=e.map(t=>({id:t.id,name:t.title,imageUrl:t.posterUrl,subtitle:t.year?`${t.year}${t.runtime?` • ${t.runtime} min`:""}`:void 0,detailUrl:`/movie/${t.id}`,requested:t.requested,hasFile:t.hasFile,mediaType:"movies",externalId:t.tmdbId}));return C==="grid"?s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:a.map(t=>B(t))}):s.jsx("div",{className:"space-y-2",children:e.map(t=>P({id:t.id,name:t.title,imageUrl:t.posterUrl,subtitle:t.year?`${t.year}${t.runtime?` • ${t.runtime} min`:""}`:void 0,detailUrl:`/movie/${t.id}`,requested:t.requested,hasFile:t.hasFile,mediaType:"movies",badges:t.status?[t.status]:[],externalId:t.tmdbId}))})},cs=()=>{const e=ke();if(e.length===0)return z();const a=e.map(t=>({id:t.id,name:t.title,imageUrl:t.posterUrl,subtitle:`${t.seasonCount} season${t.seasonCount!==1?"s":""} • ${t.episodeCount} episodes`,detailUrl:`/tvshow/${t.id}`,mediaType:"tv",externalId:t.tmdbId,downloadedEpisodeCount:t.downloadedEpisodeCount}));return C==="grid"?s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:a.map(t=>B(t))}):s.jsx("div",{className:"space-y-2",children:e.map(t=>P({id:t.id,name:t.title,imageUrl:t.posterUrl,subtitle:`${t.seasonCount} season${t.seasonCount!==1?"s":""} • ${t.episodeCount} episodes`,detailUrl:`/tvshow/${t.id}`,mediaType:"tv",badges:[t.network,t.status].filter(Boolean),externalId:t.tmdbId,downloadedEpisodeCount:t.downloadedEpisodeCount}))})},ds=()=>{const e=Ce();if(e.length===0)return z();const a=e.map(t=>({id:t.id,name:t.name,imageUrl:t.imageUrl,subtitle:`${t.bookCount} ${Number(t.bookCount)===1?"book":"books"}`,detailUrl:`/author/${t.id}`,requested:t.requested,mediaType:"books"}));return C==="grid"?s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:a.map(t=>B(t))}):s.jsx("div",{className:"space-y-2",children:e.map(t=>P({id:t.id,name:t.name,imageUrl:t.imageUrl,subtitle:`${t.bookCount} ${Number(t.bookCount)===1?"book":"books"}`,detailUrl:`/author/${t.id}`,requested:t.requested,mediaType:"books"}))})},ms=()=>{if(oe.length===0)return s.jsxs("div",{className:"text-center py-12",children:[s.jsx(h,{icon:Fs,className:"h-12 w-12 mx-auto text-green-500 mb-4"}),s.jsx("h3",{className:"text-lg font-medium mb-2",children:"All caught up!"}),s.jsx("p",{className:"text-muted-foreground",children:"No missing items to download"})]});const e=i=>{switch(i){case"album":return _e;case"movie":return We;case"episode":return He;case"book":return Oe}},a=i=>{switch(i){case"album":return"Album";case"movie":return"Movie";case"episode":return"Episode";case"book":return"Book"}},t=async i=>{const[c,u]=i.id.split("-");let o="";switch(c){case"album":o=`/api/v1/albums/${u}/search`;break;case"movie":o=`/api/v1/movies/${u}/search`;break;case"episode":o=`/api/v1/tvshows/0/episodes/${u}/search`;break;case"book":o=`/api/v1/books/${u}/search`;break}try{const r=await fetch(o,{method:"POST"});r.ok?(await r.json()).grabbed?d.success(`Download started for ${i.title}`):d.info("No results found"):d.error("Search failed")}catch{d.error("Search failed")}};return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"text-sm text-muted-foreground mb-4",children:[w.albums>0&&s.jsxs("span",{className:"mr-4",children:[w.albums," albums"]}),w.movies>0&&s.jsxs("span",{className:"mr-4",children:[w.movies," movies"]}),w.episodes>0&&s.jsxs("span",{className:"mr-4",children:[w.episodes," episodes"]}),w.books>0&&s.jsxs("span",{className:"mr-4",children:[w.books," books"]})]}),s.jsx("div",{className:"space-y-2",children:oe.map(i=>s.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg border bg-card hover:bg-accent/50 transition-colors",children:[s.jsx("div",{className:"h-12 w-12 rounded overflow-hidden bg-muted flex-shrink-0",children:i.imageUrl?s.jsx("img",{src:i.imageUrl,alt:"",className:"h-full w-full object-cover"}):s.jsx("div",{className:"h-full w-full flex items-center justify-center",children:s.jsx(h,{icon:e(i.type),className:"h-6 w-6 text-muted-foreground"})})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-medium truncate",children:i.title}),s.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[s.jsx(Fe,{variant:"outline",className:"text-xs",children:a(i.type)}),i.subtitle&&s.jsx("span",{className:"truncate",children:i.subtitle})]})]}),s.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>t(i),children:[s.jsx(h,{icon:O,className:"h-4 w-4 mr-1"}),"Search"]})]},i.id))})]})},us=()=>{switch(g){case"music":return ns();case"movies":return ls();case"tv":return cs();case"books":return ds();case"missing":return ms()}},hs=()=>s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:Array.from({length:12}).map((e,a)=>s.jsxs(Q,{className:"overflow-hidden",children:[s.jsx(Z,{className:"aspect-[2/3]"}),s.jsxs(X,{className:"p-3",children:[s.jsx(Z,{className:"h-4 w-3/4 mb-2"}),s.jsx(Z,{className:"h-3 w-1/2"})]})]},a))}),ps=()=>{const e=[{value:"name",label:"Name"},{value:"recent",label:"Recently Added"}];switch(g){case"music":return[...e,{value:"count",label:"Album Count"}];case"movies":return[...e,{value:"year",label:"Year"}];case"tv":return[...e,{value:"year",label:"Year"},{value:"count",label:"Episode Count"}];case"books":return[...e,{value:"count",label:"Book Count"}];case"missing":return e;default:return e}},V=k[g],gs=rs(),Te=is();return s.jsxs(vs,{title:"Library",actions:s.jsx(x,{asChild:!0,children:s.jsxs(S,{href:V.addUrl,children:[s.jsx(h,{icon:Re,className:"h-4 w-4 mr-2"}),"Add"]})}),children:[s.jsx(fs,{title:"Library"}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs(ws,{value:g,onValueChange:e=>ue(e),children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[s.jsx(ys,{children:se.map(e=>{const a=k[e];return s.jsxs(Ns,{value:e,className:"gap-2",children:[s.jsx(h,{icon:a.icon,className:"h-4 w-4"}),a.label]},e)})}),s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs(K,{children:[s.jsx(G,{asChild:!0,children:s.jsxs(x,{variant:"outline",size:"sm",children:[s.jsx(h,{icon:$s,className:"h-4 w-4 sm:mr-2"}),s.jsx("span",{className:"hidden sm:inline",children:"Sort"})]})}),s.jsx(J,{align:"end",children:ps().map(e=>s.jsxs(E,{onClick:()=>Je(e.value),children:[e.label," ",I===e.value&&"✓"]},e.value))})]}),s.jsxs("div",{className:"flex items-center border rounded-md",children:[s.jsx(x,{variant:C==="grid"?"secondary":"ghost",size:"sm",onClick:()=>de("grid"),className:"rounded-r-none",children:s.jsx(h,{icon:Ss,className:"h-4 w-4"})}),s.jsx(x,{variant:C==="list"?"secondary":"ghost",size:"sm",onClick:()=>de("list"),className:"rounded-l-none",children:s.jsx(h,{icon:Ts,className:"h-4 w-4"})})]}),g!=="missing"&&s.jsxs(x,{variant:"outline",size:"sm",onClick:ts,disabled:R,children:[R?s.jsx(ee,{className:"h-4 w-4 sm:mr-2"}):s.jsx(h,{icon:Is,className:"h-4 w-4 sm:mr-2"}),s.jsx("span",{className:"hidden sm:inline",children:R?"Scanning...":"Scan Library"})]})]})]}),s.jsxs("div",{className:"relative w-full sm:w-80 mt-4",children:[s.jsx(h,{icon:O,className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s.jsx(js,{placeholder:`Filter ${V.label.toLowerCase()}...`,value:y,onChange:e=>Ge(e.target.value),className:"pl-9"})]}),se.map(e=>s.jsx(ks,{value:e,className:"mt-6",children:le?hs():us()},e))]}),!le&&Te>0&&s.jsxs("div",{className:"text-sm text-muted-foreground text-center",children:["Showing ",gs.length," of ",Te," ",V.countLabel]})]}),s.jsx(Ue,{open:Xe,onOpenChange:_,children:s.jsxs(Ee,{children:[s.jsxs(Le,{children:[s.jsxs(De,{children:["Remove ",b?.name]}),s.jsxs(qe,{children:["Are you sure you want to remove this"," ",b?k[b.type].itemLabel:"item"," from your library? This action cannot be undone."]})]}),s.jsxs("div",{className:"py-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(xs,{id:"deleteFiles",checked:H,onCheckedChange:e=>Ze(e)}),s.jsx(bs,{htmlFor:"deleteFiles",className:"text-sm font-normal cursor-pointer",children:"Also delete downloaded files from disk"})]}),H&&s.jsx("p",{className:"text-sm text-destructive mt-2",children:"Warning: This will permanently delete all downloaded files."})]}),s.jsxs(Me,{children:[s.jsx(x,{variant:"outline",onClick:()=>_(!1),children:"Cancel"}),s.jsx(x,{variant:"destructive",onClick:ss,disabled:he,children:he?s.jsxs(s.Fragment,{children:[s.jsx(ee,{className:"mr-2"}),"Removing..."]}):"Remove"})]})]})}),s.jsx(Ue,{open:es,onOpenChange:e=>{F(e),e||U(null)},children:s.jsxs(Ee,{children:[s.jsxs(Le,{children:[s.jsx(De,{children:"Remove from library?"}),s.jsxs(qe,{children:[s.jsx("span",{className:"font-medium",children:N?.name})," has downloaded files. This will permanently delete the files from disk and remove the item from your library."]})]}),s.jsxs(Me,{children:[s.jsx(x,{variant:"outline",onClick:()=>{F(!1),U(null)},children:"Cancel"}),s.jsx(x,{variant:"destructive",onClick:as,disabled:ge,children:ge?s.jsxs(s.Fragment,{children:[s.jsx(ee,{className:"mr-2"}),"Deleting..."]}):"Delete Files & Remove"})]})]})})]})}Ls.__docgenInfo={description:"",methods:[],displayName:"Library"};export{Ls as default};
