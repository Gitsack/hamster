import{j as e}from"./jsx-runtime-u17CrQMm.js";import{t as i,H as te,e as n,S as ae,a as ne,b as oe,c as re,d as m,C as c}from"./app-CFoDCqX-.js";import{A as ie}from"./app-layout-CTvh2ZE0.js";import{B as d}from"./button-B9kPMW4q.js";import{I as P}from"./input-Bw95PIWX.js";import{C as le,a as ce,b as de,c as me,d as he}from"./card-BT9UEfea.js";import{B as y}from"./badge-B6bn15vN.js";import{D as H,a as M,b as E,c as O,d as B,e as G}from"./dialog-CQTA4pg1.js";import{T as pe,a as ue,b as U,c as x,d as xe,e as j}from"./table-B1mxUS1v.js";import{H as f,a5 as je,k as fe,V as ge,q as ve,a6 as Ne,w as Ce}from"./index.min-fvaCWwiU.js";import{S as N}from"./spinner-McTJFRVv.js";import{r as l}from"./app-BHuVDAkc.js";import"./preload-helper-PPVm8Dsz.js";import"./client-Bx265bNG.js";import"./index-CYxWbFTv.js";import"./index-D5-0xbEa.js";import"./utils-CDN07tui.js";import"./skeleton-A7behTLO.js";import"./media-status-badge-DETbNkVM.js";import"./useRenderElement-D0Q1kVud.js";import"./useBaseUiId-BvJSLVy2.js";import"./useValueAsRef-GoV-SdOe.js";import"./media-teaser-CTZEtwns.js";import"./check-BEKQ83Eb.js";import"./createLucideIcon-GXN1tXoc.js";import"./useLabelableId-CyGgmgle.js";import"./valueToPercent-CmxdyyhM.js";import"./slot-CUYGZ4Fv.js";import"./hamster-icon-DOXrnfMg.js";const A={name:"",type:"discord",enabled:!0,settings:{},onGrab:!1,onDownloadComplete:!0,onImportComplete:!0,onImportFailed:!0,onUpgrade:!0,onHealthIssue:!0,includeMusic:!0,includeMovies:!0,includeTv:!0,includeBooks:!0},ye={discord:"Discord",telegram:"Telegram",pushover:"Pushover",slack:"Slack",gotify:"Gotify",email:"Email"};function be(){const[b,L]=l.useState([]),[V,R]=l.useState([]),[$,z]=l.useState(!0),[_,h]=l.useState(!1),[q,g]=l.useState(!1),[r,k]=l.useState(null),[t,o]=l.useState(A),[T,F]=l.useState(!1),[I,D]=l.useState(!1),[p,u]=l.useState(null),[w,S]=l.useState(!1);l.useEffect(()=>{C(),J()},[]);const C=async()=>{try{const s=await fetch("/api/v1/notifications");if(s.ok){const a=await s.json();L(a)}}catch(s){console.error("Failed to fetch providers:",s),i.error("Failed to load notification providers")}finally{z(!1)}},J=async()=>{try{const s=await fetch("/api/v1/notifications/types");if(s.ok){const a=await s.json();R(a)}}catch(s){console.error("Failed to fetch provider types:",s)}},Q=()=>{k(null),o(A),u(null),h(!0)},Y=s=>{k(s),o({name:s.name,type:s.type,enabled:s.enabled,settings:{...s.settings},onGrab:s.onGrab,onDownloadComplete:s.onDownloadComplete,onImportComplete:s.onImportComplete,onImportFailed:s.onImportFailed,onUpgrade:s.onUpgrade,onHealthIssue:s.onHealthIssue,includeMusic:s.includeMusic,includeMovies:s.includeMovies,includeTv:s.includeTv,includeBooks:s.includeBooks}),u(null),h(!0)},K=()=>V.find(s=>s.type===t.type),W=async()=>{if(!r){i.error("Save the provider first, then test");return}D(!0),u(null);try{const a=await(await fetch(`/api/v1/notifications/${r.id}/test`,{method:"POST"})).json();u(a),a.success?i.success("Test notification sent successfully!"):i.error(a.error||"Test failed")}catch{u({success:!1,error:"Connection failed"}),i.error("Connection failed")}finally{D(!1)}},X=async()=>{if(!t.name){i.error("Please enter a name");return}F(!0);try{const s=r?`/api/v1/notifications/${r.id}`:"/api/v1/notifications",v=await fetch(s,{method:r?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(v.ok)i.success(r?"Provider updated":"Provider added"),h(!1),C();else{const se=await v.json();i.error(se.error||"Failed to save")}}catch(s){console.error("Failed to save:",s),i.error("Failed to save provider")}finally{F(!1)}},Z=async()=>{if(r){S(!0);try{(await fetch(`/api/v1/notifications/${r.id}`,{method:"DELETE"})).ok?(i.success("Provider deleted"),g(!1),h(!1),C()):i.error("Failed to delete provider")}catch(s){console.error("Failed to delete:",s),i.error("Failed to delete provider")}finally{S(!1)}}},ee=()=>{const s=K();return s?s.fields.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{htmlFor:a.name,children:[a.label," ",a.required&&"*"]}),e.jsx(P,{id:a.name,type:a.type==="password"?"password":a.type==="number"?"number":"text",value:t.settings[a.name]||"",onChange:v=>o({...t,settings:{...t.settings,[a.name]:v.target.value}}),placeholder:a.label})]},a.name)):null};return e.jsxs(ie,{title:"Notifications",actions:e.jsxs(d,{onClick:Q,children:[e.jsx(f,{icon:Ce,className:"h-4 w-4 mr-2"}),"Add Provider"]}),children:[e.jsx(te,{title:"Notifications"}),e.jsx("div",{className:"space-y-6",children:e.jsxs(le,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Notification Providers"}),e.jsx(me,{children:"Configure notification providers to receive alerts about downloads, imports, and system events."})]}),e.jsx(he,{children:$?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(N,{className:"size-6 text-muted-foreground"})}):b.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No notification providers configured."}),e.jsx("p",{className:"mt-2",children:"Add a provider to receive notifications."})]}):e.jsxs(pe,{children:[e.jsx(ue,{children:e.jsxs(U,{children:[e.jsx(x,{children:"Name"}),e.jsx(x,{children:"Type"}),e.jsx(x,{children:"Events"}),e.jsx(x,{children:"Status"}),e.jsx(x,{className:"w-24"})]})}),e.jsx(xe,{children:b.map(s=>e.jsxs(U,{children:[e.jsx(j,{className:"font-medium",children:s.name}),e.jsx(j,{children:e.jsx(y,{variant:"outline",className:"capitalize",children:ye[s.type]||s.type})}),e.jsx(j,{className:"text-muted-foreground text-sm",children:[s.onGrab&&"Grab",s.onImportComplete&&"Import",s.onImportFailed&&"Failed",s.onUpgrade&&"Upgrade",s.onHealthIssue&&"Health"].filter(Boolean).join(", ")||"None"}),e.jsx(j,{children:s.enabled?e.jsx(y,{variant:"default",className:"bg-green-500",children:"Enabled"}):e.jsx(y,{variant:"secondary",children:"Disabled"})}),e.jsx(j,{children:e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>Y(s),children:e.jsx(f,{icon:je,className:"h-4 w-4"})})})]},s.id))})]})})]})}),e.jsx(H,{open:_,onOpenChange:h,children:e.jsxs(M,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(E,{children:[e.jsx(O,{children:r?"Edit Notification Provider":"Add Notification Provider"}),e.jsx(B,{children:"Configure your notification provider settings."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Name *"}),e.jsx(P,{id:"name",value:t.name,onChange:s=>o({...t,name:s.target.value}),placeholder:"My Discord"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"type",children:"Type"}),e.jsxs(ae,{value:t.type,onValueChange:s=>o({...t,type:s,settings:{}}),children:[e.jsx(ne,{id:"type",children:e.jsx(oe,{})}),e.jsxs(re,{children:[e.jsx(m,{value:"discord",children:"Discord"}),e.jsx(m,{value:"telegram",children:"Telegram"}),e.jsx(m,{value:"pushover",children:"Pushover"}),e.jsx(m,{value:"slack",children:"Slack"}),e.jsx(m,{value:"gotify",children:"Gotify"}),e.jsx(m,{value:"email",children:"Email"})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-2 border-t",children:[e.jsx(n,{className:"text-base font-medium",children:"Provider Settings"}),ee()]}),e.jsxs("div",{className:"space-y-4 pt-2 border-t",children:[e.jsx(n,{className:"text-base font-medium",children:"Trigger on Events"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"onGrab",checked:t.onGrab,onCheckedChange:s=>o({...t,onGrab:!!s})}),e.jsx(n,{htmlFor:"onGrab",className:"font-normal cursor-pointer",children:"On Grab"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"onDownloadComplete",checked:t.onDownloadComplete,onCheckedChange:s=>o({...t,onDownloadComplete:!!s})}),e.jsx(n,{htmlFor:"onDownloadComplete",className:"font-normal cursor-pointer",children:"On Download"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"onImportComplete",checked:t.onImportComplete,onCheckedChange:s=>o({...t,onImportComplete:!!s})}),e.jsx(n,{htmlFor:"onImportComplete",className:"font-normal cursor-pointer",children:"On Import"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"onImportFailed",checked:t.onImportFailed,onCheckedChange:s=>o({...t,onImportFailed:!!s})}),e.jsx(n,{htmlFor:"onImportFailed",className:"font-normal cursor-pointer",children:"On Import Failed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"onUpgrade",checked:t.onUpgrade,onCheckedChange:s=>o({...t,onUpgrade:!!s})}),e.jsx(n,{htmlFor:"onUpgrade",className:"font-normal cursor-pointer",children:"On Upgrade"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"onHealthIssue",checked:t.onHealthIssue,onCheckedChange:s=>o({...t,onHealthIssue:!!s})}),e.jsx(n,{htmlFor:"onHealthIssue",className:"font-normal cursor-pointer",children:"On Health Issue"})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-2 border-t",children:[e.jsx(n,{className:"text-base font-medium",children:"Include Media Types"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"includeMusic",checked:t.includeMusic,onCheckedChange:s=>o({...t,includeMusic:!!s})}),e.jsx(n,{htmlFor:"includeMusic",className:"font-normal cursor-pointer",children:"Music"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"includeMovies",checked:t.includeMovies,onCheckedChange:s=>o({...t,includeMovies:!!s})}),e.jsx(n,{htmlFor:"includeMovies",className:"font-normal cursor-pointer",children:"Movies"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"includeTv",checked:t.includeTv,onCheckedChange:s=>o({...t,includeTv:!!s})}),e.jsx(n,{htmlFor:"includeTv",className:"font-normal cursor-pointer",children:"TV Shows"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"includeBooks",checked:t.includeBooks,onCheckedChange:s=>o({...t,includeBooks:!!s})}),e.jsx(n,{htmlFor:"includeBooks",className:"font-normal cursor-pointer",children:"Books"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(c,{id:"enabled",checked:t.enabled,onCheckedChange:s=>o({...t,enabled:!!s})}),e.jsx(n,{htmlFor:"enabled",className:"font-normal cursor-pointer",children:"Enabled"})]}),p&&e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-md ${p.success?"bg-green-500/10 text-green-600":"bg-destructive/10 text-destructive"}`,children:[e.jsx(f,{icon:p.success?fe:ge,className:"h-5 w-5"}),e.jsx("span",{children:p.success?"Test notification sent!":p.error||"Test failed"})]})]}),e.jsxs(G,{className:"flex-col sm:flex-row gap-2",children:[r&&e.jsxs(d,{variant:"destructive",onClick:()=>g(!0),className:"sm:mr-auto",children:[e.jsx(f,{icon:ve,className:"h-4 w-4 mr-2"}),"Delete"]}),r&&e.jsxs(d,{variant:"outline",onClick:W,disabled:I,children:[I?e.jsx(N,{className:"mr-2"}):e.jsx(f,{icon:Ne,className:"h-4 w-4 mr-2"}),"Test"]}),e.jsxs(d,{onClick:X,disabled:T,children:[T&&e.jsx(N,{className:"mr-2"}),r?"Save":"Add"]})]})]})}),e.jsx(H,{open:q,onOpenChange:g,children:e.jsxs(M,{children:[e.jsxs(E,{children:[e.jsxs(O,{children:["Delete ",r?.name,"?"]}),e.jsx(B,{children:"This will remove the notification provider. You will no longer receive notifications from this provider."})]}),e.jsxs(G,{children:[e.jsx(d,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsxs(d,{variant:"destructive",onClick:Z,disabled:w,children:[w&&e.jsx(N,{className:"mr-2"}),"Delete"]})]})]})})]})}be.__docgenInfo={description:"",methods:[],displayName:"Notifications"};export{be as default};
