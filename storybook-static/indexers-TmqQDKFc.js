import{j as e}from"./jsx-runtime-u17CrQMm.js";import{H as me,e as l,t as s}from"./app-CFoDCqX-.js";import{r as a}from"./app-BHuVDAkc.js";import{A as ue}from"./app-layout-CTvh2ZE0.js";import{B as i}from"./button-B9kPMW4q.js";import{C as B,a as q,b as $,c as _,d as M}from"./card-BT9UEfea.js";import{D as Y,a as V,b as G,c as Q,d as W,e as X}from"./dialog-CQTA4pg1.js";import{A as je,a as fe,b as ge,c as ye,d as ve,e as we,f as be,g as Ce}from"./alert-dialog-B3SDlAxj.js";import{I as m}from"./input-Bw95PIWX.js";import{S as O}from"./switch-FMiJ_scT.js";import{B as Z}from"./badge-B6bn15vN.js";import{T as Ne,a as Ie,b as ee,c as y,d as Se,e as v}from"./table-B1mxUS1v.js";import{H as w,a0 as Te,w as Pe,ab as De,l as ke}from"./index.min-fvaCWwiU.js";import"./preload-helper-PPVm8Dsz.js";import"./client-Bx265bNG.js";import"./index-CYxWbFTv.js";import"./index-D5-0xbEa.js";import"./utils-CDN07tui.js";import"./skeleton-A7behTLO.js";import"./spinner-McTJFRVv.js";import"./createLucideIcon-GXN1tXoc.js";import"./media-status-badge-DETbNkVM.js";import"./useRenderElement-D0Q1kVud.js";import"./useBaseUiId-BvJSLVy2.js";import"./useValueAsRef-GoV-SdOe.js";import"./media-teaser-CTZEtwns.js";import"./check-BEKQ83Eb.js";import"./useLabelableId-CyGgmgle.js";import"./valueToPercent-CmxdyyhM.js";import"./slot-CUYGZ4Fv.js";import"./hamster-icon-DOXrnfMg.js";function Ae(){const[U,re]=a.useState([]),[t,se]=a.useState(null),[K,ae]=a.useState(!0),[b,C]=a.useState(null),[ne,N]=a.useState(!1),[o,L]=a.useState(null),[I,S]=a.useState(""),[d,T]=a.useState(""),[c,P]=a.useState(""),[z,D]=a.useState(!0),[te,k]=a.useState(!1),[x,A]=a.useState(""),[h,F]=a.useState(""),[H,E]=a.useState(!0),[u,j]=a.useState(!1),[f,g]=a.useState(!1),p=async()=>{try{const[r,n]=await Promise.all([fetch("/api/v1/indexers"),fetch("/api/v1/prowlarr")]);r.ok&&re(await r.json()),n.ok&&se(await n.json())}catch{s.error("Failed to load settings")}finally{ae(!1)}};a.useEffect(()=>{p()},[]);const R=r=>{r?(L(r),S(r.name),T(r.url),P(r.apiKey),D(r.enabled)):(L(null),S(""),T(""),P(""),D(!0)),N(!0)},ie=async()=>{if(!d||!c){s.error("URL and API key are required");return}g(!0);try{const n=await(await fetch("/api/v1/indexers/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:d,apiKey:c})})).json();n.success?s.success("Connection successful"):s.error(n.error||"Connection failed")}catch{s.error("Test failed")}finally{g(!1)}},le=async()=>{if(!I.trim()||!d.trim()||!c.trim()){s.error("All fields are required");return}j(!0);try{const r=o?"PUT":"POST",n=o?`/api/v1/indexers/${o.id}`:"/api/v1/indexers",J=await fetch(n,{method:r,headers:{"Content-Type":"application/json"},body:JSON.stringify({name:I,url:d,apiKey:c,enabled:z})});if(J.ok)s.success(o?"Indexer updated":"Indexer added"),N(!1),p();else{const pe=await J.json();s.error(pe.error||"Failed to save indexer")}}catch{s.error("Failed to save indexer")}finally{j(!1)}},oe=async r=>{try{(await fetch(`/api/v1/indexers/${r}`,{method:"DELETE"})).ok?(s.success("Indexer deleted"),p()):s.error("Failed to delete indexer")}catch{s.error("Failed to delete indexer")}},de=async r=>{try{(await fetch(`/api/v1/indexers/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...r,enabled:!r.enabled})})).ok&&p()}catch{s.error("Failed to update indexer")}},ce=()=>{t?(A(t.url),F(t.apiKey),E(t.enabled)):(A(""),F(""),E(!0)),k(!0)},xe=async()=>{if(!x||!h){s.error("URL and API key are required");return}g(!0);try{const n=await(await fetch("/api/v1/prowlarr/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:x,apiKey:h})})).json();n.success?s.success(`Connected to Prowlarr ${n.version}`):s.error(n.error||"Connection failed")}catch{s.error("Test failed")}finally{g(!1)}},he=async()=>{if(!x.trim()||!h.trim()){s.error("URL and API key are required");return}j(!0);try{(await fetch("/api/v1/prowlarr",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:x,apiKey:h,enabled:H})})).ok?(s.success("Prowlarr settings saved"),k(!1),p()):s.error("Failed to save settings")}catch{s.error("Failed to save settings")}finally{j(!1)}};return e.jsxs(ue,{title:"Indexers",children:[e.jsx(me,{title:"Indexers"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(B,{children:[e.jsx(q,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx($,{children:"Prowlarr Integration"}),e.jsx(_,{children:"Connect to Prowlarr for centralized indexer management"})]}),e.jsx(i,{onClick:ce,children:t?.configured?"Edit":"Configure"})]})}),e.jsx(M,{children:K?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Loading..."}):t?.configured?e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:t.url}),e.jsx("div",{className:"flex items-center gap-2",children:t.enabled?e.jsxs(Z,{variant:"default",className:"bg-green-600",children:[e.jsx(w,{icon:Te,className:"mr-1 size-3"}),"Enabled"]}):e.jsx(Z,{variant:"secondary",children:"Disabled"})})]})}):e.jsx("p",{className:"text-muted-foreground",children:"Prowlarr is not configured. Connect to Prowlarr to automatically sync your indexers."})})]}),e.jsx(Y,{open:te,onOpenChange:k,children:e.jsxs(V,{children:[e.jsxs(G,{children:[e.jsx(Q,{children:"Prowlarr Settings"}),e.jsx(W,{children:"Connect to your Prowlarr instance for centralized indexer management."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"prowlarr-url",children:"Prowlarr URL"}),e.jsx(m,{id:"prowlarr-url",placeholder:"http://localhost:9696",value:x,onChange:r=>A(r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"prowlarr-apikey",children:"API Key"}),e.jsx(m,{id:"prowlarr-apikey",type:"password",placeholder:"Your Prowlarr API key",value:h,onChange:r=>F(r.target.value)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{id:"prowlarr-enabled",checked:H,onCheckedChange:E}),e.jsx(l,{htmlFor:"prowlarr-enabled",children:"Enabled"})]})]}),e.jsxs(X,{children:[e.jsx(i,{variant:"outline",onClick:xe,disabled:f,children:f?"Testing...":"Test"}),e.jsx(i,{onClick:he,disabled:u,children:u?"Saving...":"Save"})]})]})}),e.jsx(Y,{open:ne,onOpenChange:N,children:e.jsxs(V,{children:[e.jsxs(G,{children:[e.jsx(Q,{children:o?"Edit Indexer":"Add Indexer"}),e.jsx(W,{children:"Configure a Newznab-compatible indexer for searching releases."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"indexer-name",children:"Name"}),e.jsx(m,{id:"indexer-name",placeholder:"My Indexer",value:I,onChange:r=>S(r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"indexer-url",children:"URL"}),e.jsx(m,{id:"indexer-url",placeholder:"https://indexer.example.com",value:d,onChange:r=>T(r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"indexer-apikey",children:"API Key"}),e.jsx(m,{id:"indexer-apikey",type:"password",placeholder:"Your indexer API key",value:c,onChange:r=>P(r.target.value)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{id:"indexer-enabled",checked:z,onCheckedChange:D}),e.jsx(l,{htmlFor:"indexer-enabled",children:"Enabled"})]})]}),e.jsxs(X,{children:[e.jsx(i,{variant:"outline",onClick:ie,disabled:f,children:f?"Testing...":"Test"}),e.jsx(i,{onClick:le,disabled:u,children:u?"Saving...":"Save"})]})]})}),e.jsxs(B,{children:[e.jsx(q,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx($,{children:"Direct Indexers"}),e.jsx(_,{children:"Add Newznab-compatible indexers directly"})]}),e.jsxs(i,{onClick:()=>R(),children:[e.jsx(w,{icon:Pe,className:"mr-2 size-4"}),"Add Indexer"]})]})}),e.jsx(M,{children:K?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):U.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No indexers configured. Add an indexer or connect to Prowlarr."}):e.jsxs(Ne,{children:[e.jsx(Ie,{children:e.jsxs(ee,{children:[e.jsx(y,{children:"Name"}),e.jsx(y,{children:"URL"}),e.jsx(y,{children:"Status"}),e.jsx(y,{className:"w-[120px]",children:"Actions"})]})}),e.jsx(Se,{children:U.map(r=>e.jsxs(ee,{children:[e.jsx(v,{className:"font-medium",children:r.name}),e.jsx(v,{className:"text-sm text-muted-foreground",children:r.url}),e.jsx(v,{children:e.jsx(O,{checked:r.enabled,onCheckedChange:()=>de(r)})}),e.jsx(v,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>R(r),children:e.jsx(w,{icon:De,className:"size-4"})}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>C(r.id),children:e.jsx(w,{icon:ke,className:"size-4 text-destructive"})})]})})]},r.id))})]})})]})]}),e.jsx(je,{open:b!==null,onOpenChange:()=>C(null),children:e.jsxs(fe,{children:[e.jsxs(ge,{children:[e.jsx(ye,{children:"Delete indexer?"}),e.jsx(ve,{children:"This will permanently remove the indexer. This action cannot be undone."})]}),e.jsxs(we,{children:[e.jsx(be,{children:"Cancel"}),e.jsx(Ce,{onClick:()=>{b&&(oe(b),C(null))},className:"bg-destructive text-destructive-foreground",children:"Delete"})]})]})})]})}Ae.__docgenInfo={description:"",methods:[],displayName:"Indexers"};export{Ae as default};
