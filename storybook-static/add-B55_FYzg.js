import{j as e}from"./jsx-runtime-u17CrQMm.js";import{t as n,H as E,e as C,S as M,a as R,c as $,d as K,C as J,L as U,r as V}from"./app-CFoDCqX-.js";import{A as X}from"./app-layout-CTvh2ZE0.js";import{B as c}from"./button-B9kPMW4q.js";import{I as G}from"./input-Bw95PIWX.js";import{B as W}from"./badge-B6bn15vN.js";import{C as h,a as Y,b as Z,d as u}from"./card-BT9UEfea.js";import{S as l}from"./skeleton-A7behTLO.js";import{D as ee,a as se,b as ae,c as re,d as te,e as ie}from"./dialog-CQTA4pg1.js";import{H as d,A as k,e as ne,k as le,n as oe}from"./index.min-fvaCWwiU.js";import{S as D}from"./spinner-McTJFRVv.js";import{r as a}from"./app-BHuVDAkc.js";import"./preload-helper-PPVm8Dsz.js";import"./client-Bx265bNG.js";import"./index-CYxWbFTv.js";import"./index-D5-0xbEa.js";import"./utils-CDN07tui.js";import"./media-status-badge-DETbNkVM.js";import"./useRenderElement-D0Q1kVud.js";import"./useBaseUiId-BvJSLVy2.js";import"./useValueAsRef-GoV-SdOe.js";import"./media-teaser-CTZEtwns.js";import"./check-BEKQ83Eb.js";import"./createLucideIcon-GXN1tXoc.js";import"./useLabelableId-CyGgmgle.js";import"./valueToPercent-CmxdyyhM.js";import"./slot-CUYGZ4Fv.js";import"./hamster-icon-DOXrnfMg.js";function ce(){const[t,I]=a.useState(""),[f,j]=a.useState([]),[x,g]=a.useState(!1),[F,P]=a.useState(!1),[y,L]=a.useState([]),[N,z]=a.useState(!0),[o,q]=a.useState(null),[B,m]=a.useState(!1),[i,S]=a.useState(""),[b,H]=a.useState(!0),[v,w]=a.useState(!1);a.useEffect(()=>{fetch("/api/v1/qualityprofiles").then(s=>s.json()).then(s=>{L(s),s.length>0&&S(s[0].id)}).catch(s=>{console.error("Failed to load options:",s),n.error("Failed to load configuration options")}).finally(()=>z(!1))},[]);const A=a.useCallback(async()=>{if(!(!t.trim()||t.length<2)){g(!0),P(!0);try{const s=await fetch(`/api/v1/artists/search?q=${encodeURIComponent(t)}`);if(s.ok){const r=await s.json();j(r)}}catch(s){console.error("Search failed:",s),n.error("Search failed")}finally{g(!1)}}},[t]),O=s=>{s.key==="Enter"&&A()},T=s=>{q(s),m(!0)},Q=async()=>{if(o){if(!i){n.error("Please select a quality profile");return}w(!0);try{const s=await fetch("/api/v1/artists",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({musicbrainzId:o.musicbrainzId,qualityProfileId:i,monitored:b})});if(s.ok){const r=await s.json();n.success(`${o.name} added to library`),m(!1),j(_=>_.map(p=>p.musicbrainzId===o.musicbrainzId?{...p,inLibrary:!0}:p)),V.visit(`/artist/${r.id}`)}else{const r=await s.json();n.error(r.error||"Failed to add artist")}}catch(s){console.error("Failed to add artist:",s),n.error("Failed to add artist")}finally{w(!1)}}};return e.jsxs(X,{title:"Add Artist",actions:e.jsx(c,{variant:"outline",asChild:!0,children:e.jsxs(U,{href:"/library",children:[e.jsx(d,{icon:oe,className:"h-4 w-4 mr-2"}),"Back to Library"]})}),children:[e.jsx(E,{title:"Add Artist"}),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs(h,{children:[e.jsx(Y,{children:e.jsx(Z,{children:"Search MusicBrainz"})}),e.jsxs(u,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(d,{icon:k,className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search for an artist...",value:t,onChange:s=>I(s.target.value),onKeyDown:O,className:"pl-9",autoFocus:!0})]}),e.jsx(c,{onClick:A,disabled:x||t.length<2,children:x?e.jsx(D,{}):"Search"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Search for artists on MusicBrainz to add them to your library."})]})]}),x?e.jsx("div",{className:"space-y-2",children:Array.from({length:5}).map((s,r)=>e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-4 p-4",children:[e.jsx(l,{className:"h-16 w-16 rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(l,{className:"h-4 w-1/3"}),e.jsx(l,{className:"h-3 w-1/2"})]}),e.jsx(l,{className:"h-9 w-20"})]})},r))}):f.length>0?e.jsx("div",{className:"space-y-2",children:f.map(s=>e.jsx(h,{className:s.inLibrary?"opacity-60":"",children:e.jsxs(u,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"h-16 w-16 rounded bg-muted flex-shrink-0 flex items-center justify-center",children:e.jsx(d,{icon:ne,className:"h-8 w-8 text-muted-foreground/50"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"font-medium",children:[s.name,s.disambiguation&&e.jsxs("span",{className:"text-muted-foreground ml-2",children:["(",s.disambiguation,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground flex-wrap",children:[s.type&&e.jsx("span",{children:s.type}),s.country&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:s.country})]}),s.beginDate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:[s.beginDate,s.endDate?` - ${s.endDate}`:""]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.inLibrary?e.jsxs(W,{variant:"outline",className:"gap-1",children:[e.jsx(d,{icon:le,className:"h-3 w-3"}),"In Library"]}):e.jsx(c,{size:"sm",onClick:()=>T(s),children:"Add"})})]})},s.musicbrainzId))}):F?e.jsx(h,{children:e.jsxs(u,{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"rounded-full bg-muted p-6 mb-4",children:e.jsx(d,{icon:k,className:"h-12 w-12 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No artists found"}),e.jsx("p",{className:"text-muted-foreground",children:"Try a different search term or check your spelling."})]})}):null]}),e.jsx(ee,{open:B,onOpenChange:m,children:e.jsxs(se,{children:[e.jsxs(ae,{children:[e.jsxs(re,{children:["Add ",o?.name]}),e.jsx(te,{children:"Configure how this artist will be added to your library."})]}),N?e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx(l,{className:"h-10 w-full"}),e.jsx(l,{className:"h-10 w-full"})]}):e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"qualityProfile",children:"Quality Profile"}),e.jsxs(M,{value:i,onValueChange:S,children:[e.jsx(R,{id:"qualityProfile",children:i?y.find(s=>s.id===i)?.name:e.jsx("span",{className:"text-muted-foreground",children:"Select quality profile"})}),e.jsx($,{children:y.map(s=>e.jsx(K,{value:String(s.id),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{id:"monitored",checked:b,onCheckedChange:s=>H(s)}),e.jsx(C,{htmlFor:"monitored",className:"font-normal cursor-pointer",children:"Automatically request new releases"})]})]}),e.jsxs(ie,{children:[e.jsx(c,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(c,{onClick:Q,disabled:v||N||!i,children:v?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2"}),"Adding..."]}):"Add Artist"})]})]})})]})}ce.__docgenInfo={description:"",methods:[],displayName:"AddArtist"};export{ce as default};
