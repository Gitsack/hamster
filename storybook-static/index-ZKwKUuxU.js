import{j as e}from"./jsx-runtime-u17CrQMm.js";import{a4 as Ya,a5 as Bt,H as Za,a6 as er,a7 as Y,t as d,r as le,C as Ut}from"./app-CFoDCqX-.js";import{A as sr,D as ws,a as Ns,b as Ss,e as Vt,d as tr,c as Wt}from"./app-layout-CTvh2ZE0.js";import{B as u}from"./button-B9kPMW4q.js";import{I as ar}from"./input-Bw95PIWX.js";import{C as S,d as k}from"./card-BT9UEfea.js";import{B as L}from"./badge-B6bn15vN.js";import{S as I}from"./skeleton-A7behTLO.js";import{T as ks,a as Is,b as B,c as de}from"./tabs-BOg1k8aW.js";import{D as rr,a as nr,b as ir,c as or,d as lr,e as dr}from"./dialog-CQTA4pg1.js";import{T as cr,a as mr,b as Ht,c as Ce,d as ur,e as C}from"./table-B1mxUS1v.js";import{z as zs,e as Xt,I as Yt,j as Zt,H as c,O as hr,A as Ts,X as xr,B as _t,T as Gt,C as fr,P as As,k as ce,w as Z,d as pr,a3 as Jt,o as Cs,a4 as gr,v as jr,n as vr}from"./index.min-fvaCWwiU.js";import{S as ee}from"./spinner-McTJFRVv.js";import{r as n}from"./app-BHuVDAkc.js";import{M as br}from"./media-teaser-CTZEtwns.js";import"./preload-helper-PPVm8Dsz.js";import"./client-Bx265bNG.js";import"./index-CYxWbFTv.js";import"./index-D5-0xbEa.js";import"./utils-CDN07tui.js";import"./media-status-badge-DETbNkVM.js";import"./useRenderElement-D0Q1kVud.js";import"./useBaseUiId-BvJSLVy2.js";import"./useValueAsRef-GoV-SdOe.js";import"./check-BEKQ83Eb.js";import"./createLucideIcon-GXN1tXoc.js";import"./useLabelableId-CyGgmgle.js";import"./valueToPercent-CmxdyyhM.js";import"./slot-CUYGZ4Fv.js";import"./hamster-icon-DOXrnfMg.js";class yr extends n.Component{constructor(b){super(b),this.state={hasError:!1,error:null}}static getDerivedStateFromError(b){return{hasError:!0,error:b}}componentDidCatch(b,U){console.error("Search page error:",b,U)}render(){return this.state.hasError?e.jsxs("div",{className:"p-4 border border-destructive rounded bg-destructive/10 text-destructive",children:[e.jsx("h2",{className:"font-bold",children:"Something went wrong"}),e.jsx("pre",{className:"text-sm mt-2 whitespace-pre-wrap",children:this.state.error?.message}),e.jsx("button",{onClick:()=>this.setState({hasError:!1,error:null}),className:"mt-2 px-3 py-1 bg-destructive text-destructive-foreground rounded",children:"Try again"})]}):this.props.children}}const wr=[{id:"select",label:"Select",visible:!0},{id:"protocol",label:"Protocol",visible:!0},{id:"age",label:"Age",visible:!0},{id:"title",label:"Title",visible:!0},{id:"indexer",label:"Indexer",visible:!0},{id:"size",label:"Size",visible:!0},{id:"grabs",label:"Grabs",visible:!0},{id:"category",label:"Category",visible:!0},{id:"actions",label:"Actions",visible:!0}],Kt=["movies","tv","music","books"],Nr={movies:{label:"Movies",icon:Zt},tv:{label:"TV Shows",icon:Yt},music:{label:"Music",icon:Xt},books:{label:"Books",icon:zs}};function Qt(w){if(w===0)return"0 B";const b=1024,U=["B","KB","MB","GB","TB"],V=Math.floor(Math.log(w)/Math.log(b));return parseFloat((w/Math.pow(b,V)).toFixed(1))+" "+U[V]}function Sr(w){try{const b=new Date(w),V=new Date().getTime()-b.getTime(),y=Math.floor(V/(1e3*60*60*24));if(y===0)return"Today";if(y===1)return"1 day";if(y<7)return`${y} days`;if(y<30){const M=Math.floor(y/7);return`${M} week${M>1?"s":""}`}if(y<365){const M=Math.floor(y/30);return`${M} month${M>1?"s":""}`}const m=Math.floor(y/365);return`${m} year${m>1?"s":""}`}catch{return w}}function kr(){const w=typeof window<"u"?new URLSearchParams(window.location.search):null,b=w?.get("mode")||"movies",U=w?.get("type")||"artist",[V,y]=n.useState(["movies"]),[m,M]=n.useState(b),[W,ze]=n.useState(U),Ds=n.useCallback(s=>{M(s);const t=new URL(window.location.href);t.searchParams.set("mode",s),window.history.replaceState({},"",t.toString())},[]),[j,De]=n.useState(""),[P,Rs]=n.useState(!1),[se,ea]=n.useState(!1),[me,Fs]=n.useState([]),[Re,Ls]=n.useState([]),[Fe,sa]=n.useState([]),[Le,Me]=n.useState([]),[Pe,$e]=n.useState({}),[Ms,Ps]=n.useState(!1),[Oe,qe]=n.useState([]),[Ee,Be]=n.useState({}),[$s,Os]=n.useState(!1),[qs,ta]=n.useState([]),[Es,aa]=n.useState([]),[Bs,Us]=n.useState(!1),[Vs,Ws]=n.useState(!1),[Ue,Hs]=n.useState([]),[Ve,_s]=n.useState([]),[te,ra]=n.useState("author"),[We,na]=n.useState([]),[ia,oa]=n.useState([]),[z,Gs]=n.useState([]),[ue,Ir]=n.useState([]),[ae,la]=n.useState("age"),[re,Js]=n.useState("asc"),[He,da]=n.useState(wr),[N,H]=n.useState(new Set),[ca,ma]=n.useState([]),[ne,ua]=n.useState(null),[ha,he]=n.useState(!1),[Ks,Qs]=n.useState(!1),[Xs,Ys]=n.useState(!1),[D,xa]=n.useState([]),[xe,fa]=n.useState([]),[_,pa]=n.useState(!0),[_e,ga]=n.useState(null),[G,ja]=n.useState(null),[Ge,Je]=n.useState(!1),[Ke,Qe]=n.useState(!1),[Xe,va]=n.useState(null),[Ye,Ze]=n.useState(!1),[ba,Zs]=n.useState(!1),[es,ss]=n.useState(new Set),[$,ya]=n.useState(null),[ts,fe]=n.useState(!1),[wa,pe]=n.useState(!1),[O,et]=n.useState(null),[Na,st]=n.useState(!1),[as,tt]=n.useState(new Set),[at,rt]=n.useState(!0),{openMoviePreview:ge,openTvShowPreview:je}=Ya(),{providers:rs,loadingIds:nt,observerRef:it}=Bt("movie"),{providers:ns,loadingIds:ot,observerRef:lt}=Bt("tv"),[is,Sa]=n.useState(null),[ve,ka]=n.useState(null),[os,ls]=n.useState(!1),[ds,cs]=n.useState(!1),[Ia,dt]=n.useState(!1),[Ta,ct]=n.useState(!1),[Tr,be]=n.useState(""),[ie,Ar]=n.useState(!0),[Aa,mt]=n.useState(!1),[Ca,ut]=n.useState(!1),[Cr,zr]=n.useState(!0),J=n.useMemo(()=>D.filter(s=>s.mediaType==="movies"),[D]),K=n.useMemo(()=>D.filter(s=>s.mediaType==="tv"),[D]),T=n.useMemo(()=>D.filter(s=>s.mediaType==="music"),[D]),A=n.useMemo(()=>D.filter(s=>s.mediaType==="books"),[D]);n.useEffect(()=>{Ye&&J.length>0&&be(J[0].id)},[Ye,J]),n.useEffect(()=>{ts&&K.length>0&&be(K[0].id)},[ts,K]),n.useEffect(()=>{(Ge||Ke)&&T.length>0&&be(T[0].id)},[Ge,Ke,T]),n.useEffect(()=>{(os||ds)&&A.length>0&&be(A[0].id)},[os,ds,A]);const za=s=>{ga(s),T.length===1?Ct(s,T[0].id):Je(!0)},ye=(s,t)=>{ja(s),ps(t||null),T.length===1?zt(s,T[0].id):Qe(!0)},we=(s,t=!0)=>{va(s),rt(t),J.length===1?Dt(s,J[0].id,t):Ze(!0)},Ne=(s,t=!0)=>{ya(s),rt(t),pe(!0)},Da=s=>{Sa(s),A.length===1?Ft(s,A[0].id):ls(!0)},Ra=s=>{ka(s),A.length===1?Lt(s,A[0].id):cs(!0)},[ht,ms]=n.useState(null),[us,xt]=n.useState(null),[ft,Fa]=n.useState({}),[hs,La]=n.useState({}),[pt,gt]=n.useState(new Set),[xs,jt]=n.useState(new Set),[fs,ps]=n.useState(null);n.useEffect(()=>{fetch("/api/v1/settings").then(s=>s.json()).then(s=>{if(s.enabledMediaTypes?.length>0){const t=[...s.enabledMediaTypes].sort((i,a)=>Kt.indexOf(i)-Kt.indexOf(a));y(t),!s.enabledMediaTypes.includes(m)&&m!=="direct"&&Ds(t[0])}}).catch(console.error)},[]),n.useEffect(()=>{fetch("/api/v1/indexers").then(s=>s.json()).then(s=>oa(s.filter(t=>t.enabled))).catch(console.error),fetch("/api/v1/downloadclients").then(s=>s.json()).then(s=>ma(s.filter(t=>t.enabled))).catch(console.error),Promise.all([fetch("/api/v1/qualityprofiles").then(s=>s.json()),fetch("/api/v1/rootfolders").then(s=>s.json())]).then(([s,t])=>{xa(s),fa(t)}).catch(console.error).finally(()=>pa(!1))},[]);const R=n.useMemo(()=>{let s=[...We];return ue.length>0&&(s=s.filter(t=>t.category?ue.some(i=>t.category?.includes(i)):!1)),s.sort((t,i)=>{let a=0;switch(ae){case"age":a=new Date(t.publishDate).getTime()-new Date(i.publishDate).getTime();break;case"title":a=t.title.localeCompare(i.title);break;case"size":a=t.size-i.size;break;case"indexer":a=t.indexer.localeCompare(i.indexer);break;case"grabs":a=(t.grabs||0)-(i.grabs||0);break;case"category":a=(t.category||"").localeCompare(i.category||"");break}return re==="asc"?a:-a}),s},[We,ue,ae,re]),Se=async()=>{if(!(!j.trim()||j.length<2)){Rs(!0),ea(!0),H(new Set);try{if(m==="direct"){const s=new URLSearchParams({query:j,limit:"100",type:"general"});z.length>0&&s.set("indexerIds",z.join(","));const t=await fetch(`/api/v1/indexers/search?${s}`);t.ok?na(await t.json()):d.error("Search failed")}else if(m==="music")switch(W){case"artist":{const s=await fetch(`/api/v1/artists/search?q=${encodeURIComponent(j)}`);s.ok&&Fs(await s.json());break}case"album":{const s=await fetch(`/api/v1/albums/search?q=${encodeURIComponent(j)}`);s.ok&&Ls(await s.json());break}case"track":{const s=await fetch(`/api/v1/tracks/search?q=${encodeURIComponent(j)}`);s.ok&&sa(await s.json());break}}else if(m==="movies"){const s=await fetch(`/api/v1/movies/search?q=${encodeURIComponent(j)}`);s.ok&&Me(await s.json())}else if(m==="tv"){const s=await fetch(`/api/v1/tvshows/search?q=${encodeURIComponent(j)}`);s.ok&&qe(await s.json())}else if(m==="books")if(te==="author"){const s=await fetch(`/api/v1/authors/search?q=${encodeURIComponent(j)}`);s.ok&&Hs(await s.json())}else{const s=await fetch(`/api/v1/books/search?q=${encodeURIComponent(j)}`);s.ok&&_s(await s.json())}}catch(s){console.error("Search failed:",s),d.error("Search failed")}finally{Rs(!1)}}},Ma=s=>{s.key==="Enter"&&Se()},ke=n.useMemo(()=>[{key:"popular",label:"Popular Movies"},{key:"now_playing",label:"Now in Cinemas"},{key:"trending",label:"Trending This Week"}],[]),Ie=n.useMemo(()=>[{key:"popular",label:"Popular Shows"},{key:"on_the_air",label:"Currently Airing"},{key:"top_rated",label:"Top Rated"},{key:"trending",label:"Trending This Week"}],[]),vt=n.useCallback(async()=>{Ps(!0);let s=ke.length;ke.forEach(async t=>{try{const i=await fetch(`/api/v1/movies/discover?category=${t.key}`);if(i.ok){const a=await i.json();$e(r=>({...r,[t.key]:a.results}))}}catch(i){console.error(`Failed to fetch movie discover ${t.key}:`,i)}finally{s--,s===0&&Ps(!1)}})},[ke]),bt=n.useCallback(async()=>{Os(!0);let s=Ie.length;Ie.forEach(async t=>{try{const i=await fetch(`/api/v1/tvshows/discover?category=${t.key}`);if(i.ok){const a=await i.json();Be(r=>({...r,[t.key]:a.results}))}}catch(i){console.error(`Failed to fetch TV discover ${t.key}:`,i)}finally{s--,s===0&&Os(!1)}})},[Ie]),yt=n.useCallback(async()=>{Us(!0);const s=["justwatch","trakt","tmdb"];let t=s.length;s.forEach(async i=>{try{const a=await fetch(`/api/v1/recommendations/movies?source=${i}`);if(a.ok){const r=await a.json();r.lanes?.length>0&&ta(o=>[...o,...r.lanes])}}catch(a){console.error(`Failed to fetch movie recommendations (${i}):`,a)}finally{t--,t===0&&Us(!1)}})},[]),wt=n.useCallback(async()=>{Ws(!0);const s=["justwatch","trakt","tmdb"];let t=s.length;s.forEach(async i=>{try{const a=await fetch(`/api/v1/recommendations/tv?source=${i}`);if(a.ok){const r=await a.json();r.lanes?.length>0&&aa(o=>[...o,...r.lanes])}}catch(a){console.error(`Failed to fetch TV recommendations (${i}):`,a)}finally{t--,t===0&&Ws(!1)}})},[]),Nt=n.useRef(!1),St=n.useRef(!1),kt=n.useRef(!1),It=n.useRef(!1);n.useEffect(()=>{m==="movies"&&!j?(Nt.current||(Nt.current=!0,vt()),kt.current||(kt.current=!0,yt())):m==="tv"&&!j&&(St.current||(St.current=!0,bt()),It.current||(It.current=!0,wt()))},[m,j,vt,bt,yt,wt]);const Tt=s=>{ae===s?Js(re==="asc"?"desc":"asc"):(la(s),Js("asc"))},Pa=s=>{da(He.map(t=>t.id===s?{...t,visible:!t.visible}:t))},$a=()=>{N.size===R.length?H(new Set):H(new Set(R.map(s=>s.id)))},Oa=s=>{const t=new Set(N);t.has(s)?t.delete(s):t.add(s),H(t)},x=s=>He.find(t=>t.id===s)?.visible??!0,At=s=>{ua(s),he(!0)},qa=async s=>{const t=ne;if(t){if(ca.length===0){d.error("No download client configured. Go to Settings > Download Clients to add one.");return}Qs(!0);try{const i=await fetch("/api/v1/queue/grab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t.title,downloadUrl:t.downloadUrl,size:t.size,indexerId:t.indexerId,indexerName:t.indexer,guid:t.guid})});if(i.ok)return d.success(`Added "${t.title}" to download queue`),he(!1),!0;{const a=await i.json();return d.error(a.error||"Failed to grab release"),!1}}catch(i){return console.error("Failed to grab release:",i),d.error("Failed to grab release"),!1}finally{Qs(!1)}}},Ea=async()=>{if(N.size===0)return;Ys(!0);let s=0,t=0;for(const i of N){const a=R.find(r=>r.id===i);if(a)try{(await fetch("/api/v1/queue/grab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:a.title,downloadUrl:a.downloadUrl,size:a.size,indexerId:a.indexerId,indexerName:a.indexer,guid:a.guid})})).ok?s++:t++}catch{t++}}Ys(!1),s>0&&d.success(`Added ${s} release${s>1?"s":""} to download queue`),t>0&&d.error(`Failed to grab ${t} release${t>1?"s":""}`),H(new Set)},Ct=async(s,t)=>{mt(!0);try{const i=await fetch("/api/v1/artists",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({musicbrainzId:s.musicbrainzId,qualityProfileId:t,requested:ie})});if(i.ok){const a=await i.json();d.success(`${s.name} added to library`),Je(!1),Fs(r=>r.map(o=>o.musicbrainzId===s.musicbrainzId?{...o,inLibrary:!0}:o))}else{const a=await i.json();d.error(a.error||"Failed to add artist")}}catch(i){console.error("Failed to add artist:",i),d.error("Failed to add artist")}finally{mt(!1)}},zt=async(s,t)=>{ut(!0);try{const i=await fetch("/api/v1/albums",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({musicbrainzId:s.musicbrainzId,artistMusicbrainzId:s.artistMusicbrainzId,qualityProfileId:t,requested:ie,searchOnAdd:!0})});if(i.ok){const a=await i.json();d.success(`${s.title} added to library`),Qe(!1),Ls(r=>r.map(o=>o.musicbrainzId===s.musicbrainzId?{...o,inLibrary:!0}:o))}else{const a=await i.json();d.error(a.error||"Failed to add album")}}catch(i){console.error("Failed to add album:",i),d.error("Failed to add album")}finally{ut(!1)}},Dt=async(s,t,i=!0)=>{const a=xe.find(r=>r.mediaType==="movies");if(!a){d.error("No root folder configured for movies. Please add one in Settings.");return}Zs(!0);try{const r=await fetch("/api/v1/movies",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tmdbId:s.tmdbId,title:s.title,year:s.year,qualityProfileId:t,rootFolderId:a.id,requested:ie,searchOnAdd:!0})});if(r.ok){const o=await r.json();d.success(`${s.title} added to library`),Ze(!1),Me(l=>l.map(h=>h.tmdbId===s.tmdbId?{...h,inLibrary:!0,libraryId:o.id,requested:!0}:h)),$e(l=>{const h={};for(const[p,g]of Object.entries(l))h[p]=g.map(v=>v.tmdbId===s.tmdbId?{...v,inLibrary:!0,libraryId:o.id,requested:!0}:v);return h}),i&&le.visit(`/movie/${o.id}`)}else{const o=await r.json();d.error(o.error||"Failed to add movie")}}catch(r){console.error("Failed to add movie:",r),d.error("Failed to add movie")}finally{Zs(!1)}},Rt=async(s,t,i,a=!0)=>{const r=xe.find(o=>o.mediaType==="tv");if(!r){d.error("No root folder configured for TV shows. Please add one in Settings.");return}st(!0);try{const o=await fetch("/api/v1/tvshows",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tmdbId:s.tmdbId,title:s.title,year:s.year,qualityProfileId:t,rootFolderId:r.id,requested:!0,searchOnAdd:!0,selectedSeasons:i?.selectedSeasons,selectedEpisodes:i?.selectedEpisodes})});if(o.ok){const l=await o.json();d.success(`${s.title} added to library`),fe(!1),et(null),qe(h=>h.map(p=>p.tmdbId===s.tmdbId?{...p,inLibrary:!0,libraryId:l.id,requested:!0}:p)),Be(h=>{const p={};for(const[g,v]of Object.entries(h))p[g]=v.map(q=>q.tmdbId===s.tmdbId?{...q,inLibrary:!0,libraryId:l.id,requested:!0}:q);return p}),a&&le.visit(`/tvshow/${l.id}`)}else{const l=await o.json();d.error(l.error||"Failed to add TV show")}}catch(o){console.error("Failed to add TV show:",o),d.error("Failed to add TV show")}finally{st(!1)}},gs=async s=>{if(!s.libraryId||!s.inLibrary)return;const t=s.tmdbId;ss(r=>new Set(r).add(t));const i=r=>{Me(o=>o.map(l=>l.tmdbId===t?r(l):l)),$e(o=>{const l={};for(const[h,p]of Object.entries(o))l[h]=p.map(g=>g.tmdbId===t?r(g):g);return l})},a=s.requested;if(a&&s.hasFile){d.error("Movie has downloaded files. Delete files first before unrequesting."),ss(r=>{const o=new Set(r);return o.delete(t),o});return}i(r=>({...r,requested:!a}));try{const r=await fetch(`/api/v1/movies/${s.libraryId}/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requested:!a})}),o=await r.json();r.ok?o.deleted?(d.success("Removed from library"),i(l=>({...l,inLibrary:!1,libraryId:void 0,requested:!1}))):d.success(a?"Movie unrequested":"Movie requested"):o.hasFile?(i(l=>({...l,requested:a})),d.error("Movie has downloaded files. Delete files first before unrequesting.")):(i(l=>({...l,requested:a})),d.error(o.error||"Failed to update movie"))}catch(r){console.error("Failed to update movie:",r),i(o=>({...o,requested:a})),d.error("Failed to update movie")}finally{ss(r=>{const o=new Set(r);return o.delete(t),o})}},js=async s=>{if(!s.libraryId||!s.inLibrary)return;const t=s.tmdbId;tt(r=>new Set(r).add(t));const i=r=>{qe(o=>o.map(l=>l.tmdbId===t?r(l):l)),Be(o=>{const l={};for(const[h,p]of Object.entries(o))l[h]=p.map(g=>g.tmdbId===t?r(g):g);return l})},a=s.requested;i(r=>({...r,requested:!a}));try{(await fetch(`/api/v1/tvshows/${s.libraryId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({requested:!a})})).ok?d.success(a?"TV show unrequested":"TV show requested"):(i(o=>({...o,requested:a})),d.error("Failed to update TV show"))}catch(r){console.error("Failed to update TV show:",r),i(o=>({...o,requested:a})),d.error("Failed to update TV show")}finally{tt(r=>{const o=new Set(r);return o.delete(t),o})}},Ft=async(s,t,i=!0)=>{const a=xe.find(r=>r.mediaType==="books");if(!a){d.error("No root folder configured for books. Please add one in Settings.");return}dt(!0);try{const r=await fetch("/api/v1/authors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({openlibraryId:s.openlibraryId,name:s.name,qualityProfileId:t,rootFolderId:a.id,requested:ie,addBooks:i})});if(r.ok){const o=await r.json();d.success(`${s.name} added to library`),ls(!1),Hs(l=>l.map(h=>h.openlibraryId===s.openlibraryId?{...h,inLibrary:!0}:h))}else{const o=await r.json();d.error(o.error||"Failed to add author")}}catch(r){console.error("Failed to add author:",r),d.error("Failed to add author")}finally{dt(!1)}},Lt=async(s,t)=>{const i=xe.find(a=>a.mediaType==="books");if(!i){d.error("No root folder configured for books. Please add one in Settings.");return}ct(!0);try{const a=await fetch("/api/v1/books",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({openlibraryId:s.openlibraryId,title:s.title,authorKey:s.authorKey,authorName:s.authorName,qualityProfileId:t,rootFolderId:i.id,requested:ie})});if(a.ok){const r=await a.json();d.success(`${s.title} added to library`),cs(!1),_s(o=>o.map(l=>l.openlibraryId===s.openlibraryId?{...l,inLibrary:!0}:l))}else{const r=await a.json();d.error(r.error||"Failed to add book")}}catch(a){console.error("Failed to add book:",a),d.error("Failed to add book")}finally{ct(!1)}},Mt=async s=>{if(!(ft[s]||pt.has(s))){gt(t=>new Set(t).add(s));try{const t=await fetch(`/api/v1/artists/${s}/albums`);if(t.ok){const i=await t.json();Fa(a=>({...a,[s]:i}))}}catch(t){console.error("Failed to fetch artist albums:",t)}finally{gt(t=>{const i=new Set(t);return i.delete(s),i})}}},Ba=async s=>{if(!(hs[s]||xs.has(s))){jt(t=>new Set(t).add(s));try{const t=await fetch(`/api/v1/albums/${s}/tracks`);if(t.ok){const i=await t.json();La(a=>({...a,[s]:i}))}}catch(t){console.error("Failed to fetch album tracks:",t)}finally{jt(t=>{const i=new Set(t);return i.delete(s),i})}}},Ua=s=>{ht===s?ms(null):(ms(s),Mt(s))},Pt=s=>{us===s?xt(null):(xt(s),Ba(s))},$t=(s,t)=>{ze("artist"),De(s),me.find(a=>a.musicbrainzId===t)?(ms(t),Mt(t)):Se()},Va=(s,t)=>{ze("album"),De(s),Se()},[Ot,Wa]=n.useState(new Set),qt=n.useCallback(s=>{Wa(t=>new Set(t).add(s))},[]),Q=({field:s,children:t})=>e.jsx(Ce,{className:"cursor-pointer hover:bg-muted/50 select-none",onClick:()=>Tt(s),children:e.jsxs("div",{className:"flex items-center gap-1",children:[t,ae===s&&(re==="asc"?e.jsx(c,{icon:_t,className:"h-3 w-3"}):e.jsx(c,{icon:Gt,className:"h-3 w-3"}))]})}),Te=(s,t,i,a)=>{const r=`search-${s.id}`,o=s.imageUrl&&!Ot.has(r);return e.jsx(S,{className:`${s.inLibrary?"opacity-60":""} cursor-pointer hover:bg-muted/50 transition-colors`,onClick:i,children:e.jsxs(k,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"h-16 w-16 rounded bg-muted flex-shrink-0 overflow-hidden",children:o?e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-full h-full object-cover",onError:()=>qt(r)}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(c,{icon:t,className:"h-8 w-8 text-muted-foreground/50"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground flex-wrap",children:[s.subtitle&&e.jsx("span",{children:s.subtitle}),s.extra&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:s.extra})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.inLibrary?e.jsxs(L,{variant:"outline",className:"gap-1",children:[e.jsx(c,{icon:ce,className:"h-3 w-3"}),"In Library"]}):e.jsxs(u,{size:"sm",onClick:l=>{l.stopPropagation(),a()},children:[e.jsx(c,{icon:Z,className:"h-4 w-4 mr-1"}),"Add"]})})]})},s.id)},vs=s=>{const t=Math.floor(s/60),i=s%60;return`${t}:${i.toString().padStart(2,"0")}`},Ha=()=>P?e.jsx("div",{className:"space-y-2",children:Array.from({length:5}).map((s,t)=>e.jsx(S,{children:e.jsxs(k,{className:"flex items-center gap-4 p-4",children:[e.jsx(I,{className:"h-16 w-16 rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(I,{className:"h-4 w-1/3"}),e.jsx(I,{className:"h-3 w-1/2"})]}),e.jsx(I,{className:"h-9 w-20"})]})},t))}):W==="artist"&&me.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-4",children:["Found ",me.length," artists"]}),me.map(s=>{const t=ht===s.musicbrainzId,i=ft[s.musicbrainzId]||[],a=pt.has(s.musicbrainzId);return e.jsx(S,{className:s.inLibrary?"opacity-60":"",children:e.jsxs(k,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 rounded bg-muted flex-shrink-0 overflow-hidden flex items-center justify-center",children:e.jsx(c,{icon:Xt,className:"h-8 w-8 text-muted-foreground/50"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground flex-wrap",children:[s.type&&e.jsx("span",{children:s.type}),s.country&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:s.country})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.inLibrary?e.jsxs(L,{variant:"outline",className:"gap-1",children:[e.jsx(c,{icon:ce,className:"h-3 w-3"}),"In Library"]}):e.jsxs(u,{size:"sm",onClick:()=>za(s),children:[e.jsx(c,{icon:Z,className:"h-4 w-4 mr-1"}),"Add"]}),e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>Ua(s.musicbrainzId),children:[e.jsx(c,{icon:pr,className:"h-4 w-4 mr-1"}),t?"Hide":"Explore"]})]})]}),t&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("h4",{className:"text-sm font-medium mb-3",children:"Albums"}),a?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ee,{}),"Loading albums..."]}):i.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No albums found"}):e.jsx("div",{className:"space-y-2",children:i.map(r=>{const o=us===r.musicbrainzId,l=hs[r.musicbrainzId]||[],h=xs.has(r.musicbrainzId),p=`https://coverartarchive.org/release-group/${r.musicbrainzId}/front-250`,g=`album-${r.musicbrainzId}`;return e.jsxs("div",{className:"border rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3",children:[e.jsx("div",{className:"h-12 w-12 rounded bg-muted flex-shrink-0 overflow-hidden flex items-center justify-center",children:Ot.has(g)?e.jsx(c,{icon:Jt,className:"h-6 w-6 text-muted-foreground/50"}):e.jsx("img",{src:p,alt:r.title,className:"h-full w-full object-cover",onError:()=>qt(g)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:r.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.releaseDate||"Unknown date"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r.inLibrary?e.jsxs(L,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(c,{icon:ce,className:"h-3 w-3"}),"In Library"]}):e.jsxs(u,{size:"sm",variant:"outline",className:"h-7 text-xs",onClick:()=>{ye(r)},children:[e.jsx(c,{icon:Z,className:"h-3 w-3 mr-1"}),"Add"]}),e.jsxs(u,{size:"sm",variant:"ghost",className:"h-7 text-xs",onClick:()=>Pt(r.musicbrainzId),children:[e.jsx(c,{icon:Cs,className:`h-3 w-3 transition-transform ${o?"rotate-90":""}`}),"Tracks"]})]})]}),o&&e.jsx("div",{className:"border-t bg-muted/30 p-3",children:h?e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(ee,{className:"size-3"}),"Loading tracks..."]}):l.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"No tracks found"}):e.jsx("div",{className:"space-y-1",children:l.map((v,q)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs py-1 group",children:[e.jsxs("span",{className:"text-muted-foreground w-5 text-right",children:[q+1,"."]}),e.jsx("span",{className:"flex-1 truncate",children:v.title}),v.duration&&e.jsx("span",{className:"text-muted-foreground",children:vs(v.duration)}),!r.inLibrary&&e.jsx(u,{size:"sm",variant:"ghost",className:"h-6 px-2 text-xs opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>ye(r,v.title),children:e.jsx(c,{icon:Z,className:"h-3 w-3"})})]},v.musicbrainzId))})})]},r.musicbrainzId)})})]})]})},s.musicbrainzId)})]}):W==="album"&&Re.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-4",children:["Found ",Re.length," albums"]}),Re.map(s=>{const t=us===s.musicbrainzId,i=hs[s.musicbrainzId]||[],a=xs.has(s.musicbrainzId);return e.jsx(S,{className:s.inLibrary?"opacity-60":"",children:e.jsxs(k,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 rounded bg-muted flex-shrink-0 overflow-hidden flex items-center justify-center",children:e.jsx(c,{icon:Jt,className:"h-8 w-8 text-muted-foreground/50"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground flex-wrap",children:[e.jsx("button",{className:"hover:text-primary hover:underline transition-colors",onClick:()=>$t(s.artistName,s.artistMusicbrainzId),children:s.artistName}),s.releaseDate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:s.releaseDate})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.inLibrary?e.jsxs(L,{variant:"outline",className:"gap-1",children:[e.jsx(c,{icon:ce,className:"h-3 w-3"}),"In Library"]}):e.jsxs(u,{size:"sm",onClick:()=>{ye(s)},children:[e.jsx(c,{icon:Z,className:"h-4 w-4 mr-1"}),"Add"]}),e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>Pt(s.musicbrainzId),children:[e.jsx(c,{icon:Cs,className:`h-4 w-4 mr-1 transition-transform ${t?"rotate-90":""}`}),t?"Hide":"Tracks"]})]})]}),t&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("h4",{className:"text-sm font-medium mb-3",children:"Tracks"}),a?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ee,{}),"Loading tracks..."]}):i.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No tracks found"}):e.jsx("div",{className:"space-y-1",children:i.map((r,o)=>e.jsxs("div",{className:"flex items-center gap-3 text-sm py-1.5 px-2 rounded hover:bg-muted/50",children:[e.jsxs("span",{className:"text-muted-foreground w-6 text-right",children:[o+1,"."]}),e.jsx("span",{className:"flex-1 truncate",children:r.title}),r.duration&&e.jsx("span",{className:"text-muted-foreground",children:vs(r.duration)})]},r.musicbrainzId))})]})]})},s.musicbrainzId)})]}):W==="track"&&Fe.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-4",children:["Found ",Fe.length," tracks"]}),Fe.map(s=>e.jsx(S,{className:s.inLibrary?"opacity-60":"",children:e.jsxs(k,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"h-16 w-16 rounded bg-muted flex-shrink-0 overflow-hidden flex items-center justify-center",children:e.jsx(c,{icon:gr,className:"h-8 w-8 text-muted-foreground/50"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground flex-wrap",children:[e.jsx("button",{className:"hover:text-primary hover:underline transition-colors",onClick:()=>$t(s.artistName,s.artistMusicbrainzId),children:s.artistName}),s.albumTitle&&s.albumMusicbrainzId&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("button",{className:"hover:text-primary hover:underline transition-colors",onClick:()=>Va(s.albumTitle,s.albumMusicbrainzId),children:s.albumTitle})]}),s.duration&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:vs(s.duration)})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.inLibrary?e.jsxs(L,{variant:"outline",className:"gap-1",children:[e.jsx(c,{icon:ce,className:"h-3 w-3"}),"In Library"]}):s.albumMusicbrainzId?e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>{const t={musicbrainzId:s.albumMusicbrainzId,title:s.albumTitle||"Unknown Album",artistName:s.artistName,artistMusicbrainzId:s.artistMusicbrainzId,inLibrary:!1};ye(t,s.title)},children:[e.jsx(c,{icon:Z,className:"h-4 w-4 mr-1"}),"Add"]}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"No album linked"})})]})},s.musicbrainzId))]}):se?e.jsx(oe,{}):null,X=({title:s,items:t,type:i,source:a,moreHref:r,onItemClick:o,onAdd:l,onToggle:h,togglingItems:p,watchProviderMap:g,watchProviderLoading:v,watchProviderObserverRef:q})=>{const bs=n.useRef(null),Et=f=>{bs.current&&bs.current.scrollBy({left:f==="left"?-400:400,behavior:"smooth"})};return t.length===0?null:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[s,a&&e.jsx(L,{variant:"outline",className:"ml-2 text-xs font-normal",children:a==="trakt"?"Trakt":a==="justwatch"?"JustWatch":"For You"})]}),r&&e.jsx("button",{onClick:()=>le.visit(r),className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:"Show more"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Et("left"),children:e.jsx(c,{icon:vr,className:"h-4 w-4"})}),e.jsx(u,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Et("right"),children:e.jsx(c,{icon:Cs,className:"h-4 w-4"})})]})]}),e.jsx("div",{ref:bs,className:"flex gap-3 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-muted scrollbar-track-transparent",style:{scrollbarWidth:"thin"},children:t.map(f=>{let E="none";if(f.inLibrary)if(i==="movie"){const ys=f;E=ys.hasFile?"downloaded":ys.requested?"requested":"downloaded"}else E=f.requested?"requested":"downloaded";const Xa=E==="none"?()=>l(f):E==="requested"?()=>h(f):void 0;return e.jsx(br,{tmdbId:f.tmdbId,title:f.title,year:f.year,posterUrl:f.posterUrl,genres:f.genres,mediaType:i,status:E,isToggling:p.has(f.tmdbId),showStatusOnHover:E==="none",onToggleRequest:Xa,streamingProviders:g?.[f.tmdbId],isLoadingProviders:v?.has(f.tmdbId),observerRef:q?.(f.tmdbId),onClick:()=>o(f),size:"lane"},f.tmdbId)})})]})},F=()=>e.jsxs("div",{className:"space-y-3",children:[e.jsx(I,{className:"h-6 w-48"}),e.jsx("div",{className:"flex gap-3 overflow-hidden",children:Array.from({length:6}).map((s,t)=>e.jsx(I,{className:"flex-shrink-0 w-[150px] aspect-[2/3] rounded-lg"},t))})]}),_a=()=>{if(P)return e.jsx(Ae,{});if(Le.length>0)return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-4",children:["Found ",Le.length," movies"]}),Le.map(a=>Te({id:a.tmdbId,name:a.title,subtitle:a.year?.toString(),extra:a.rating?`${a.rating.toFixed(1)} rating`:void 0,imageUrl:a.posterUrl,inLibrary:a.inLibrary},Zt,()=>ge(a.tmdbId),()=>we(a,!1)))]});if(se)return e.jsx(oe,{});const s=qs.filter(a=>a.source==="trakt"||a.source==="justwatch"),t=qs.filter(a=>a.source==="tmdb"),i=[{id:28,name:"Action"},{id:35,name:"Comedy"},{id:18,name:"Drama"},{id:27,name:"Horror"},{id:878,name:"Sci-Fi"},{id:53,name:"Thriller"},{id:10749,name:"Romance"},{id:16,name:"Animation"},{id:12,name:"Adventure"},{id:80,name:"Crime"},{id:14,name:"Fantasy"},{id:99,name:"Documentary"}];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Browse by Genre"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(a=>e.jsx(u,{variant:"outline",size:"sm",className:"rounded-full h-8 text-xs",onClick:()=>le.visit(`/discover/movies/genre?genreId=${a.id}`),children:a.name},a.id))})]}),Bs&&s.length===0&&e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx(F,{})]}),s.map(a=>e.jsx(X,{title:a.label,source:a.source,items:a.items,type:"movie",moreHref:`/discover/movies/${a.key.replace(/-movies$/,"")}`,onItemClick:r=>ge(r.tmdbId),onAdd:r=>we(r,!1),onToggle:r=>gs(r),togglingItems:es,watchProviderMap:rs,watchProviderLoading:nt,watchProviderObserverRef:it},a.key)),ke.map(a=>Pe[a.key]?e.jsx(X,{title:a.label,items:Pe[a.key],type:"movie",moreHref:`/discover/movies/${a.key}`,onItemClick:r=>ge(r.tmdbId),onAdd:r=>we(r,!1),onToggle:r=>gs(r),togglingItems:es,watchProviderMap:rs},a.key):Ms?e.jsx(F,{},a.key):null),!Ms&&Object.keys(Pe).length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:"Enter a search term to find movies"})}),Bs&&t.length===0&&e.jsx(F,{}),t.map(a=>e.jsx(X,{title:a.label,source:a.source,items:a.items,type:"movie",onItemClick:r=>ge(r.tmdbId),onAdd:r=>we(r,!1),onToggle:r=>gs(r),togglingItems:es,watchProviderMap:rs,watchProviderLoading:nt,watchProviderObserverRef:it},a.key))]})},Ga=()=>{if(P)return e.jsx(Ae,{});if(Oe.length>0)return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-4",children:["Found ",Oe.length," TV shows"]}),Oe.map(a=>Te({id:a.tmdbId,name:a.title,subtitle:a.year?.toString(),extra:a.status,imageUrl:a.posterUrl,inLibrary:a.inLibrary},Yt,()=>je(a.tmdbId),()=>Ne(a,!1)))]});if(se)return e.jsx(oe,{});const s=Es.filter(a=>a.source==="trakt"||a.source==="justwatch"),t=Es.filter(a=>a.source==="tmdb"),i=[{id:10759,name:"Action"},{id:35,name:"Comedy"},{id:18,name:"Drama"},{id:80,name:"Crime"},{id:10765,name:"Sci-Fi"},{id:16,name:"Animation"},{id:99,name:"Documentary"},{id:9648,name:"Mystery"},{id:10764,name:"Reality"},{id:10751,name:"Family"}];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Browse by Genre"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(a=>e.jsx(u,{variant:"outline",size:"sm",className:"rounded-full h-8 text-xs",onClick:()=>le.visit(`/discover/tv/genre?genreId=${a.id}`),children:a.name},a.id))})]}),Vs&&s.length===0&&e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx(F,{})]}),s.map(a=>e.jsx(X,{title:a.label,source:a.source,items:a.items,type:"tv",moreHref:`/discover/tv/${a.key.replace(/-shows$/,"")}`,onItemClick:r=>je(r.tmdbId),onAdd:r=>Ne(r,!1),onToggle:r=>js(r),togglingItems:as,watchProviderMap:ns,watchProviderLoading:ot,watchProviderObserverRef:lt},a.key)),Ie.map(a=>Ee[a.key]?e.jsx(X,{title:a.label,items:Ee[a.key],type:"tv",moreHref:`/discover/tv/${a.key}`,onItemClick:r=>je(r.tmdbId),onAdd:r=>Ne(r,!1),onToggle:r=>js(r),togglingItems:as,watchProviderMap:ns},a.key):$s?e.jsx(F,{},a.key):null),!$s&&Object.keys(Ee).length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:"Enter a search term to find TV shows"})}),Vs&&t.length===0&&e.jsx(F,{}),t.map(a=>e.jsx(X,{title:a.label,source:a.source,items:a.items,type:"tv",onItemClick:r=>je(r.tmdbId),onAdd:r=>Ne(r,!1),onToggle:r=>js(r),togglingItems:as,watchProviderMap:ns,watchProviderLoading:ot,watchProviderObserverRef:lt},a.key))]})},Ja=()=>P?e.jsx(Ae,{}):te==="author"&&Ue.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-4",children:["Found ",Ue.length," authors"]}),Ue.map(s=>Te({id:s.openlibraryId,name:s.name,subtitle:s.birthDate,inLibrary:s.inLibrary},zs,()=>Da(s)))]}):te==="book"&&Ve.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-4",children:["Found ",Ve.length," books"]}),Ve.map(s=>Te({id:s.openlibraryId,name:s.title,subtitle:s.authorName,extra:s.year?.toString(),imageUrl:s.coverUrl,inLibrary:s.inLibrary},zs,()=>Ra(s)))]}):se?e.jsx(oe,{}):null,Ka=()=>P?e.jsx(Ae,{}):R.length>0?e.jsx(S,{className:"min-w-0 overflow-hidden",children:e.jsxs(k,{className:"pt-6 min-w-0",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-4",children:["Found ",R.length," results",ue.length>0&&` (filtered from ${We.length})`]}),e.jsx("div",{className:"overflow-x-auto -mx-6 px-6",children:e.jsxs(cr,{className:"w-full",children:[e.jsx(mr,{children:e.jsxs(Ht,{children:[x("select")&&e.jsx(Ce,{className:"w-[40px]",children:e.jsx(Ut,{checked:N.size===R.length&&R.length>0,onCheckedChange:$a})}),x("protocol")&&e.jsx(Ce,{className:"w-[60px]",children:"Type"}),x("age")&&e.jsx(Q,{field:"age",children:"Age"}),x("title")&&e.jsx(Q,{field:"title",children:"Title"}),x("indexer")&&e.jsx(Q,{field:"indexer",children:"Indexer"}),x("size")&&e.jsx(Q,{field:"size",children:"Size"}),x("grabs")&&e.jsx(Q,{field:"grabs",children:"Grabs"}),x("category")&&e.jsx(Q,{field:"category",children:"Category"}),x("actions")&&e.jsx(Ce,{className:"w-[80px]",children:"Actions"})]})}),e.jsx(ur,{children:R.map(s=>e.jsxs(Ht,{className:N.has(s.id)?"bg-muted/50":"",children:[x("select")&&e.jsx(C,{children:e.jsx(Ut,{checked:N.has(s.id),onCheckedChange:()=>Oa(s.id)})}),x("protocol")&&e.jsx(C,{children:e.jsx(L,{variant:s.protocol==="torrent"?"default":"secondary",className:"text-xs",children:s.protocol==="torrent"?"torrent":"nzb"})}),x("age")&&e.jsx(C,{className:"text-muted-foreground whitespace-nowrap",children:Sr(s.publishDate)}),x("title")&&e.jsx(C,{children:e.jsx("div",{className:"font-medium truncate max-w-md cursor-pointer hover:text-primary min-w-0",title:s.title,onClick:()=>At(s),children:s.title})}),x("indexer")&&e.jsx(C,{className:"text-muted-foreground",children:s.indexer}),x("size")&&e.jsx(C,{className:"whitespace-nowrap",children:Qt(s.size)}),x("grabs")&&e.jsx(C,{className:"text-muted-foreground",children:s.grabs??"-"}),x("category")&&e.jsx(C,{children:s.category&&e.jsx(L,{variant:"outline",className:"text-xs",children:s.category})}),x("actions")&&e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[s.infoUrl&&e.jsx(u,{variant:"ghost",size:"icon",asChild:!0,className:"h-8 w-8",children:e.jsx("a",{href:s.infoUrl,target:"_blank",rel:"noopener noreferrer",children:e.jsx(c,{icon:jr,className:"h-4 w-4"})})}),e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>At(s),className:"h-8 w-8",children:e.jsx(c,{icon:As,className:"h-4 w-4"})})]})})]},s.id))})]})})]})}):se?e.jsx(oe,{}):null,Ae=()=>e.jsx("div",{className:"space-y-2",children:Array.from({length:5}).map((s,t)=>e.jsx(S,{children:e.jsxs(k,{className:"flex items-center gap-4 p-4",children:[e.jsx(I,{className:"h-16 w-16 rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(I,{className:"h-4 w-1/3"}),e.jsx(I,{className:"h-3 w-1/2"})]}),e.jsx(I,{className:"h-9 w-20"})]})},t))}),oe=()=>e.jsx(S,{children:e.jsxs(k,{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"rounded-full bg-muted p-6 mb-4",children:e.jsx(c,{icon:Ts,className:"h-12 w-12 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No results found"}),e.jsx("p",{className:"text-muted-foreground",children:"Try a different search term."})]})}),Qa=()=>m==="direct"?"Search for releases on indexers...":m==="music"?`Search for ${W}s on MusicBrainz...`:m==="movies"?"Search for movies on TMDB...":m==="tv"?"Search for TV shows on TMDB...":m==="books"?`Search for ${te}s on OpenLibrary...`:"Search...";return e.jsx(yr,{children:e.jsxs(sr,{title:"Search",children:[e.jsx(Za,{title:"Search"}),e.jsx("div",{className:"space-y-4",children:e.jsxs(ks,{value:m,onValueChange:s=>Ds(s),children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{className:"overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0 scrollbar-none",children:e.jsxs(Is,{className:"min-w-max",children:[V.map(s=>{const t=Nr[s];return e.jsxs(B,{value:s,className:"gap-2",children:[e.jsx(c,{icon:t.icon,className:"h-4 w-4"}),t.label]},s)}),e.jsxs(B,{value:"direct",className:"gap-2",children:[e.jsx(c,{icon:hr,className:"h-4 w-4"}),"Direct"]})]})}),m==="music"&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Search for:"}),e.jsx(ks,{value:W,onValueChange:s=>ze(s),children:e.jsxs(Is,{className:"h-8",children:[e.jsx(B,{value:"artist",className:"text-xs px-2 h-6",children:"Artist"}),e.jsx(B,{value:"album",className:"text-xs px-2 h-6",children:"Album"}),e.jsx(B,{value:"track",className:"text-xs px-2 h-6",children:"Track"})]})})]}),m==="books"&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Search for:"}),e.jsx(ks,{value:te,onValueChange:s=>ra(s),children:e.jsxs(Is,{className:"h-8",children:[e.jsx(B,{value:"author",className:"text-xs px-2 h-6",children:"Author"}),e.jsx(B,{value:"book",className:"text-xs px-2 h-6",children:"Book"})]})})]})]}),e.jsx(S,{className:"mt-4",children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(c,{icon:Ts,className:"size-4 text-muted-foreground absolute top-1/2 -translate-y-1/2 left-2"}),e.jsx(ar,{placeholder:Qa(),value:j,onChange:s=>De(s.target.value),onKeyDown:Ma,className:"pl-9",autoFocus:!0})]}),e.jsx(u,{onClick:Se,disabled:P||j.length<2,children:P?e.jsx(ee,{}):e.jsx(c,{icon:Ts,className:"h-4 w-4"})})]}),m==="direct"&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Indexers:"}),e.jsxs(ws,{children:[e.jsx(Ns,{asChild:!0,children:e.jsx(u,{variant:"outline",size:"sm",children:z.length===0?"All":`${z.length} selected`})}),e.jsxs(Ss,{align:"start",children:[ia.map(s=>e.jsx(Vt,{checked:z.includes(s.id),onCheckedChange:t=>{Gs(t?[...z,s.id]:z.filter(i=>i!==s.id))},children:s.name},s.id)),z.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(tr,{}),e.jsx(Wt,{onClick:()=>Gs([]),children:"Clear"})]})]})]})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsxs(ws,{children:[e.jsx(Ns,{asChild:!0,children:e.jsxs(u,{variant:"outline",size:"sm",children:[e.jsx(c,{icon:xr,className:"h-4 w-4 mr-1"}),"Sort"]})}),e.jsx(Ss,{align:"end",children:["age","title","size","indexer","grabs"].map(s=>e.jsxs(Wt,{onClick:()=>Tt(s),children:[s.charAt(0).toUpperCase()+s.slice(1),ae===s&&e.jsx(c,{icon:re==="asc"?_t:Gt,className:"h-4 w-4 ml-2"})]},s))})]}),e.jsxs(ws,{children:[e.jsx(Ns,{asChild:!0,children:e.jsxs(u,{variant:"outline",size:"sm",children:[e.jsx(c,{icon:fr,className:"h-4 w-4 mr-1"}),"Columns"]})}),e.jsx(Ss,{align:"end",children:He.map(s=>e.jsx(Vt,{checked:s.visible,onCheckedChange:()=>Pa(s.id),children:s.label},s.id))})]})]})]})]})})}),m==="direct"&&N.size>0&&e.jsx(S,{children:e.jsxs(k,{className:"py-3 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[N.size," release",N.size>1?"s":""," selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>H(new Set),children:"Clear"}),e.jsxs(u,{size:"sm",onClick:Ea,disabled:Xs,children:[Xs?e.jsx(ee,{className:"mr-2"}):e.jsx(c,{icon:As,className:"h-4 w-4 mr-2"}),"Grab Selected"]})]})]})}),e.jsx(de,{value:"music",className:"mt-4",children:Ha()}),e.jsx(de,{value:"movies",className:"mt-4",children:_a()}),e.jsx(de,{value:"tv",className:"mt-4",children:Ga()}),e.jsx(de,{value:"books",className:"mt-4",children:Ja()}),e.jsx(de,{value:"direct",className:"mt-4",children:Ka()})]})}),e.jsx(rr,{open:ha,onOpenChange:he,children:e.jsxs(nr,{children:[e.jsxs(ir,{children:[e.jsx(or,{children:"Download Release"}),e.jsx(lr,{children:"Send this release to your download client?"})]}),ne&&e.jsxs("div",{className:"py-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Title"}),e.jsx("div",{className:"font-medium",children:ne.title})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Size"}),e.jsx("div",{children:Qt(ne.size)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Indexer"}),e.jsx("div",{children:ne.indexer})]})]})]}),e.jsxs(dr,{children:[e.jsx(u,{variant:"outline",onClick:()=>he(!1),children:"Cancel"}),e.jsxs(u,{onClick:()=>qa(),disabled:Ks,children:[Ks?e.jsx(ee,{className:"mr-2"}):e.jsx(c,{icon:As,className:"h-4 w-4 mr-2"}),"Download"]})]})]})}),$&&e.jsx(er,{tmdbId:$.tmdbId,showTitle:$.title,open:wa,onOpenChange:pe,onConfirm:s=>{et(s),pe(!1),K.length===1?Rt($,K[0].id,s):fe(!0)}}),e.jsx(Y,{open:Ge,onOpenChange:Je,mediaType:"artist",title:_e?.name||"",description:"Configure how this artist will be added to your library.",qualityProfiles:T,loading:_,adding:Aa,onAdd:s=>_e&&Ct(_e,s)}),e.jsx(Y,{open:Ke,onOpenChange:s=>{Qe(s),s||ps(null)},mediaType:"album",title:fs?`"${fs}"`:G?.title||"",description:fs?`To get this track, the album "${G?.title}" by ${G?.artistName} will be added.`:`This will add ${G?.artistName} with this album.`,qualityProfiles:T,loading:_,adding:Ca,onAdd:s=>G&&zt(G,s)}),e.jsx(Y,{open:Ye,onOpenChange:Ze,mediaType:"movie",title:Xe?.title||"",description:"Configure how this movie will be added to your library.",qualityProfiles:J,loading:_,adding:ba,onAdd:s=>Xe&&Dt(Xe,s,at)}),e.jsx(Y,{open:ts,onOpenChange:fe,mediaType:"tvshow",title:$?.title||"",description:"Configure how this TV show will be added to your library.",qualityProfiles:K,loading:_,adding:Na,onAdd:s=>$&&Rt($,s,O,at),episodeSelectionSummary:O&&(O.selectedSeasons?`${O.selectedSeasons.length} season${O.selectedSeasons.length!==1?"s":""} selected`:O.selectedEpisodes?`${Object.values(O.selectedEpisodes).reduce((s,t)=>s+t.length,0)} episodes selected`:"All episodes selected"),onChangeEpisodeSelection:()=>{fe(!1),pe(!0)}}),e.jsx(Y,{open:os,onOpenChange:ls,mediaType:"author",title:is?.name||"",description:"Configure how this author will be added to your library.",qualityProfiles:A,loading:_,adding:Ia,onAdd:(s,t)=>is&&Ft(is,s,t?.addBooks??!0),showAddBooksOption:!0}),e.jsx(Y,{open:ds,onOpenChange:cs,mediaType:"book",title:ve?.title||"",description:`By ${ve?.authorName}. This will also add the author if not already in your library.`,qualityProfiles:A,loading:_,adding:Ta,onAdd:s=>ve&&Lt(ve,s)})]})})}kr.__docgenInfo={description:"",methods:[],displayName:"SearchPage"};export{kr as default};
