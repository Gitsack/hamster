import{j as e}from"./jsx-runtime-u17CrQMm.js";import{H as B,S as M,a as k,b as E,c as z,d as m}from"./app-CFoDCqX-.js";import{A}from"./app-layout-CTvh2ZE0.js";import{B as g}from"./button-B9kPMW4q.js";import{C as D,a as L,b as V,d as _}from"./card-BT9UEfea.js";import{B as x}from"./badge-B6bn15vN.js";import{S as c}from"./skeleton-A7behTLO.js";import{T as $,a as I,b as N,c as i,d as R,e as n}from"./table-B1mxUS1v.js";import{H as d,n as U,o as q,V as G,k as K}from"./index.min-fvaCWwiU.js";import{S as J}from"./spinner-McTJFRVv.js";import{r as a}from"./app-BHuVDAkc.js";import"./preload-helper-PPVm8Dsz.js";import"./client-Bx265bNG.js";import"./index-CYxWbFTv.js";import"./index-D5-0xbEa.js";import"./utils-CDN07tui.js";import"./dialog-CQTA4pg1.js";import"./createLucideIcon-GXN1tXoc.js";import"./media-status-badge-DETbNkVM.js";import"./useRenderElement-D0Q1kVud.js";import"./useBaseUiId-BvJSLVy2.js";import"./useValueAsRef-GoV-SdOe.js";import"./media-teaser-CTZEtwns.js";import"./check-BEKQ83Eb.js";import"./useLabelableId-CyGgmgle.js";import"./valueToPercent-CmxdyyhM.js";import"./slot-CUYGZ4Fv.js";import"./hamster-icon-DOXrnfMg.js";import"./input-Bw95PIWX.js";function O(){const[u,w]=a.useState([]),[t,S]=a.useState(null),[v,h]=a.useState(!0),[o,y]=a.useState("all"),[p,j]=a.useState(1),[b,C]=a.useState(new Set),P=s=>{C(r=>{const l=new Set(r);return l.has(s)?l.delete(s):l.add(s),l})},f=a.useCallback(async()=>{h(!0);try{const s=new URLSearchParams({page:p.toString(),limit:"25"});o!=="all"&&s.append("status",o);const r=await fetch(`/api/v1/queue/history?${s}`);if(r.ok){const l=await r.json();w(l.data),S(l.meta)}}catch(s){console.error("Failed to fetch history:",s)}finally{h(!1)}},[p,o]);a.useEffect(()=>{f()},[f]);const H=s=>s?s>=1073741824?`${(s/1073741824).toFixed(1)} GB`:s>=1048576?`${(s/1048576).toFixed(0)} MB`:`${(s/1024).toFixed(0)} KB`:"-",T=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}):"-",F=s=>{switch(s){case"completed":return e.jsxs(x,{className:"bg-green-500",children:[e.jsx(d,{icon:K,className:"h-3 w-3 mr-1"}),"Completed"]});case"failed":return e.jsxs(x,{variant:"destructive",children:[e.jsx(d,{icon:G,className:"h-3 w-3 mr-1"}),"Failed"]});default:return e.jsx(x,{variant:"outline",children:s})}};return e.jsxs(A,{title:"History",children:[e.jsx(B,{title:"History"}),e.jsx("div",{className:"space-y-6",children:e.jsxs(D,{children:[e.jsxs(L,{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsx(V,{children:"Download History"}),e.jsxs(M,{value:o,onValueChange:y,children:[e.jsx(k,{className:"w-full sm:w-40",children:e.jsx(E,{placeholder:"Filter by status"})}),e.jsxs(z,{children:[e.jsx(m,{value:"all",children:"All"}),e.jsx(m,{value:"completed",children:"Completed"}),e.jsx(m,{value:"failed",children:"Failed"})]})]})]}),e.jsx(_,{children:v?e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((s,r)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{className:"h-4 w-20"}),e.jsx(c,{className:"h-4 flex-1"}),e.jsx(c,{className:"h-4 w-24"}),e.jsx(c,{className:"h-4 w-32"})]},r))}):u.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"rounded-full bg-muted p-6 mb-4",children:e.jsx(J,{className:"size-12 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No history yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Completed and failed downloads will appear here."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto -mx-6 px-6",children:e.jsxs($,{children:[e.jsx(I,{children:e.jsxs(N,{children:[e.jsx(i,{children:"Title"}),e.jsx(i,{className:"w-28",children:"Status"}),e.jsx(i,{className:"w-24 text-right",children:"Size"}),e.jsx(i,{className:"w-40",children:"Client"}),e.jsx(i,{className:"w-44",children:"Date"})]})}),e.jsx(R,{children:u.map(s=>e.jsxs(N,{children:[e.jsxs(n,{className:"max-w-md",children:[e.jsx("div",{className:"font-medium truncate",children:s.title}),s.albumTitle&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.albumTitle}),s.errorMessage&&e.jsx("div",{className:"text-xs text-destructive mt-1 cursor-pointer hover:text-destructive/80",onClick:()=>P(s.id),children:b.has(s.id)?e.jsx("span",{className:"break-words whitespace-pre-wrap",children:s.errorMessage}):e.jsx("span",{className:"line-clamp-1",children:s.errorMessage})})]}),e.jsx(n,{children:F(s.status)}),e.jsx(n,{className:"text-right text-muted-foreground",children:H(s.size)}),e.jsx(n,{className:"text-muted-foreground",children:s.downloadClient||"-"}),e.jsx(n,{className:"text-muted-foreground",children:T(s.completedAt)})]},s.id))})]})}),t&&t.lastPage>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-2 mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(t.currentPage-1)*t.perPage+1," to"," ",Math.min(t.currentPage*t.perPage,t.total)," of ",t.total," ","entries"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>j(s=>Math.max(1,s-1)),disabled:t.currentPage<=1,children:e.jsx(d,{icon:U,className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:["Page ",t.currentPage," of ",t.lastPage]}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>j(s=>Math.min(t.lastPage,s+1)),disabled:t.currentPage>=t.lastPage,children:e.jsx(d,{icon:q,className:"h-4 w-4"})})]})]})]})})]})})]})}O.__docgenInfo={description:"",methods:[],displayName:"History"};export{O as default};
