import{j as e}from"./jsx-runtime-u17CrQMm.js";import{t as k,H as B,C as z,e as R,L as U}from"./app-CFoDCqX-.js";import{A as Y}from"./app-layout-CTvh2ZE0.js";import{B as w}from"./button-B9kPMW4q.js";import{B as H}from"./badge-B6bn15vN.js";import{S as C}from"./skeleton-A7behTLO.js";import{H as N,n as K,o as P,z as W,e as q,j as V,I as X,k as G,v as J}from"./index.min-fvaCWwiU.js";import{r as p}from"./app-BHuVDAkc.js";import"./preload-helper-PPVm8Dsz.js";import"./client-Bx265bNG.js";import"./index-CYxWbFTv.js";import"./index-D5-0xbEa.js";import"./utils-CDN07tui.js";import"./dialog-CQTA4pg1.js";import"./createLucideIcon-GXN1tXoc.js";import"./spinner-McTJFRVv.js";import"./media-status-badge-DETbNkVM.js";import"./useRenderElement-D0Q1kVud.js";import"./useBaseUiId-BvJSLVy2.js";import"./useValueAsRef-GoV-SdOe.js";import"./media-teaser-CTZEtwns.js";import"./check-BEKQ83Eb.js";import"./useLabelableId-CyGgmgle.js";import"./valueToPercent-CmxdyyhM.js";import"./slot-CUYGZ4Fv.js";import"./hamster-icon-DOXrnfMg.js";import"./input-Bw95PIWX.js";const M={episode:"bg-blue-500",movie:"bg-red-500",album:"bg-green-500",book:"bg-purple-500"},Q={episode:"border-blue-500",movie:"border-red-500",album:"border-green-500",book:"border-purple-500"},T={episode:"TV",movie:"Movie",album:"Music",book:"Book"},Z={episode:X,movie:V,album:q,book:W},E=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];function ee(s,n){const d=new Date(s,n,1),o=new Date(s,n+1,0);let x=d.getDay()-1;x<0&&(x=6);const l=[];for(let r=x-1;r>=0;r--){const m=new Date(s,n,-r);l.push({date:m,isCurrentMonth:!1})}for(let r=1;r<=o.getDate();r++)l.push({date:new Date(s,n,r),isCurrentMonth:!0});const h=42-l.length;for(let r=1;r<=h;r++)l.push({date:new Date(s,n+1,r),isCurrentMonth:!1});return l}function $(s){const n=s.getFullYear(),d=String(s.getMonth()+1).padStart(2,"0"),o=String(s.getDate()).padStart(2,"0");return`${n}-${d}-${o}`}function te(s){const n=new Date;return s.getFullYear()===n.getFullYear()&&s.getMonth()===n.getMonth()&&s.getDate()===n.getDate()}function se(s){const n=s.uid.match(/^(\w+)-(\d+)@/);if(!n)return null;const[,d,o]=n;switch(d){case"episode":return null;case"movie":return`/movie/${o}`;case"album":return`/album/${o}`;case"book":return`/book/${o}`;default:return null}}function ne(){const[s,n]=p.useState(()=>new Date),[d,o]=p.useState([]),[x,l]=p.useState(!0),[h,r]=p.useState(!1),[m,v]=p.useState(null),c=s.getFullYear(),u=s.getMonth(),y=p.useCallback(async()=>{l(!0);try{const t=new Date(c,u-1,1),a=new Date(c,u+2,0),f=new URLSearchParams({start:t.toISOString().split("T")[0],end:a.toISOString().split("T")[0],unmonitored:h?"true":"false"}),i=await fetch(`/api/v1/calendar?${f}`);if(i.ok){const j=await i.json();o(j)}else k.error("Failed to load calendar events")}catch{k.error("Failed to connect to server")}finally{l(!1)}},[c,u,h]);p.useEffect(()=>{y()},[y]);const g=new Map;for(const t of d){const a=t.startDate.split("T")[0];g.has(a)||g.set(a,[]),g.get(a).push(t)}const L=ee(c,u),I=new Date(c,u).toLocaleString("default",{month:"long"}),_=()=>n(new Date(c,u-1,1)),A=()=>n(new Date(c,u+1,1)),F=()=>{n(new Date),v($(new Date))},D=m?g.get(m)||[]:[];return e.jsxs(Y,{title:"Calendar",actions:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("a",{href:"/api/v1/calendar.ics",target:"_blank",rel:"noopener noreferrer",className:"inline-flex",children:e.jsxs(w,{variant:"outline",size:"sm",children:[e.jsx(N,{icon:J,className:"h-4 w-4 mr-2"}),"iCal"]})})}),children:[e.jsx(B,{title:"Calendar"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{variant:"outline",size:"sm",onClick:_,children:e.jsx(N,{icon:K,className:"h-4 w-4"})}),e.jsx(w,{variant:"outline",size:"sm",onClick:F,children:"Today"}),e.jsx(w,{variant:"outline",size:"sm",onClick:A,children:e.jsx(N,{icon:P,className:"h-4 w-4"})}),e.jsxs("h2",{className:"text-lg font-semibold ml-2",children:[I," ",c]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{id:"showUnmonitored",checked:h,onCheckedChange:t=>r(!!t)}),e.jsx(R,{htmlFor:"showUnmonitored",className:"text-sm font-normal cursor-pointer",children:"Show unmonitored"})]})})]}),e.jsx("div",{className:"flex items-center gap-4 text-sm flex-wrap",children:Object.entries(T).map(([t,a])=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${M[t]}`}),e.jsx("span",{className:"text-muted-foreground",children:a})]},t))}),x?e.jsxs("div",{className:"grid grid-cols-7 gap-px bg-border rounded-lg overflow-hidden",children:[E.map(t=>e.jsx("div",{className:"bg-muted px-2 py-2 text-center text-xs font-medium text-muted-foreground",children:t},t)),Array.from({length:35}).map((t,a)=>e.jsxs("div",{className:"bg-card p-2 min-h-[60px] sm:min-h-[100px]",children:[e.jsx(C,{className:"h-4 w-6 mb-2"}),e.jsx(C,{className:"h-3 w-full"})]},a))]}):e.jsxs("div",{className:"grid grid-cols-7 gap-px bg-border rounded-lg overflow-hidden",children:[E.map(t=>e.jsx("div",{className:"bg-muted px-2 py-2 text-center text-xs font-medium text-muted-foreground",children:t},t)),L.map(({date:t,isCurrentMonth:a},f)=>{const i=$(t),j=g.get(i)||[],O=te(t),S=m===i;return e.jsxs("button",{type:"button",onClick:()=>v(S?null:i),className:`bg-card p-1.5 min-h-[60px] sm:min-h-[100px] text-left transition-colors hover:bg-accent/50 ${a?"":"opacity-40"} ${S?"ring-2 ring-primary ring-inset":""}`,children:[e.jsx("div",{className:`text-xs font-medium mb-1 w-6 h-6 flex items-center justify-center rounded-full ${O?"bg-primary text-primary-foreground":""}`,children:t.getDate()}),e.jsxs("div",{className:"space-y-0.5",children:[j.slice(0,3).map(b=>e.jsx("div",{className:`text-[10px] leading-tight px-1 py-0.5 rounded truncate border-l-2 ${Q[b.mediaType]} ${b.hasFile?"bg-muted/50 line-through opacity-60":"bg-muted"}`,title:b.title,children:b.title},b.uid)),j.length>3&&e.jsxs("div",{className:"text-[10px] text-muted-foreground px-1",children:["+",j.length-3," more"]})]})]},f)})]}),m&&e.jsxs("div",{className:"rounded-lg border bg-card p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:new Date(m+"T00:00:00").toLocaleDateString("default",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),D.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No releases on this day."}):e.jsx("div",{className:"space-y-2",children:D.map(t=>{const a=se(t),f=Z[t.mediaType],i=e.jsxs("div",{className:`flex items-center gap-3 p-2 rounded-md border ${a?"hover:bg-accent/50 transition-colors":""}`,children:[e.jsx("div",{className:`flex items-center justify-center h-8 w-8 rounded ${M[t.mediaType]} text-white`,children:e.jsx(N,{icon:f,className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:t.title}),t.description&&e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:"outline",className:"text-xs",children:T[t.mediaType]}),t.hasFile&&e.jsx(N,{icon:G,className:"h-4 w-4 text-green-500"})]})]});return a?e.jsx(U,{href:a,children:i},t.uid):e.jsx("div",{children:i},t.uid)})})]})]})]})}ne.__docgenInfo={description:"",methods:[],displayName:"Calendar"};export{ne as default};
