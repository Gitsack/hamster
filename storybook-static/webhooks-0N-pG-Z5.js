import{j as e}from"./jsx-runtime-u17CrQMm.js";import{t as i,H as me,e as n,S as he,a as pe,b as ue,c as xe,d as C,C as c}from"./app-CFoDCqX-.js";import{A as fe}from"./app-layout-CTvh2ZE0.js";import{B as m}from"./button-B9kPMW4q.js";import{I as S}from"./input-Bw95PIWX.js";import{C as M,a as _,b as V,c as X,d as Y}from"./card-BT9UEfea.js";import{B as F}from"./badge-B6bn15vN.js";import{D as U,a as H,b as P,c as O,d as E,e as z}from"./dialog-CQTA4pg1.js";import{T as je,a as ge,b as Q,c as j,d as be,e as g}from"./table-B1mxUS1v.js";import{H as b,a5 as ve,k as ye,V as Ce,q as ke,a6 as Ne,w as De}from"./index.min-fvaCWwiU.js";import{S as k}from"./spinner-McTJFRVv.js";import{r as d}from"./app-BHuVDAkc.js";import"./preload-helper-PPVm8Dsz.js";import"./client-Bx265bNG.js";import"./index-CYxWbFTv.js";import"./index-D5-0xbEa.js";import"./utils-CDN07tui.js";import"./skeleton-A7behTLO.js";import"./media-status-badge-DETbNkVM.js";import"./useRenderElement-D0Q1kVud.js";import"./useBaseUiId-BvJSLVy2.js";import"./useValueAsRef-GoV-SdOe.js";import"./media-teaser-CTZEtwns.js";import"./check-BEKQ83Eb.js";import"./createLucideIcon-GXN1tXoc.js";import"./useLabelableId-CyGgmgle.js";import"./valueToPercent-CmxdyyhM.js";import"./slot-CUYGZ4Fv.js";import"./hamster-icon-DOXrnfMg.js";const N={name:"",url:"",enabled:!0,method:"POST",onGrab:!0,onDownloadComplete:!0,onImportComplete:!0,onImportFailed:!0,onUpgrade:!0,onRename:!1,onDelete:!1,onHealthIssue:!0,onHealthRestored:!1},Te=[{id:"jellyfin",name:"Jellyfin",description:"Trigger library scan when media is imported",fields:[{name:"serverUrl",label:"Server URL",type:"url",placeholder:"http://localhost:8096",required:!0},{name:"apiKey",label:"API Key",type:"password",placeholder:"Your Jellyfin API key",help:"Dashboard → API Keys → Create",required:!0}],buildUrl:a=>`${a.serverUrl?.replace(/\/$/,"")}/Library/Refresh?api_key=${a.apiKey}`,formData:{name:"Jellyfin Library Refresh",method:"POST",onGrab:!1,onDownloadComplete:!1,onImportComplete:!0,onImportFailed:!1,onUpgrade:!0,onRename:!1,onDelete:!0,onHealthIssue:!1,onHealthRestored:!1}},{id:"plex",name:"Plex",description:"Trigger library scan when media is imported",fields:[{name:"serverUrl",label:"Server URL",type:"url",placeholder:"http://localhost:32400",required:!0},{name:"token",label:"Plex Token",type:"password",placeholder:"Your X-Plex-Token",help:"Find in Plex URL after signing in: ...?X-Plex-Token=xxx",required:!0},{name:"sectionId",label:"Library Section ID",type:"text",placeholder:"1",help:"Library section number (leave empty to scan all)",required:!1}],buildUrl:a=>{const D=a.serverUrl?.replace(/\/$/,""),T=a.sectionId||"all";return`${D}/library/sections/${T}/refresh?X-Plex-Token=${a.token}`},formData:{name:"Plex Library Refresh",method:"GET",onGrab:!1,onDownloadComplete:!1,onImportComplete:!0,onImportFailed:!1,onUpgrade:!0,onRename:!1,onDelete:!0,onHealthIssue:!1,onHealthRestored:!1}},{id:"emby",name:"Emby",description:"Trigger library scan when media is imported",fields:[{name:"serverUrl",label:"Server URL",type:"url",placeholder:"http://localhost:8096",required:!0},{name:"apiKey",label:"API Key",type:"password",placeholder:"Your Emby API key",help:"Dashboard → Advanced → API Keys",required:!0}],buildUrl:a=>`${a.serverUrl?.replace(/\/$/,"")}/Library/Refresh?api_key=${a.apiKey}`,formData:{name:"Emby Library Refresh",method:"POST",onGrab:!1,onDownloadComplete:!1,onImportComplete:!0,onImportFailed:!1,onUpgrade:!0,onRename:!1,onDelete:!0,onHealthIssue:!1,onHealthRestored:!1}},{id:"kodi",name:"Kodi",description:"Update Kodi library via JSON-RPC",fields:[{name:"serverUrl",label:"Server URL",type:"url",placeholder:"http://localhost:8080",help:'Enable "Allow remote control via HTTP" in Kodi',required:!0}],buildUrl:a=>`${a.serverUrl?.replace(/\/$/,"")}/jsonrpc`,formData:{name:"Kodi Library Update",method:"POST",onGrab:!1,onDownloadComplete:!1,onImportComplete:!0,onImportFailed:!1,onUpgrade:!0,onRename:!1,onDelete:!0,onHealthIssue:!1,onHealthRestored:!1}},{id:"custom",name:"Custom",description:"Create a custom webhook with your own settings",fields:[{name:"url",label:"Webhook URL",type:"url",placeholder:"https://example.com/webhook",required:!0}],buildUrl:a=>a.url||"",formData:N}];function Ie(){const[a,D]=d.useState([]),[T,Z]=d.useState(!0),[ee,I]=d.useState(!1),[se,p]=d.useState(!1),[re,v]=d.useState(!1),[l,L]=d.useState(null),[u,w]=d.useState(null),[y,W]=d.useState({}),[r,o]=d.useState(N),[$,A]=d.useState(!1),[G,q]=d.useState(!1),[h,x]=d.useState(null),[K,J]=d.useState(!1);d.useEffect(()=>{R()},[]);const R=async()=>{try{const s=await fetch("/api/v1/webhooks");if(s.ok){const t=await s.json();D(t)}}catch(s){console.error("Failed to fetch webhooks:",s),i.error("Failed to load webhooks")}finally{Z(!1)}},ae=()=>{L(null),w(null),o(N),x(null),I(!0)},oe=s=>{w(s),W({}),o({...N,...s.formData,url:""}),I(!1),p(!0)},le=s=>{L(s),w(null),o({name:s.name,url:s.url,enabled:s.enabled,method:s.method,onGrab:s.onGrab,onDownloadComplete:s.onDownloadComplete,onImportComplete:s.onImportComplete,onImportFailed:s.onImportFailed,onUpgrade:s.onUpgrade,onRename:s.onRename,onDelete:s.onDelete,onHealthIssue:s.onHealthIssue,onHealthRestored:s.onHealthRestored}),x(null),p(!0)},te=async()=>{if(!l){i.error("Save the webhook first, then test");return}q(!0),x(null);try{const t=await(await fetch(`/api/v1/webhooks/${l.id}/test`,{method:"POST"})).json();x(t),t.success?i.success(`Webhook responded with ${t.statusCode}`):i.error(t.error||"Test failed")}catch{x({success:!1,error:"Connection failed"}),i.error("Connection failed")}finally{q(!1)}},ne=async()=>{let s=r.url;if(u&&!l){const t=u.fields.filter(f=>f.required&&!y[f.name]).map(f=>f.label);if(t.length>0){i.error(`Please fill in: ${t.join(", ")}`);return}s=u.buildUrl(y)}if(!r.name||!s){i.error("Please fill in all required fields");return}try{new URL(s)}catch{i.error("Please enter a valid URL");return}A(!0);try{const t=l?`/api/v1/webhooks/${l.id}`:"/api/v1/webhooks",B=await fetch(t,{method:l?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...r,url:s})});if(B.ok)i.success(l?"Webhook updated":"Webhook added"),p(!1),R();else{const ce=await B.json();i.error(ce.error||"Failed to save")}}catch(t){console.error("Failed to save:",t),i.error("Failed to save webhook")}finally{A(!1)}},ie=async()=>{if(l){J(!0);try{(await fetch(`/api/v1/webhooks/${l.id}`,{method:"DELETE"})).ok?(i.success("Webhook deleted"),v(!1),p(!1),R()):i.error("Failed to delete webhook")}catch(s){console.error("Failed to delete:",s),i.error("Failed to delete webhook")}finally{J(!1)}}},de=s=>[s.onGrab,s.onDownloadComplete,s.onImportComplete,s.onImportFailed,s.onUpgrade,s.onRename,s.onDelete,s.onHealthIssue,s.onHealthRestored].filter(Boolean).length;return e.jsxs(fe,{title:"Webhooks",actions:e.jsxs(m,{onClick:ae,children:[e.jsx(b,{icon:De,className:"h-4 w-4 mr-2"}),"Add Webhook"]}),children:[e.jsx(me,{title:"Webhooks"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M,{children:[e.jsxs(_,{children:[e.jsx(V,{children:"Webhooks"}),e.jsx(X,{children:"Configure webhooks to integrate with external services like Plex, Jellyfin, or custom automation. Webhooks will receive JSON payloads when events occur."})]}),e.jsx(Y,{children:T?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(k,{className:"size-6 text-muted-foreground"})}):a.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No webhooks configured."}),e.jsx("p",{className:"mt-2",children:"Add a webhook to integrate with external services."})]}):e.jsxs(je,{children:[e.jsx(ge,{children:e.jsxs(Q,{children:[e.jsx(j,{children:"Name"}),e.jsx(j,{children:"URL"}),e.jsx(j,{children:"Events"}),e.jsx(j,{children:"Status"}),e.jsx(j,{className:"w-24"})]})}),e.jsx(be,{children:a.map(s=>e.jsxs(Q,{children:[e.jsx(g,{className:"font-medium",children:s.name}),e.jsx(g,{className:"text-muted-foreground text-sm max-w-[200px] truncate",children:s.url}),e.jsx(g,{children:e.jsxs(F,{variant:"outline",children:[de(s)," events"]})}),e.jsx(g,{children:s.enabled?e.jsx(F,{variant:"default",className:"bg-green-500",children:"Enabled"}):e.jsx(F,{variant:"secondary",children:"Disabled"})}),e.jsx(g,{children:e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>le(s),children:e.jsx(b,{icon:ve,className:"h-4 w-4"})})})]},s.id))})]})})]}),e.jsxs(M,{children:[e.jsxs(_,{children:[e.jsx(V,{children:"Webhook Payload"}),e.jsx(X,{children:"Example payload sent to webhooks on events"})]}),e.jsx(Y,{children:e.jsx("pre",{className:"bg-muted p-4 rounded-lg text-sm overflow-x-auto",children:JSON.stringify({eventType:"import.completed",instanceName:"Hamster",media:{id:"123",title:"Movie Title",year:2024,mediaType:"movies"},files:[{path:"/media/movies/Movie Title (2024)/Movie Title (2024).mkv",quality:"1080p"}]},null,2)})})]})]}),e.jsx(U,{open:se,onOpenChange:p,children:e.jsxs(H,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(P,{children:[e.jsx(O,{children:l?"Edit Webhook":"Add Webhook"}),e.jsx(E,{children:"Configure your webhook endpoint settings."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Name *"}),e.jsx(S,{id:"name",value:r.name,onChange:s=>o({...r,name:s.target.value}),placeholder:"Plex Refresh"})]}),u&&!l?e.jsx(e.Fragment,{children:u.fields.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{htmlFor:s.name,children:[s.label,s.required&&" *"]}),e.jsx(S,{id:s.name,type:s.type==="password"?"password":"text",value:y[s.name]||"",onChange:t=>W({...y,[s.name]:t.target.value}),placeholder:s.placeholder}),s.help&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.help})]},s.name))}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"url",children:"URL *"}),e.jsx(S,{id:"url",type:"url",value:r.url,onChange:s=>o({...r,url:s.target.value}),placeholder:"https://example.com/webhook"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"method",children:"HTTP Method"}),e.jsxs(he,{value:r.method,onValueChange:s=>o({...r,method:s}),children:[e.jsx(pe,{id:"method",children:e.jsx(ue,{})}),e.jsxs(xe,{children:[e.jsx(C,{value:"GET",children:"GET"}),e.jsx(C,{value:"POST",children:"POST"}),e.jsx(C,{value:"PUT",children:"PUT"}),e.jsx(C,{value:"PATCH",children:"PATCH"})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-2 border-t",children:[e.jsx(n,{className:"text-base font-medium",children:"Trigger on Events"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"onGrab",checked:r.onGrab,onCheckedChange:s=>o({...r,onGrab:!!s})}),e.jsx(n,{htmlFor:"onGrab",className:"font-normal cursor-pointer",children:"On Grab"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"onDownloadComplete",checked:r.onDownloadComplete,onCheckedChange:s=>o({...r,onDownloadComplete:!!s})}),e.jsx(n,{htmlFor:"onDownloadComplete",className:"font-normal cursor-pointer",children:"On Download"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"onImportComplete",checked:r.onImportComplete,onCheckedChange:s=>o({...r,onImportComplete:!!s})}),e.jsx(n,{htmlFor:"onImportComplete",className:"font-normal cursor-pointer",children:"On Import"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"onImportFailed",checked:r.onImportFailed,onCheckedChange:s=>o({...r,onImportFailed:!!s})}),e.jsx(n,{htmlFor:"onImportFailed",className:"font-normal cursor-pointer",children:"On Import Failed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"onUpgrade",checked:r.onUpgrade,onCheckedChange:s=>o({...r,onUpgrade:!!s})}),e.jsx(n,{htmlFor:"onUpgrade",className:"font-normal cursor-pointer",children:"On Upgrade"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"onRename",checked:r.onRename,onCheckedChange:s=>o({...r,onRename:!!s})}),e.jsx(n,{htmlFor:"onRename",className:"font-normal cursor-pointer",children:"On Rename"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"onDelete",checked:r.onDelete,onCheckedChange:s=>o({...r,onDelete:!!s})}),e.jsx(n,{htmlFor:"onDelete",className:"font-normal cursor-pointer",children:"On Delete"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"onHealthIssue",checked:r.onHealthIssue,onCheckedChange:s=>o({...r,onHealthIssue:!!s})}),e.jsx(n,{htmlFor:"onHealthIssue",className:"font-normal cursor-pointer",children:"On Health Issue"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{id:"onHealthRestored",checked:r.onHealthRestored,onCheckedChange:s=>o({...r,onHealthRestored:!!s})}),e.jsx(n,{htmlFor:"onHealthRestored",className:"font-normal cursor-pointer",children:"On Health Restored"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(c,{id:"enabled",checked:r.enabled,onCheckedChange:s=>o({...r,enabled:!!s})}),e.jsx(n,{htmlFor:"enabled",className:"font-normal cursor-pointer",children:"Enabled"})]}),h&&e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-md ${h.success?"bg-green-500/10 text-green-600":"bg-destructive/10 text-destructive"}`,children:[e.jsx(b,{icon:h.success?ye:Ce,className:"h-5 w-5"}),e.jsx("span",{children:h.success?`Success! Server responded with ${h.statusCode}`:h.error||"Test failed"})]})]}),e.jsxs(z,{className:"flex-col sm:flex-row gap-2",children:[l&&e.jsxs(m,{variant:"destructive",onClick:()=>v(!0),className:"sm:mr-auto",children:[e.jsx(b,{icon:ke,className:"h-4 w-4 mr-2"}),"Delete"]}),l&&e.jsxs(m,{variant:"outline",onClick:te,disabled:G,children:[G?e.jsx(k,{className:"mr-2"}):e.jsx(b,{icon:Ne,className:"h-4 w-4 mr-2"}),"Test"]}),e.jsxs(m,{onClick:ne,disabled:$,children:[$&&e.jsx(k,{className:"mr-2"}),l?"Save":"Add"]})]})]})}),e.jsx(U,{open:re,onOpenChange:v,children:e.jsxs(H,{children:[e.jsxs(P,{children:[e.jsxs(O,{children:["Delete ",l?.name,"?"]}),e.jsx(E,{children:"This will remove the webhook. External services will no longer receive events."})]}),e.jsxs(z,{children:[e.jsx(m,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsxs(m,{variant:"destructive",onClick:ie,disabled:K,children:[K&&e.jsx(k,{className:"mr-2"}),"Delete"]})]})]})}),e.jsx(U,{open:ee,onOpenChange:I,children:e.jsxs(H,{className:"max-w-lg",children:[e.jsxs(P,{children:[e.jsx(O,{children:"Add Webhook"}),e.jsx(E,{children:"Choose a preset for common media servers or create a custom webhook."})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 py-4",children:Te.map(s=>e.jsxs("button",{type:"button",onClick:()=>oe(s),className:"flex flex-col items-start gap-2 p-4 rounded-lg border border-border hover:border-primary hover:bg-accent transition-colors text-left",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]},s.id))})]})})]})}Ie.__docgenInfo={description:"",methods:[],displayName:"Webhooks"};export{Ie as default};
